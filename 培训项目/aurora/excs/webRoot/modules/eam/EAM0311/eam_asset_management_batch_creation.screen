<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Spencer 3893
    $Date: 2013-5-27 上午9:42:50  
    $Revision: 1.0  
    $Purpose: 批量新增资产台账管理页面
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="eam.eam0020.eam0020_asset_books_lov" queryOrderBy="asset_book_code" rootPath="eam_batch_asset_books_list"/>
        <a:model-query defaultWhereClause="t1.base_trx_category = &apos;ADD&apos;" fetchAll="true" model="eam.eam0120.eam_transaction_types_lv" rootPath="eam_batch_transaction_types"/>
        <a:model-query model="eam.eam0310.eam0310_asset_init_status" rootPath="eam0310_asset_status"/>
        <a:model-query model="eam.eam0310.eam310_default_transaction_type" rootPath="default_transaction_type"/>
        <a:model-query fetchAll="true" model="eam.eam0310.eam0310_employee_primary_position" rootPath="eam0311_employee_pmsg"/>
        <a:model-query model="eam.eam0310.eam0310_sysdate_query" rootPath="sysdate"/>
        <a:model-query model="eam.common.eam_currency_query" rootPath="eam_currency"/>
        <a:model-query model="eam.eam0311.eam0311_requisition_headers_edit" rootPath="req_header"/>
        <a:model-query model="eam.common.eam_default_currency_code" rootPath="eam_default_currency"/>
        <a:model-query fetchAll="true" model="eam.eam0120.eam_req_type_source_type" rootPath="req_type_source_type"/>
        <a:model-query fetchAll="true" model="eam.eam0310.eam0310_employee_assigns_lov" rootPath="eam0310_employee"/>
        <!-- <a:model-query defaultWhereClause="t.primary_position_flag = &apos;Y&apos;" fetchAll="true" model="eam.eam_exp_org_unit_employee_lov" rootPath="eam0310_unit_employee"/> -->
        <a:model-query defaultWhereClause="t.unit_id = ${/parameter/@entity_unit_id}" fetchAll="true" model="eam.eam_exp_org_unit_employee_lov" rootPath="eam0310_unit_employee"/>
        <a:model-query defaultWhereClause="cpy.company_id=${/session/@company_id}" fetchAll="false" model="cont.con_contract_header_company_lov" rootPath="default_company"/>
        <a:model-query fetchAll="true" model="eam.eam0311.eam0311_certificate_type_cmb" rootPath="certificate_type_query"/>
        <a:model-query fetchAll="true" model="eam.eam0311.eam0311_eam_asset_value_parameter" rootPath="asset_parameter_query"/>
        <a:model-query model="cont.sys_date" rootPath="sys_date"/>
    </a:init-procedure>
    <a:view>
        <a:link id="eam_asset_batch_create_link" url="${/request/@context_path}/modules/eam/EAM0310/eam_asset_management_batch_save.svc"/>
        <script><![CDATA[
            Aurora.onReady(eam_batch_init);
            
            function eam_batch_init() {
                var tabs = $("eam_batch_asset_management_tab");
                tabs.setDisabled(5);
                var ast_requisition_type_code = '${/parameter/@ast_requisition_type_code}';
                //ast_requisition_type_code为QD004、QD005可使用租用信息
                //jhyh 租入信息已注释
                if (ast_requisition_type_code != 'QD004' && ast_requisition_type_code != 'QD005') {
                    tabs.setDisabled(7);
                } else {
                    $("eam0810_eam_asset_lease_info_result_ds").create();
                }
                var record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                var asset_book_id = '${/parameter/@asset_book_id}';
                record.set('asset_book_id', asset_book_id);
                record.set('requisition_header_id', '${/parameter/@requisition_header_id}');
                record.getField("category_desc").setLovPara('asset_book_id', asset_book_id);
                record.getField("value_man_company_desc").setLovPara('asset_book_id', asset_book_id);
                record.getField("entity_man_company_desc").setLovPara('asset_book_id', asset_book_id);
                record.getField("responsibility_company_desc").setLovPara('asset_book_id', asset_book_id);
            
                // record.getField("entity_unit_desc").setLovPara('company_id', '${/session/@company_id}');
                record.getField("using_unit_desc").setLovPara('company_id', '${/session/@company_id}');
                record.getField("responsibility_center_desc").setLovPara('asset_book_id', parseInt(asset_book_id));
                 
                record.getField("req_employee_name").setLovPara('unit_id', record.get("using_unit_id"));
                //资产大类：根据资产业务申请类型维护数据
                var ast_requisition_type_id = '${/parameter/@ast_requisition_type_id}';
                $('eam_batch_asset_categories_list_ds').setQueryParameter('ast_requisition_type_id', parseInt(ast_requisition_type_id));
                $('eam_batch_asset_categories_list_ds').setQueryParameter('asset_book_id', '${/parameter/@asset_book_id}');
                // $('eam_batch_asset_categories_list_ds').setQueryParameter('entity_unit_id','${/model/eam0310_unit_employee/record/@unit_id}');
                $('eam_batch_asset_categories_list_ds').setQueryParameter('entity_unit_id', '${/parameter/@entity_unit_id}');
                $('eam_batch_asset_categories_list_ds').query();
            }
            
            // 保存
            
            function eam_batch_save() {
            
                if (!$('eam0810_asset_management_result_ds').validate()) {
                    return false;
                }
                var start_use_date = $('eam0810_asset_management_result_ds').getCurrentRecord().get('start_use_date');
                 var dateNow=Aurora.parseDate('${/model/sys_date/record/@now}'); //by whf 时间从数据库获取时间
                //var dateNow = new Date();
                if (dateNow < start_use_date) {
                    Aurora.showErrorMessage('${l:PROMPT}', '启用日期只能选择当前或者之前月份的某一天');
                    return false;
                }
                var allocate_element_type = $('eam0810_asset_management_result_ds').getCurrentRecord().get('allocate_element_type');
                var quantity = $('eam0810_asset_management_result_ds').getCurrentRecord().get('quantity');
                var cost = $('eam0810_asset_management_result_ds').getCurrentRecord().get('cost');
                var price = $('eam0810_asset_management_result_ds').getCurrentRecord().get('price');
                var category_code = $('eam0810_asset_management_result_ds').getCurrentRecord().get('category_code');
                var ast_requisition_type_code = '${/parameter/@ast_requisition_type_code}';
                //固定资产为成本必须≥4000；低值易耗品必须<4000
               //jhyh
                
                var fixed_min_value = '${/model/asset_parameter_query/record/@fixed_min_value}';
                
                if (category_code == '10' && price < fixed_min_value && ast_requisition_type_code != 'QD005') {
                    Aurora.showErrorMessage('${l:PROMPT}', '固定资产的单价金额必须大于等于' + fixed_min_value);
                    return false;
                }
                var dzyh_min_value = '${/model/asset_parameter_query/record/@dzyh_min_value}';
                var dzyh_max_value = '${/model/asset_parameter_query/record/@dzyh_max_value}';
                if (category_code == '20' && (price < dzyh_min_value || price >= dzyh_max_value)) {
                    Aurora.showErrorMessage('${l:PROMPT}', '低值易耗品的单价金额不能小于' + dzyh_min_value + '，且不能大于等于' + dzyh_max_value);
                    return false;
                }
                var result_ds = $('eam_batch_eam_asset_allocations_result_ds');
                //mantis24468 当因子类型为比率时,保存分配记录时,先校验分配数量的和是否为1,不为1则报错.
                if (allocate_element_type == 'RATIO' && result_ds) {
                    var rs = result_ds.getAll();
                    var sum = 0;
                    for (var j = 0;j < rs.length;j++) {
                        var r = rs[j];
                        sum += r.get('quantity');
                    }
                    if (sum != 1 && rs.length > 0) {
                        Aurora.showErrorMessage('${l:PROMPT}', '${l:EAM_ASSET_ALLOCATIONS.ALLOCATE_ELEMENT_TYPE}');
                        return;
                    }
                }
            
                var cost_ds = $('eam_batch_cost_source_ds').getAll();
                var source_ids = [];
                for (var i = 0;i < cost_ds.length;i++) {
                    var record = $('eam_batch_cost_source_ds').getAt(i);
                    if (i == 0) {
                        source_ids.push(record.get("source_asset_id"));
                    }
                    var exists = false;
                    for (var k = 0;k < source_ids.length;k++) {
                        if (source_ids[k] == record.get("source_asset_id")) {
                            exists = true;
                            break;
                        }
                    }
                    if (!exists) {
                        source_ids.push(record.get("source_asset_id"));
                    }
                }
                if (source_ids.length < cost_ds.length) {
                    alert("源对象不能重复！");
                    return false;
                }
            
                if (cost_ds.length > 0) {
                    $('eam0810_asset_management_result_ds').getCurrentRecord().set('source_opr', 'NO');
                } else {
                    $('eam0810_asset_management_result_ds').getCurrentRecord().set('source_opr', 'YES');
                }
            
                var unit_id = "${/model/eam0311_employee_pmsg/record/@unit_id}";
                var employee_id = '${/model/eam0311_employee_pmsg/record/@employee_id}';
                var position_id = '${/model/eam0311_employee_pmsg/record/@position_id}';
            
                var requisition_header_id = '${/parameter/@requisition_header_id}';
            
                var record = $('eam0810_asset_management_result_ds').getCurrentRecord();
            
                record.set('unit_id', unit_id);
                record.set('employee_id', employee_id);
                record.set('position_id', position_id);
                record.set('to_location_id', record.get('location_id'));
                record.set('requisition_header_id', requisition_header_id);
            
                var batch_create_num = record.get('batch_create_num');
            
                var data = [];
                for (var i = 0;i < batch_create_num;i++) {
                    var para = $('eam0810_asset_management_result_ds').getJsonData();
                    if (i != 0) para[0].input_asset_id = -1;
                    else para[0].input_asset_id = '${/parameter/@input_asset_id}';
            
                    para.batch_create_num = i;
            
                    data.push(para[0]);
                }
                //console.log(data);
                Aurora.request({
                    url: $('eam_asset_batch_create_link').getUrl(),
                    para: data,
                    success: function() {
                        eam_batch_back();
                    }
                });
                //$('eam0810_asset_management_result_ds').submit();
            }
            
            function onCostLoad(dataset) {
                var form_record = $('eam0810_asset_management_result_ds').getCurrentRecord();
            
                var asset_source_type = form_record.get("asset_source_type");
            
                var records = dataset.getAll();
                for (var i = 0;i < records.length;i++) {
                    var record = records[i];
            
                    var default_value_type = '${/model/req_header/record/@value_type}';
            
                    if (default_value_type == 'FINAL') {
                        record.getMeta().getField('cost_value_type_desc').setReadOnly(true);
                    }
            
                    record.set('cost_value_type', default_value_type);
                    switch (asset_source_type) {
                        // 在建工程结转
                    case 'FROMCIP':
                        //  能选择的源对象号资产分类为在建工程的,状态为建设中的资产,[价值类型] 可编辑,且值为"决算价"或"暂估价",默认值为"决算价"
                        record.getField("source_asset_code").setLovPara('status', 'IN_PROCESS');
                        record.getField("source_asset_code").setLovPara('asset_type', 'CIP');
                        record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                        record.getField("source_asset_code").setLovPara("asset_id", form_record.get("asset_id"));
                        record.getField("cost").setRequired(true);
                        break;
                        // 抵债转自用
                    case 'FROMDEBT':
                        // 能选择的源对象为资产分类为抵债资产,且状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                        record.getField("source_asset_code").setLovService("eam.eam0310.eam0310_source_asset_for_debt");
                        record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                        record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                        break;
                        // 换入
                    case 'TRANSFERIN':
                        // 能选择源对象为固定资产或无形资产及状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                        record.getField("source_asset_code").setLovService('eam.eam0310.eam0310_source_asset_for_trans');
                        record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                        record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                        break;
                        // 购置
                        /* case 'PURCHASE':
                         record.getMeta().getField('source_asset_code').setReadOnly(true);
                         record.getMeta().getField('source_asset_code').setRequired(false);
                         record.set('cost_value_type', 'FINAL');
                         break;  */
                    }
                }
            }
            
            function onQueryUpdateFun(dataSet, record, name, value) {
                //资产账簿修改时资产大类联动改变
                if (name == 'asset_book_id') {
                    record.set('category_id', '');
                    record.set('category_desc', '');
                    record.getMeta().getField('category_desc').setReadOnly(false);
                    $('eam_batch_asset_categories_list_ds').setQueryParameter('asset_book_id', record.get("asset_book_id"));
                    $('eam_batch_asset_categories_list_ds').query();
                }
                //资产大类修改时财务分类联动改变
                if (name == 'category_id') {
                    //alert(record.get("category_id"));
                    record.set('fin_class_id', '');
                    record.set('entity_class_id', '');
                    record.getMeta().getField('fin_class_id').setReadOnly(false);
                    record.getMeta().getField('entity_class_id').setReadOnly(false);
                    $('eam_batch_asset_fin_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                    $('eam_batch_asset_fin_class_list_ds').query();
                    //资产大类修改时实物分类联动改变
                    $('eam_batch_asset_entity_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                    $('eam_batch_asset_entity_class_list_ds').query();
                }
            
            }
            
            //ds第一次加载grid数据第一行对应form数据某些字段可修改
            
            function onAssetManLoad(ds) {
                var record = ds.getCurrentRecord();
            
                if (record.get('value_man_company_id') != undefined && record.get('value_man_company_id') != '' && record.get('value_man_company_id') != null) {
                    record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                    record.getField("value_man_unit_desc").setLovPara('company_id', record.get('value_man_company_id'));
                }
            
                if (record.get('value_man_unit_id') != undefined && record.get('value_man_unit_id') != '' && record.get('value_man_unit_id') != null) {
                    record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                    record.getField("value_man_position_desc").setLovPara('unit_id', record.get('value_man_unit_id'));
                }
            
                if (record.get('entity_company_id') != undefined && record.get('entity_company_id') != '' && record.get('entity_company_id') != null) {
                    record.getMeta().getField('entity_unit_desc').setReadOnly(false);
                    record.getField("entity_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                }
            
            
                if (record.get('entity_unit_id') != undefined && record.get('entity_unit_id') != '' && record.get('entity_unit_id') != null) {
                    record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                    record.getField("entity_man_position_desc").setLovPara('unit_id', record.get('entity_unit_id'));
                }
            
                if (record.get('responsibility_company_id') != undefined && record.get('responsibility_company_id') != '' && record.get('responsibility_company_id') != null) {
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.getMeta().getField('responsibility_center_desc').setRequired(flase);
                    record.getField("responsibility_center_desc").setLovPara('company_id', record.get('responsibility_company_id'));
                }
            
                record.getField('entity_class_desc').setLovPara('category_id', record.get('category_id'));
                record.getField("req_employee_name").setLovPara('unit_id', record.get('using_unit_id'));
            }
            
            //grid数据选择某一行对应form数据某些字段可修改
            
            function gridRowClick(grid, row, record) {
                if (record.get('asset_book_id') != undefined && record.get('asset_book_id') != '' && record.get('asset_book_id') != null) {
                    record.getMeta().getField('category_desc').setReadOnly(false);
                    record.getField("category_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    record.getField("value_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                    record.getField("entity_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                    record.getField("responsibility_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                }
                if (record.get('category_id') != undefined && record.get('category_id') != '' && record.get('category_id') != null) {
                    record.getMeta().getField('entity_class_desc').setReadOnly(false);
                    record.getField("entity_class_desc").setLovPara('category_id', record.get('category_id'));
                }
                if (record.get('value_man_company_id') != undefined && record.get('value_man_company_id') != '' && record.get('value_man_company_id') != null) {
                    record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                    record.getField("value_man_unit_desc").setLovPara('company_id', record.get('value_man_company_id'));
                }
            
                if (record.get('value_man_unit_id') != undefined && record.get('value_man_unit_id') != '' && record.get('value_man_unit_id') != null) {
                    record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                    record.getField("value_man_position_desc").setLovPara('unit_id', record.get('value_man_unit_id'));
                }
            
                if (record.get('entity_company_id') != undefined && record.get('entity_company_id') != '' && record.get('entity_company_id') != null) {
            
                    record.getMeta().getField('entity_unit_desc').setReadOnly(false);
                    record.getField("entity_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                }
            
                if (record.get('entity_unit_id') != undefined && record.get('entity_unit_id') != '' && record.get('entity_unit_id') != null) {
                    record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                    record.getField("entity_man_position_desc").setLovPara('unit_id', record.get('entity_unit_id'));
                }
            
                if (record.get('responsibility_company_id') != undefined && record.get('responsibility_company_id') != '' && record.get('responsibility_company_id') != null) {
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.getMeta().getField('responsibility_center_desc').setRequired(false);
                    record.getField("responsibility_center_desc").setLovPara('company_id', record.get('responsibility_company_id'));
                }
            }
            
            function onUpdateFun(dataSet, record, name, value, oldValue) {
                if (name == 'asset_book_id') {
                    lovField = record.getField("category_desc");
                    record.getMeta().getField('category_desc').setReadOnly(false);
                    record.set('category_id', '');
                    record.set('category_desc', '');
                    lovField.setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    lovField3 = record.getField("value_man_company_desc");
                    lovField3.setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    lovField4 = record.getField("entity_man_company_desc");
                    lovField4.setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    lovField5 = record.getField("responsibility_company_desc");
                    lovField5.setLovPara('asset_book_id', record.get('asset_book_id'));
                } else if (name == 'category_id') {
                    lovField = record.getField("entity_class_desc");
                    record.getMeta().getField('entity_class_desc').setReadOnly(false);
                    record.set('entity_class_id', '');
                    record.set('entity_class_desc', '');
                    record.set('entity_sub_class_desc', '');
                    record.set('entity_sub_class_code', '');
                    record.set('entity_sub_classes_id', '');
                    lovField.setLovPara('category_id', record.get('category_id'));
                } else if (name == 'entity_class_desc') {
                    record.set('entity_sub_class_desc', '');
                    record.set('entity_sub_class_code', '');
                    record.set('entity_sub_classes_id', '');
                    record.getField("description").setReadOnly(false);
                    var f1 = record.getMeta().getField('description');
                    f1.setLovPara('entity_class_id', record.get('entity_class_id'));
                    f1.setLovService('eam.eam_asset_req_entity_lov');
            
                } else if (name == 'value_man_company_id') {
                    lovField = record.getField("value_man_unit_desc");
                    record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                    record.set('value_man_unit_id', '');
                    record.set('value_man_unit_desc', '');
                    record.set('value_man_position_id', '');
                    record.set('value_man_position_desc', '');
                    lovField.setLovPara('company_id', record.get('value_man_company_id'));
                } else if (name == 'value_man_unit_id') {
                    lovField = record.getField("value_man_position_desc");
                    record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                    record.set('value_man_position_id', '');
                    record.set('value_man_position_desc', '');
                    lovField.setLovPara('unit_id', record.get('value_man_unit_id'));
                } else if (name == 'entity_company_id') {
                    lovField = record.getField("entity_unit_desc");
                    record.getMeta().getField('entity_unit_desc').setReadOnly(false);
                    record.set('entity_unit_id', '');
                    record.set('entity_unit_desc', '');
                    record.set('entity_position_id', '');
                    record.set('entity_man_position_desc', '');
                    record.set('req_employee_name', '');
                    record.set('to_employee_id', '');
                    lovField.setLovPara('company_id', record.get('entity_company_id'));
                    record.getField("entity_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                    record.getField("using_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                } else if (name == 'entity_unit_id') {
                    lovField = record.getField("entity_man_position_desc");
                    record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                    record.set('entity_position_id', '');
                    record.set('entity_man_position_desc', '');
                    record.set('req_employee_name', '');
                    record.set('to_employee_id', '');
                    lovField.setLovPara('unit_id', record.get('entity_unit_id'));
                    record.getField("req_employee_name").setLovPara('unit_id', record.get('entity_unit_id'));
                } else if (name == 'responsibility_company_id') {
                    lovField = record.getField("responsibility_center_desc");
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.getMeta().getField('responsibility_center_desc').setRequired(flase);
                    record.set('responsibility_center_id', '');
                    record.set('responsibility_center_desc', '');
                    lovField.setLovPara('company_id', record.get('responsibility_company_id'));
                } else if (name == 'asset_source_type') {
                    var asset_id = record.get("asset_id");
                    // 删除成本来源信息
                    delete_assetCostMsg(asset_id);
                    var tabs = $("eam_batch_asset_management_tab");
                    var batch_create_num = record.get('batch_create_num');
                    if (batch_create_num == undefined) {
                        // Aurora.showErrorMessage('${l:PROMPT}', '批量新增数未维护!');
                        // return;
                    } else {
                        // 当取得来源为"在建工程结转","抵债资产转自用","换入"时,"成本来源"标签可编辑
                        // 当取得来源为"购置"时,也可编辑,但里面只可编辑[价值类型],[本次结转]两个字段.
                        if (value == "FROMCIP" || value == "FROMDEBT" || value == "TRANSFERIN") {
                            tabs.setEnabled(8);
                            if (value == "TRANSFERIN") {
            
                               }
                        } else {
                            tabs.setDisabled(8);
                        }
                    }
                } else if (name == 'quantity') {
                    var price = record.get('price');
                    record.set('cost', value * price);
                } else if (name == 'price') {
                    var quantity = record.get('quantity');
                    record.set('cost', value * quantity);
                } else if (name == 'gain_date' || name == 'start_use_date' || name == 'date_of_purchase') {
                    record.validate('start_use_date');
                    record.validate('date_of_purchase');
                    record.validate('gain_date');
                    /* } else if (name == 'start_use_date') {
                     record.validate('gain_date');
                     record.validate('date_of_purchase');
                     } else if (name == 'date_of_purchase') {
                     record.validate('gain_date');
                     record.validate('start_use_date'); */
                } else if (name == 'entity_class_id') {
            
                    if (record.get('asset_id')) {
                        $('eam_batch_eam_asset_character_values_result_ds').setQueryUrl("${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_character_values_query/query");
                        $('eam_batch_eam_asset_character_values_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                        $('eam_batch_eam_asset_character_values_result_ds').setQueryParameter('entity_class_id', value);
                        $('eam_batch_eam_asset_character_values_result_ds').query();
                    } else {
                        $('eam_batch_eam_asset_character_values_result_ds').setQueryUrl("${/request/@context_path}/autocrud/eam.eam0310.eam0310_asset_character_params_query/query");
                        $('eam_batch_eam_asset_character_values_result_ds').setQueryParameter('class_id', value);
                        $('eam_batch_eam_asset_character_values_result_ds').query();
                    }
                } else if (name == 'install_position') {
                    // if ($A.isEmpty(value)) {
                    // record.getMeta().getField('req_employee_name').setReadOnly(true);
                    // record.set('req_employee_name', '');
                    // } else {
                    // record.getMeta().getField('req_employee_name').setReadOnly(false);
                    // record.set('req_employee_name', '');
                    // record.getField('req_employee_name').setLovPara('location_id', record.get('location_id'));
                    // }
                } else if (name == 'tax'){
                    record.set('price_no_tax',record.get('price_tax') - value);
                    var transfer_rate = record.get('transfer_rate');
                    var price_no_tax = record.get('price_no_tax');
                    var quantity = record.get('quantity');
                    record.set('price',(transfer_rate * (value / 100)) + price_no_tax);
                    record.set('transfer_amount',transfer_rate * (value / 100));
                    record.set('cost',((transfer_rate * (value / 100)) + price_no_tax) * quantity);
                } else if (name == 'transfer_rate'){
                    var tax = record.get('tax');
                    var price_no_tax = record.get('price_no_tax');
                    var quantity = record.get('quantity');
                    record.set('price',(tax * (value / 100)) + price_no_tax);
                    record.set('transfer_amount',tax * (value / 100));
                    record.set('cost',((tax * (value / 100)) + price_no_tax) * quantity);
                } else if (name == 'price_no_tax'){
                    record.set('tax',record.get('price_tax') - value);
                    var tax = record.get('tax');
                    var transfer_rate = record.get('transfer_rate');
                    var quantity = record.get('quantity');
                    record.set('price',(tax * (transfer_rate / 100)) + value);
                    record.set('cost',((tax * (transfer_rate / 100)) + value) * quantity);
                } else if (name == 'price_tax'){
                      record.set('price_no_tax',value - record.get('tax'));
                }
            }
            
            function eam0810ValueEdit(record, name) {
                if (name == 'value') {
                    var data_type = record.get('data_type');
                    if (data_type == 'NUMERIC') {
                        return 'eam0810_character_values_nf';
                    } else if (data_type == 'TEXT') {
                        return 'eam0810_character_values_tf';
                    }
                }
            }
            
            // 删除成本来源
            
            function delete_assetCostMsg(asset_id) {
                if (asset_id) {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/eam.eam0310.eam0310_asset_cost_sources_edit/execute?asset_id=' + asset_id,
                        success: function(args) {
            
                           }
                    });
                }
            }
            
            //date_of_purchase  gain_date  start_use_date
            
            function dateValidate1(record, name, value) {
                if (name == 'rent_date_from' || name == 'rent_date_to') {
                    var rent_date_from = record.get('rent_date_from');
                    var rent_date_to = record.get('rent_date_to');
                    if (typeof(rent_date_from) != 'undefined' && !Ext.isEmpty(rent_date_from)) {
                        if (!compareDate(rent_date_from, rent_date_to)) {
                            // Aurora.showErrorMessage('${l:PROMPT}', '出租日期从不能晚于出租日期到！');
                            return '${l:EAM_ASSET_MANAGEMENT.RENT_DATE_VALIDATE}';
                        }
                    }
                    return true;
                }
            }
            
            function dateValidate2(record, name, value) {
                if (name == 'free_date_from' || name == 'free_date_to') {
                    var free_date_from = record.get('free_date_from');
                    var free_date_to = record.get('free_date_to');
                    if (typeof(free_date_from) != 'undefined' && !Ext.isEmpty(free_date_from)) {
                        if (!compareDate(free_date_from, free_date_to)) {
                            // Aurora.showErrorMessage('${l:PROMPT}', '免租日期从不能晚于免租日期到！');
                            return '${l:EAM_ASSET_MANAGEMENT.FREE_DATE_VALIDATE}';
                        }
                    }
                    return true;
                }
            }
            
            function compareDate(start, end) {
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            // 事务类型加载
            
            function onBatchTransFocusHandler() {
                var asset_book_id = '${/parameter/@asset_book_id}';
                var base_trx_category = 'ADD';
                $('eam_batch_trans_type_ds').setQueryParameter('base_trx_category', base_trx_category);
                $('eam_batch_trans_type_ds').setQueryParameter('asset_book_id', asset_book_id);
                $('eam_batch_trans_type_ds').query();
            }
            
            //校验批量新增数量大于等于1小于等于100
            
            function onBatchCreateNumHandler(Component, value, oldValue) {
                if (0 < value && value <= 500) {
                    var form_record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                    var asset_source_type = form_record.get("asset_source_type");
                    var tabs = $("eam_batch_asset_management_tab");
                    if (asset_source_type == "FROMCIP" || asset_source_type == "FROMDEBT" || asset_source_type == "TRANSFERIN") {
                        tabs.setEnabled(8);
                    } else {
                        tabs.setDisabled(8);
                    }
                    return;
                } else {
                    Aurora.showErrorMessage('${l:PROMPT}', '批量新增数量必须是1～500之间!');
                    return;
                }
            }
            
            // 返回
            
            function eam_batch_back() {
                $('eam0310_req_lines_ds').setQueryParameter('requisition_header_id', '${/parameter/@requisition_header_id}');
                $('eam0310_req_lines_ds').query();
                //存在原资产卡片号不能关联费用申请单，否则必须关联
                //jhcw 关联资产功能已注释
                // var ast_requisition_type_code = '${/parameter/@ast_requisition_type_code}';
                // if (ast_requisition_type_code == "QD006") {
                    // Aurora.request({
                        // url: '${/request/@context_path}/autocrud/eam.eam0311.eam0311_asset_check_add_release/query?requisition_header_id=${/parameter/@requisition_header_id}',
                        // success: function(args) {
                            // var check_flag = args.result.record.check_flag;
                            // if (check_flag == 'Y') { //存在原卡片号
                                // $('addButton').disable();
                                // c_static_param = false;
                            // } else {
                                // $('addButton').enable();
                                // c_static_param = true;
                            // }
                        // }
                    // });
                // }
                $('eam0310_batch_assetManage_screen').close();
            }
            
            //
            
            function onCostSourceAdd(dataSet, record, index) {
                var form_record = $("eam0810_asset_management_result_ds").getCurrentRecord();
            
                var batch_create_num = form_record.get('batch_create_num');
                if (batch_create_num == undefined) {
                    Aurora.showErrorMessage('${l:PROMPT}', '批量新增数未维护!');
                    return;
                } else {
                    var asset_source_type = form_record.get("asset_source_type");
                    var asset_source_type_desc = form_record.get("asset_source_type_desc");
                    record.set('source_type', asset_source_type);
                    record.set('source_type_desc', asset_source_type_desc);
            
                    var default_value_type = '${/model/req_header/record/@value_type}';
            
                    if (default_value_type == 'FINAL') {
                        record.getMeta().getField('cost_value_type_desc').setReadOnly(true);
                    }
            
                    record.set('cost_value_type', default_value_type);
                    switch (asset_source_type) {
                        // 在建工程结转
                    case 'FROMCIP':
                        //  能选择的源对象号资产分类为在建工程的,状态为建设中的资产,[价值类型] 可编辑,且值为"决算价"或"暂估价",默认值为"决算价"
                        record.getField("source_asset_code").setLovPara('status', 'IN_PROCESS');
                        record.getField("source_asset_code").setLovPara('asset_type', 'CIP');
                        record.getField("cost").setRequired(true);
                        break;
                        // 抵债转自用
                    case 'FROMDEBT':
                        // 能选择的源对象为资产分类为抵债资产,且状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                        record.getField("source_asset_code").setLovService("eam.eam0310.eam0310_source_asset_for_debt");
                        record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                        record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                        break;
                        // 换入
                    case 'TRANSFERIN':
                        // 能选择源对象为固定资产或无形资产及状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                        record.getField("source_asset_code").setLovService('eam.eam0310.eam0310_source_asset_for_trans');
                        record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                        record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                        break;
                        // 购置
                        /* case 'PURCHASE':
                         record.set('cost_value_type', 'FINAL');
                         record.getMeta().getField('source_asset_code').setReadOnly(true);
                         record.getMeta().getField('source_asset_code').setRequired(false);
                         break;  */
                    }
                }
            }
            
            //
            
            function costValidator(record, name, value) {
                var source_asset_cost = record.get("source_asset_cost");
                var source_asset_sum_cost = record.get("source_asset_sum_cost");
            
                var cost = record.get("cost");
                var cost_value_type = record.get("cost_value_type");
            
                source_asset_cost = !source_asset_cost ? 0 : source_asset_cost;
                source_asset_sum_cost = !source_asset_sum_cost ? 0 : source_asset_sum_cost;
            
                var avaliable_cost = source_asset_cost - source_asset_sum_cost;
            
                if (avaliable_cost > 0 && value > avaliable_cost) {
                    return '本次结转金额不得大于剩余可结转金额';
                }
            
                var record = $("eam0810_asset_management_result_ds").getCurrentRecord();
                var batch_create_num = record.get('batch_create_num');
            
                if (0 < batch_create_num) {
                    if (source_asset_cost >= batch_create_num * value) return;
                    else return '批量新增资产台账成本来源：本次结转不能大于源对象成本!';
                } else {
                    return '批量新增数未维护!';
                }
            
                return true;
            }
            
            //
            
            function onCostSelectHandler(tab, index) {
            
                if (index == 6) {
                    var eam_record = $('eam0810_asset_management_result_ds').getAt(0);
                    var rs = $('eam_batch_asset_allocate_element_type_ds').getAt(0);
                    if (!eam_record.get('allocate_element_type_desc')) {
                        eam_record.set('allocate_element_type_desc', rs.get('code_value_name'));
                        eam_record.set('allocate_element_type', rs.get('code_value'));
                    }
                }
            
                // if (index == 8) {
            
                // var form_record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                // var asset_source_type = form_record.get("asset_source_type");
                // var asset_id = form_record.get("asset_id");
                // if (asset_id) {
                // $('eam_batch_cost_source_ds').setQueryParameter('asset_id', asset_id);
                // $('eam_batch_cost_source_ds').query();
                // }
                // //  else {
                // $('eam_batch_cost_source_ds').removeAll();
                // //}  //@Spencer 3893 20130619 选择tab页时当取得来源非"在建工程结转","抵债资产转自用","换入"时,"成本来源"成本来源清空
            
                // var records = $('eam_batch_cost_source_ds').getAll();
                // for (var i = 0;i < records.length;i++) {
                // var record = records[i];
            
                // var default_value_type = '${/model/req_header/record/@value_type}';
            
                // if (default_value_type == 'FINAL') {
                // record.getMeta().getField('cost_value_type_desc').setReadOnly(true);
                // }
            
                // record.set('cost_value_type', default_value_type);
                // switch (asset_source_type) {
                // // 在建工程结转
                // case 'FROMCIP':
                // //  能选择的源对象号资产分类为在建工程的,状态为建设中的资产,[价值类型] 可编辑,且值为"决算价"或"暂估价",默认值为"决算价"
                // record.getField("source_asset_code").setLovPara('status', 'IN_PROCESS');
                // record.getField("source_asset_code").setLovPara('asset_type', 'CIP');
                // record.getField("cost").setRequired(true);
                // //
                // break;
                // // 抵债转自用
                // case 'FROMDEBT':
                // // 能选择的源对象为资产分类为抵债资产,且状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                // record.getField("source_asset_code").setLovService("eam.eam0310.eam0310_source_asset_for_debt");
                // record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                // record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                // break;
                // // 换入
                // case 'TRANSFERIN':
                // // 能选择源对象为固定资产或无形资产及状态为USING的资产,[价值类型] 不可编辑,且值为"决算价"
                // record.getField("source_asset_code").setLovService('eam.eam0310.eam0310_source_asset_for_trans');
                // record.getField("source_asset_code").setLovPara("asset_book_id", '${/parameter/@asset_book_id}');
                // record.getField("source_asset_code").setLovPara("asset_id", '${/parameter/@input_asset_id}');
                // break;
                // // 购置
                // // case 'PURCHASE':
                // //record.getMeta().getField('source_asset_code').setReadOnly(true);
                // //record.getMeta().getField('source_asset_code').setRequired(false);
                // //break;
                // }
                // }
                // }
            }
            
            // 保存之前应当先校验时否已经有资产id
            
            function beforeCostSubmit() {
                var asset_id = $('eam0810_asset_management_result_ds').getCurrentRecord().get("asset_id");
                if (!asset_id) {
                    alert("${l:EAM_ASSET_PARTNER_INFO.DO_SAVE_EAM_ASSET_HEADERS}");
                    return false;
                } else {
                    var cost_ds = $('eam_batch_cost_source_ds').getAll();
                    var source_ids = [];
                    for (var i = 0;i < cost_ds.length;i++) {
                        var record = $('eam_batch_cost_source_ds').getAt(i);
                        record.set("asset_id", asset_id);
                        if (i == 0) {
                            source_ids.push(record.get("source_asset_id"));
                        }
                        var exists = false;
                        for (var j = 0;j < source_ids.length;j++) {
                            if (source_ids[j] == record.get("source_asset_id")) {
                                exists = true;
                                break;
                            }
                        }
                        if (!exists) {
                            source_ids.push(record.get("source_asset_id"));
                        }
                    }
                    if (source_ids.length < cost_ds.length) {
                        alert("源对象不能重复！");
                        return false;
                    }
                }
            }
            
            function onEntityBeforeSubmitFun(ds) {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var asset_id = categories_record.get('asset_id');
                if (asset_id == ' ' || asset_id == null || asset_id == undefined) {
                    Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.DO_SAVE_EAM_ASSET_HEADERS}');
                    return false;
                }
                var result_ds = $('eam_batch_eam_asset_character_values_result_ds');
                if (result_ds.validate()) {
                    var records = result_ds.getAll();
                    if (records.length < 1) {
                        Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.ADD_DATA}');
                    } else {
                        for (var i = 0;i < records.length;i++) {
                            var record = records[i];
                            if (record.get("asset_id")) {
                                record.set("_status", 'update');
                            } else {
                                record.set("_status", 'insert');
                            }
                            record.set('asset_id', '${/parameter/@input_asset_id}');
                        }
                    }
                }
            }
            
            function eamBatchValueEdit(record, name) {
                if (name == 'value') {
                    var data_type = record.get('data_type');
                    if (data_type == 'NUMERIC') {
                        return 'eam_batch_character_values_nf';
                    } else if (data_type == 'TEXT') {
                        return 'eam_batch_character_values_tf';
                    }
                }
            }
            
            function onAssetCharacterValuesLoad(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    var required_flag = records[i].get('required_flag');
                    if (required_flag == 'Y') {
                        records[i].getMeta().getField('value').setRequired(true);
                    }
                }
            }
            
            function onAllocationUpdateFun(dataSet, record, name, value) {
                /*             	if(name == 'company_desc'){
                 lovField = record.getField("company_desc");
                 lovField.setLovPara('asset_book_id', $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_book_id'));
                 }
                 */
                if (name == 'company_id') {
                    lovField = record.getField("responsibility_center_desc");
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.set('responsibility_center_id', '');
                    record.set('responsibility_center_desc', '');
                    lovField.setLovPara('company_id', record.get('company_id'));
                }
            }
            
            function gridAllocationsCellClick(grid, row, name, record) {
                var MetaData = record.getMeta();
                if (name == 'responsibility_center_desc') {
                    var MetaField1 = MetaData.getField('responsibility_center_desc');
                    MetaField1.setLovPara('company_id', $('eam_batch_eam_asset_allocations_result_ds').getCurrentRecord().get('company_id'));
                }
                if (name == 'company_desc') {
                    //alert($('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_book_id'));
                    var MetaField2 = MetaData.getField('company_desc');
                    MetaField2.setLovPara('asset_book_id', $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_book_id'));
                }
            }
            
            function onEntityBeforeSubmitFun(ds) {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var asset_id = categories_record.get('asset_id');
                var allocate_element_type = categories_record.get('allocate_element_type');
                if (asset_id == ' ' || asset_id == null || asset_id == undefined) {
                    Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.DO_SAVE_EAM_ASSET_HEADERS}');
                    return false;
                }
                var result_ds = $('eam_batch_eam_asset_allocations_result_ds');
                if (result_ds.validate()) {
                    var records = result_ds.getAll();
                    if (records.length < 1) {
                        Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.ADD_DATA}');
                        return false;
                    } else {
                        for (var i = 0;i < records.length;i++) {
                            var record = records[i];
                            record.set('asset_id', asset_id);
                        }
                    }
                }
            
            }
            
            function allocation_init() {
                if ($('eam0810_asset_management_result_ds').getCurrentRecord()) {
                    if ($('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_id') != undefined && $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_id') != '' && $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_id') != null) {
                        $('eam_batch_eam_asset_allocations_result_ds').setQueryParameter('asset_id', $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_id'));
                        $('eam_batch_eam_asset_allocations_result_ds').query();
                    }
                }
            }
            
            function onSave() {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var allocate_element_type = categories_record.get('allocate_element_type');
                var result_ds = $('eam_batch_eam_asset_allocations_result_ds');
                //mantis24468 当因子类型为比率时,保存分配记录时,先校验分配数量的和是否为1,不为1则报错.
                if (allocate_element_type == 'RATIO') {
            
                    var rs = result_ds.getAll();
                    var sum = 0;
                    for (var j = 0;j < rs.length;j++) {
                        var r = rs[j];
                        sum += r.get('quantity');
                    }
                    if (sum != 1) {
                        Aurora.showErrorMessage('${l:PROMPT}', '${l:EAM_ASSET_ALLOCATIONS.ALLOCATE_ELEMENT_TYPE}');
                        return;
                    }
                }
                $('eam_batch_eam_asset_allocations_result_ds').submit();
            }
            
            function onBlurStartUseDateFun() {
                var record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                if (record) {
                    var gain_date = record.get('gain_date');
                    var start_use_date = record.get('start_use_date');
                    if (typeof(start_use_date) != 'undefined' && !Ext.isEmpty(start_use_date)) {
                        if (!compareDate(gain_date, start_use_date)) {
                            return '${l:EAM_ASSET_HEADERS.START_USE_DATE_VALIDATE}';
                        }
                    }
                    return true;
                }
            }
            
            //资产大类
            var category_value = '';
            
            function categorySelectFun(combox, value, display, rs) {
                var headDataSet = $('eam0810_asset_management_result_ds');
                var record = headDataSet.getAt(0);
                //资产类别选择固定资产或无形资产或长期待摊费用或在建工程时，批准文号必输
                if (record.get('category_code') == '10' || record.get('category_code') == '30' || record.get('category_code') == '40' || record.get('category_code') == '50') {
                    //record.getField("reference_number").setRequired(true);
                } else {
                    // record.getField("reference_number").setRequired(false);
                }
                var ds = $('eam_batch_asset_categories_list2_ds');
                ds.setQueryParameter('asset_book_id', record.get('asset_book_id') || -1);
                ds.setQueryParameter('category_id', record.get('category_id') || -1);
                ds.setQueryParameter('entity_unit_id', record.get('entity_unit_id') || -1);
                ds.setQueryParameter('ast_requisition_type_id', parseInt('${/parameter/@ast_requisition_type_id}') || -1);
                ds.query();
                if (category_value == '') {
                    category_value = value;
                }
                if (category_value != value) {
                    record.set('category_sec_desc', '');
                    record.set('category_sec_id', '');
                    record.set('fin_class_desc', '');
                    record.set('fin_class_id', '');
                    record.set('entity_class_desc', '');
                    record.set('entity_class_id', '');
                    record.set('entity_sub_class_desc', '');
                    record.set('entity_sub_class_code', '');
                    record.set('entity_sub_classes_id', '');
                    category_value = value;
                }
            }
            
            //如资产大类没有值，提示进行维护
            
            function categoryFocusFun(combox) {
                var ast_requisition_type_id = '${/parameter/@ast_requisition_type_id}';
                var categories_record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                var entity_unit_id = categories_record.get('entity_unit_id');
                if (entity_unit_id == 'undefined' || entity_unit_id == '') {
                    Aurora.showErrorMessage('${l:PROMPT}', '请选择管理部门！');
                }
                var rs = $('eam_batch_asset_categories_list_ds').getAt(0);
                if (rs == 'undefined' || rs == null) {
                    Aurora.showErrorMessage('${l:PROMPT}', '当前申请类型未维护资产分类！');
                }
            }
            
            //资产小类
            var category_sec_value = '';
            
            function category_secSelectFun(combox, value, display, rs) {
                var headDataSet = $('eam0810_asset_management_result_ds'); //财务分类
                var record = headDataSet.getAt(0);
                var ds = $('eam_batch_asset_fin_class_list_ds');
                ds.setQueryParameter('asset_book_id', record.get('asset_book_id') || -1);
                ds.setQueryParameter('category_id', record.get('category_id') || -1);
                ds.setQueryParameter('category_sec_id', record.get('category_sec_id') || -1);
                ds.setQueryParameter('entity_unit_id', record.get('entity_unit_id') || -1);
                ds.setQueryParameter('ast_requisition_type_id', parseInt('${/parameter/@ast_requisition_type_id}') || -1);
                ds.query();
                if (category_sec_value == '') {
                    category_sec_value = value;
                }
                if (category_sec_value != value) {
                    record.set('fin_class_desc', '');
                    record.set('fin_class_id', '');
                    record.set('entity_class_desc', '');
                    record.set('entity_class_id', '');
                    record.set('entity_sub_class_desc', '');
                    record.set('entity_sub_class_code', '');
                    record.set('entity_sub_classes_id', '');
                    category_sec_value = value;
                }
            }
            
            //财务分类
            var fin_value = '';
            
            function finSelectFun(combox, value, display, rs) {
                var headDataSet = $('eam0810_asset_management_result_ds'); //实物分类
                var record = headDataSet.getAt(0);
                var ds = $('eam_batch_asset_entity_class_list_ds');
                ds.setQueryParameter('category_id', record.get('category_id') || -1);
                ds.setQueryParameter('asset_book_id', record.get('asset_book_id') || -1);
                ds.setQueryParameter('category_sec_id', record.get('category_sec_id') || -1);
                ds.setQueryParameter('fin_class_id', record.get('fin_class_id') || -1);
                ds.setQueryParameter('entity_unit_id', record.get('entity_unit_id') || -1);
                ds.setQueryParameter('ast_requisition_type_id', parseInt('${/parameter/@ast_requisition_type_id}') || -1);
                ds.query();
                if (fin_value == '') {
                    fin_value = value;
                }
                if (fin_value != value) {
                    record.set('entity_class_desc', '');
                    record.set('entity_class_id', '');
                    record.set('entity_sub_class_desc', '');
                    record.set('entity_sub_class_code', '');
                    record.set('entity_sub_classes_id', '');
                    fin_value = value;
                }
            }
            
            function unitSelectFun(lov, r1, r2) {
                var using_unit_id = r1.get('using_unit_id');
                var headDataSet = $('eam0810_asset_management_result_ds');
                var record = headDataSet.getAt(0);
                //责任中心
                var lovField = record.getField("responsibility_center_desc");
                lovField.setLovPara('unit_id', using_unit_id);
                record.set('responsibility_center_desc', '');
                record.set('responsibility_center_id', '');
                //自动赋值
                var center_name_code_display = '';
                var responsibility_center_id = '';
                var company_id = '';
                Aurora.request({
                    url: '${/request/@context_path}/autocrud/eam.eam_responsibility_center_lov/query?asset_book_id=${/parameter/@asset_book_id}&unit_id=' + using_unit_id,
                    success: function(args) {
                        center_name_code_display = args.result.record.center_name_code_display;
                        responsibility_center_id = args.result.record.responsibility_center_id;
                        company_id = args.result.record.company_id;
                        record.set('responsibility_center_desc', center_name_code_display);
                        record.set('responsibility_center_id', responsibility_center_id);
                        record.set('responsibility_company_id', company_id);
                    }
                });
                //使用人
                // by whf 20160203
                // lovField = record.getField("req_employee_name");
                // lovField.setLovPara('using_unit_id', using_unit_id);
                // record.set('req_employee_name', '');
                // record.set('to_employee_id', '');
            }
            
            //选择对应资产用途
            var entity_value = '';
            
            function entitySelectFun(combox, value, display, rs) {
                var headDataSet = $('eam0810_asset_management_result_ds'); //资产用途
                var record = headDataSet.getAt(0);
                var ds = $('eam0810_asset_usage_type_ds');
                ds.setQueryParameter('entity_class_id', record.get('entity_class_id') || -1);
                ds.query();
            
                record.set('entity_sub_class_desc', '');
                record.set('entity_sub_class_code', '');
                record.set('entity_sub_classes_id', '');
                var ds1 = $('eam0810_asset_entity_sub_class_list_ds');
                ds1.setQueryParameter('entity_class_id', record.get('entity_class_id') || -1);
                ds1.query();
                if (entity_value == '') {
                    entity_value = value;
                }
                if (entity_value != value) {
                    record = $('eam0810_eam_asset_lease_info_result_ds').getAt(0);
                    if (record) {
                        record.set('asset_usage_desc', '');
                        record.set('asset_usage', '');
                    }
                    entity_value = value;
                }
            }
            
            //管理部门lov点击之前，设置部门id
            
            // function entityUnitBeforeFun(lov) {
            // var headDataSet = $('eam0810_asset_management_result_ds');
            // var record = headDataSet.getAt(0);
            // //责任中心
            // var lovField = record.getField("entity_unit_desc");
            // lovField.setLovPara('unit_id', '${/parameter/@entity_unit_id}');
            // }
            
            function entityUnitSelectFun(lov, r1, r2) {
                var entity_unit_id = r1.get('entity_unit_id');
                r1.getField("req_employee_name").setLovPara('unit_id', entity_unit_id);
                var ast_requisition_type_id = '${/parameter/@ast_requisition_type_id}';
                $('eam_batch_asset_categories_list_ds').setQueryParameter('ast_requisition_type_id', parseInt(ast_requisition_type_id));
                $('eam_batch_asset_categories_list_ds').setQueryParameter('asset_book_id', '${/parameter/@asset_book_id}');
                $('eam_batch_asset_categories_list_ds').setQueryParameter('entity_unit_id', entity_unit_id);
                $('eam_batch_asset_categories_list_ds').reset();
                $('eam_batch_asset_categories_list_ds').query();
            }
            
            function onRecordFlagChange(combox, value, oldValue) {
                var li_record = $("eam0810_eam_asset_lease_info_result_ds").getCurrentRecord();
                if ('Y' == value) {
                    li_record.getMeta().getField('house_rent_num').setRequired(true);
                    li_record.getMeta().getField('management_cost').setRequired(true);
                } else {
                    li_record.getMeta().getField('house_rent_num').setRequired(false);
                    li_record.getMeta().getField('management_cost').setRequired(false);
                }
            }
            
            function onAssetManLoadFn(ds) {
                
                //jhyh
                var ast_requisition_type_code = '${/parameter/@ast_requisition_type_code}';
                var record = $('eam0810_eam_asset_lease_info_result_ds').getAt(0);
                if (Ext.isEmpty(record) && (ast_requisition_type_code == 'QD004' || ast_requisition_type_code == 'QD005')) {
                    $('eam0810_eam_asset_lease_info_result_ds').create();
                    record = $('eam0810_eam_asset_lease_info_result_ds').getAt(0);
                }
                var count = ds.getAll().length;
                if (count == 0) {
                    record.getField('asset_usage_desc').setRequired(false);
                } else {
                    record.getField('asset_usage_desc').setRequired(true);
                }
            }
            //低值易耗品取得验收时，单价应控制大于等于2000, 且小于等于4000
            var dzyh_min_value = '${/model/asset_parameter_query/record/@dzyh_min_value}';
            var dzyh_max_value = '${/model/asset_parameter_query/record/@dzyh_max_value}';
            
            function priceValidator(record, name, value) {
                /* var ast_requisition_type_code = '${/parameter/@ast_requisition_type_code}';
                
                if (ast_requisition_type_code == 'QD002') {
                    if (value < dzyh_min_value || value >= dzyh_max_value) {
                        return '低值易耗品的单价金额不能小于' + dzyh_min_value + '，且不能大于等于' + dzyh_max_value;
                    }
                }
                if (ast_requisition_type_code == 'QD001') {
                    if (value < 5000 ) {
                        return '固定资产的单价金额必须大于等于5000';
                    }
                } */
                return true;
            }
            
            function subClassQuery(ds) {
                var headDataSet = $('eam0810_asset_management_result_ds'); //资产用途
                var record = headDataSet.getAt(0);
                if (ds.getAll().length > 0) {
                    record.getField("entity_sub_class_desc").setReadOnly(false);
                    record.getField("entity_sub_class_desc").setRequired(true);
                } else {
                    record.getField("entity_sub_class_desc").setReadOnly(true);
                    record.getField("entity_sub_class_desc").setRequired(false);
                }
            }
            
            function dateValidate3(record, name, value) {
            
            
                // // var  date_mon=record.get('start_use_date').getMonth();
                // // var  date_year=record.get('start_use_date').getYear();
                // var  date_mon=value.getMonth();
                // var  date_year=value.getYear();
            
                // var  dateNow=new Date();
                // var now_mon=dateNow.getMonth();
                // var now_year=dateNow.getYear();
                // if(now_year<date_year){
                // return '启用日期只能选择当前或者之前月份的某一天';
                // }else { if(now_mon<date_mon){
                // return '启用日期只能选择当前或者之前月份的某一天';
                // }
                // }
                return true;
            }
            function rateValidator(record, name, value) {
                if (value > 100 ) {
                    return '比率应在0%到100%之间';
                }
                return true;
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="eam_batch_trans_type_ds">
                <a:datas dataSource="/model/eam_batch_transaction_types"/>
            </a:dataSet>
            <a:dataSet id="eam_batch_asset_books_list_ds">
                <a:datas dataSource="/model/eam_batch_asset_books_list"/>
            </a:dataSet>
            <a:dataSet id="eam_batch_asset_source_type_ds">
                <a:datas dataSource="/model/req_type_source_type"/>
            </a:dataSet>
            <a:dataSet id="eam_currency_ds">
                <a:datas dataSource="/model/eam_currency"/>
            </a:dataSet>
            <a:dataSet id="eam0310_payment_cycle_ds" lookupcode="PAYMENT_CYCLE"/>
            <a:dataSet id="eam0810_asset_usage_type_ds" model="eam.eam0810.eam0810_asset_usage_type_cmb">
                <a:events>
                    <a:event name="load" handler="onAssetManLoadFn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam_batch_asset_status_ds" lookupCode="EAM_ASSET_STATUS"/>
            <a:dataSet id="eam_batch_asset_fin_class_list_ds" model="eam.eam0810.eam0810_asset_fin_class_cmb"/>
            <a:dataSet id="eam_batch_asset_categories_list2_ds" model="eam.eam0810.eam0810_asset_categories2_cmb"/>
            <a:dataSet id="eam_batch_asset_entity_class_list_ds" model="eam.eam0810.eam0810_asset_entity_class_cmb"/>
            <a:dataSet id="eam0810_asset_entity_sub_class_list_ds" model="eam.eam0020.eam_asset_entity_sub_classes">
                <a:events>
                    <a:event name="load" handler="subClassQuery"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam_batch_currency_ds">
                <a:datas dataSource="/model/eam_currency"/>
            </a:dataSet>
            <a:dataSet id="eam0310_trans_type_ds">
                <a:datas dataSource="/model/eam0310_transaction_types"/>
            </a:dataSet>
            <a:dataSet id="eam_batch_v_type_ds" lookupCode="EAM_VALUE_TYPE"/>
            <a:dataSet id="eam0310_u_measurement_ds" lookupcode="UNITS_OF_MEASUREMENT"/>
            <!--资产大类-->
            <a:dataSet id="eam_batch_asset_categories_list_ds" model="eam.eam0311.eam0311_asset_categories_query">
                <a:fields>
                    <a:field name="asset_category_id"/>
                    <a:field name="asset_category_code"/>
                    <a:field name="asset_category_name"/>
                </a:fields>
            </a:dataSet>
            <!-- 责任中心 -->
            <a:dataSet id="eam0310_responsibility_center_ds" autoCreate="true" autoQuery="true" model="eam.eam_responsibility_center_lov">
                <a:fields>
                    <a:field name="responsibility_center_id"/>
                    <a:field name="center_name_code_display"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="eam_batch_asset_allocate_element_type_ds" lookupCode="EAM_ALLOCATE_ELEMENT_TYPE"/>
            <a:dataSet id="eam0810_asset_management_result_ds" autoCreate="true" autoPageSize="true" model="eam.eam0311.eam0311_asset_headers_query" selectable="true" selectionModel="single" submitUrl="${/request/@context_path}/modules/eam/EAM0310/eam_asset_management_batch_save.svc">
                <a:fields>
                    <!--<a:field name="req_employee_name" defaultValue="${/model/eam0310_user_msg/record/@employee_name}" displayField="employee_name" options="eam0310_employee_ds" prompt="EAM_REQUISITION_TYPES.AST_REQUISITION_PROPOSER" returnField="employee_id" valueField="employee_id"/>-->
                    <a:field name="to_employee_id"/>
                    <a:field name="req_employee_name" autoComplete="true" autoCompleteField="name" lovGridHeight="300" lovHeight="425" lovService="eam.eam0311.eam0311_employee_assigns_lov" lovWidth="380" title="员工选择">
                        <a:mapping>
                            <a:map from="name" to="req_employee_name"/>
                            <a:map from="employee_id" to="to_employee_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="value_type" defaultValue="${/model/req_header/record/@value_type}"/>
                    <a:field name="currency_code" defaultValue="${/model/eam_default_currency/record/@currency_code}" prompt="CSH_PAYMENT.CURRENCY_CODE"/>
                    <a:field name="currency_desc" defaultValue="${/model/eam_default_currency/record/@currency_name}" displayField="currency_name" options="eam_batch_currency_ds" prompt="EAM_ASSET_FINANCE_INFO.CURRENCY_NAME" required="true" returnField="currency_code" valueField="currency_code"/>
                    <a:field name="asset_id" readOnly="true"/>
                    <a:field name="brand"/>
                    <a:field name="model_number"/>
                    <!--<a:field name="supplier"/>-->
                    <a:field name="requisition_header_id"/>
                    <a:field name="requisition_line_id"/>
                    <!--<a:field name="description" prompt="EAM_ASSET_HEADERS.DESCRIPTION" required="true" readOnly="true" />-->
                    <a:field name="description" prompt="EAM_ASSET_HEADERS.DESCRIPTION" required="true"/>
                    <a:field name="asset_book_id" defaultValue="${/parameter/@asset_book_id}"/>
                    <a:field name="transaction_type_id" defaultValue="${/model/default_transaction_type/record/@transaction_type_id}"/>
                    <a:field name="transaction_type" defaultValue="${/model/default_transaction_type/record/@description}" displayField="description" options="eam0310_trans_type_ds" prompt="EAM_REQUISITION_TYPES.DEFAULT_TRX_TYPE_DESC" returnField="transaction_type_id" valueField="transaction_type_id"/>
                    <a:field name="contract_header_id"/>
                    <a:field name="contract_name" lovGridHeight="300" lovHeight="460" lovService="eam.eam0310.eam0310_csh_contract_lov" lovWidth="500" prompt="CON_CONTRACT_HEADERS.CONTRACT_NUMBER" title="CON_CONTRACT_HEADERS.CONTRACT_NUMBER">
                        <a:mapping>
                            <a:map from="contract_number" to="contract_name"/>
                            <a:map from="contract_header_id" to="contract_header_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="req_desc" prompt="SYS_SESSION.NOTE"/>
                    <a:field name="asset_book_desc" displayField="asset_book_desc" options="eam_batch_asset_books_list_ds" prompt="EAM_ASSET_CATEGORIES.ASSET_BOOK" returnField="asset_book_id" valueField="asset_book_id"/>
                    <a:field name="asset_code" prompt="资产编号"/>
                    <a:field name="tag_number" prompt="EAM_ASSET_HEADERS.TAG_NUMBER" readOnly="true"/>
                    <a:field name="status_desc" defaultValue="${/model/eam0310_asset_status/record/@status_desc}" prompt="EAM_ASSET_HEADERS.STATUS" readOnly="true"/>
                    <a:field name="serial_number" prompt="EAM_ASSET_HEADERS.SERIAL_NUMBER"/>
                    <a:field name="asset_source_type"/>
                    <a:field name="asset_source_type_desc" displayField="source_code_value_name" options="eam_batch_asset_source_type_ds" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE" required="true" returnField="asset_source_type" valueField="source_code_value"/>
                    <a:field name="lock_flag" checkedValue="Y" defaultValue="N" prompt="EAM_ASSET_HEADERS.LOCK_FLAG" uncheckedValue="N"/>
                    <a:field name="date_of_purchase" prompt="EAM_ASSET_HEADERS.DATE_OF_PURCHASE"/>
                    <a:field name="gain_date" defaultValue="${/model/sysdate/record/@sys_date}" prompt="EAM_ASSET_HEADERS.GAIN_DATE"/>
                    <a:field name="start_use_date" prompt="EAM_ASSET_HEADERS.START_USE_DATE" required="true" validator="dateValidate3"/>
                    <a:field name="asset_unit" prompt="EAM_ASSET_HEADERS.ASSET_UNIT"/>
                    <a:field name="asset_unit_desc" displayField="code_value_name" options="eam0310_u_measurement_ds" prompt="EAM_ASSET_HEADERS.ASSET_UNIT" required="false" returnField="asset_unit" valueField="code_value"/>
                    <!--<a:field name="supplier" autoComplete="true" autoCompleteField="code_name" lovGridHeight="320" lovHeight="460" lovWidth="520" lovservice="expm.exp_vender_req_lov" prompt="EXP_REPORT_HEADERS.PAYEE_ID">
                        <a:mapping>
                            <a:map from="description" to="supplier"/>
                        </a:mapping>
                    </a:field>-->
                    <a:field name="supplier"/>
                    <a:field name="quantity" defaultValue="1" prompt="EAM_ASSET_HEADERS.QUANTITY" readOnly="true"/>
                    <a:field name="cost" prompt="EAM_ASSET_HEADERS.COST" readOnly="true"/>
                    <a:field name="category_id"/>
                    <a:field name="category_code"/>
                    <a:field name="category_desc" displayField="asset_category_name" options="eam_batch_asset_categories_list_ds" prompt="资产大类" required="true" returnField="category_id" valueField="asset_category_id">
                        <a:mapping>
                            <a:map from="asset_category_code" to="category_code"/>
                        </a:mapping>
                    </a:field>
                    <!-- <a:field name="entity_class_id"/>
                    <a:field name="entity_class_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0310.eam0310_asset_entity_class_lov?ast_requisition_type_id=${/parameter/@ast_requisition_type_id}" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_CLASS_ID" required="true" title="EAM_ASSET_HEADERS.ENTITY_CLASS_ID">
                        <a:mapping>
                            <a:map from="class_id" to="entity_class_id"/>
                            <a:map from="description" to="entity_class_desc"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="category_sec_id"/>
                    <a:field name="category_sec_desc" displayField="description_sec" options="eam_batch_asset_categories_list2_ds" prompt="资产小类" required="true" returnField="category_id" valueField="category_id">
                        <a:mapping>
                            <a:map from="category_sec_id" to="category_sec_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="fin_class_id"/>
                    <a:field name="fin_class_code"/>
                    <a:field name="fin_class_desc" displayField="description" options="eam_batch_asset_fin_class_list_ds" prompt="EAM_ASSET_HEADERS.FIN_CLASS_ID" required="true" returnField="fin_class_id" valueField="class_id">
                        <a:mapping>
                            <a:map from="class_code" to="fin_class_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_class_id"/>
                    <a:field name="entity_class_desc" displayField="description" options="eam_batch_asset_entity_class_list_ds" prompt="EAM_ASSET_HEADERS.ENTITY_CLASS_ID" required="true" returnField="entity_class_id" valueField="class_id"/>
                    <a:field name="entity_sub_classes_id"/>
                    <a:field name="entity_sub_class_code"/>
                    <a:field name="entity_sub_class_desc" displayField="description" options="eam0810_asset_entity_sub_class_list_ds" prompt="资产实物明细分类" returnField="entity_sub_classes_id" valueField="entity_sub_class_id">
                        <a:mapping>
                            <a:map from="entity_sub_class_code" to="entity_sub_class_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="location_id"/>
                    <a:field name="to_location_id"/>
                    <a:field name="install_position" prompt="物理位置"/>
                    <a:field name="using_unit_old_desc" readOnly="true"/>
                    <!--<a:field name="install_position" lovGridHeight="300" lovHeight="420" lovUrl="eam_asset_management_location_with_type_lov.screen?asset_book_id=${/parameter/@asset_book_id}" lovWidth="850" prompt="EAM_ASSET_HEADERS.INSTALL_POSITION" required="true" title="EAM_ASSET_HEADERS.INSTALL_POSITION">
                        <a:mapping>
                            <a:map from="location_id" to="location_id"/>
                            <a:map from="location_code" to="location_code"/>
                            <a:map from="description" to="install_position"/>
                            <a:map from="location_type_desc" to="location_type_desc"/>
                             <a:map from="value_man_company_id" to="value_man_company_id"/>
                            <a:map from="value_man_company_desc" to="value_man_company_desc"/>
                            <a:map from="value_man_unit_id" to="value_man_unit_id"/>
                            <a:map from="value_man_unit_desc" to="value_man_unit_desc"/>
                            <a:map from="value_man_position_id" to="value_man_position_id"/>
                            <a:map from="value_man_position_desc" to="value_man_position_desc"/>
                            <a:map from="value_man_company_id" to="entity_company_id"/>
                            <a:map from="value_man_company_desc" to="entity_man_company_desc"/>
                            <a:map from="entity_unit_id" to="entity_unit_id"/>
                            <a:map from="entity_unit_desc" to="entity_unit_desc"/>
                            <a:map from="entity_man_position_desc" to="entity_man_position_desc"/>
                            <a:map from="entity_position_id" to="entity_position_id"/>
                            <a:map from="responsibility_company_id" to="responsibility_company_id"/>
                            <a:map from="responsibility_company_desc" to="responsibility_company_desc"/>
                            <a:map from="responsibility_center_id" to="responsibility_center_id"/>
                            <a:map from="responsibility_center_desc" to="responsibility_center_desc"/> 
                        </a:mapping>
                    </a:field>-->
                    <a:field name="location_type_desc" prompt="EAM_LOCATIONS.LOCATION_TYPE" readOnly="true"/>
                    <a:field name="value_man_company_id"/>
                    <a:field name="value_man_company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_COMPANY_ID" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_id" to="value_man_company_id"/>
                            <a:map from="company_short_name" to="value_man_company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="value_man_unit_id"/>
                    <a:field name="value_man_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_UNIT_ID" readOnly="true" title="PUR_REQUISITION_ALLOCATE.UNIT_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="unit_id" to="value_man_unit_id"/>
                            <a:map from="unit_code_name" to="value_man_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="value_man_position_id"/>
                    <a:field name="value_man_position_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_position_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_POSITION_ID" readOnly="true" title="BGT_BUDGET_ITEM_MAPPING.POSITION_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="position_id" to="value_man_position_id"/>
                            <a:map from="position_code_name" to="value_man_position_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_company_id"/>
                    <a:field name="entity_man_company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_MAN_COMPANY_ID" required="true" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_id" to="entity_company_id"/>
                            <a:map from="company_short_name" to="entity_man_company_desc"/>
                        </a:mapping>
                    </a:field>
                    <!-- <a:field name="entity_unit_id" defaultValue="${/model/eam0310_unit_employee/record/@unit_id}"/> 
                    <a:field name="entity_unit_desc" defaultValue="${/model/eam0310_unit_employee/record/@unit_code_name}" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="管理部门" required="true" title="管理部门">
                        <a:mapping>
                            <a:map from="unit_id" to="entity_unit_id"/>
                            <a:map from="unit_code_name" to="entity_unit_desc"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="entity_unit_id"/>
                    <!-- defaultValue="${/parameter/@entity_unit_id}" -->
                    <!-- defaultValue="${/model/eam0310_unit_employee/record/@unit_code_name}" -->
                    <a:field name="entity_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.cux_eam_exp_org_unit_employee_lov" lovWidth="550" prompt="使用部门" required="false" title="使用部门">
                        <!-- eam.eam_exp_org_unit_employee_lov -->
                        <a:mapping>
                            <a:map from="unit_id" to="entity_unit_id"/>
                            <a:map from="unit_code_name" to="entity_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="using_unit_id"/>
                    <a:field name="using_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="折旧承担部门" required="true" title="折旧承担部门">
                        <a:mapping>
                            <a:map from="unit_id" to="entity_unit_id"/>
                            <a:map from="unit_id" to="using_unit_id"/>
                            <a:map from="unit_code_name" to="using_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_position_id"/>
                    <a:field name="entity_man_position_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_position_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_MAN_POSITION_ID" title="BGT_BUDGET_ITEM_MAPPING.POSITION_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="position_id" to="entity_position_id"/>
                            <a:map from="position_code_name" to="entity_man_position_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="functional_unit_id"/>
                    <a:field name="functional_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_functional_unit_lov" lovWidth="550" prompt="职能管理部门" required="true" title="职能管理部门">
                        <a:mapping>
                            <a:map from="unit_id" to="functional_unit_id"/>
                            <a:map from="unit_code_name" to="functional_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <!--
                    <a:field name="responsibility_company_id" defaultValue="${/model/eam0030_default_res_com/record/@company_id}"/>
                    <a:field name="responsibility_company_desc" defaultValue="${/model/eam0030_default_res_com/record/@company_short_name}" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_COMPANY_ID" readOnly="true"/>
                    <a:field name="responsibility_center_id" defaultValue="${/model/eam0030_default_res_center/record/@responsibility_center_id}"/>
                    <a:field name="responsibility_center_desc" defaultValue="${/model/eam0030_default_res_center/record/@responsibility_center_name}" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_CENTER_ID" readOnly="true"/>
                    -->
                    <a:field name="responsibility_company_id"/>
                    <a:field name="responsibility_company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_COMPANY_ID" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_short_name" to="responsibility_company_desc"/>
                            <a:map from="company_id" to="responsibility_company_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="responsibility_center_id"/>
                    <a:field name="responsibility_center_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam_responsibility_center_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_CENTER_ID" required="true" title="责任中心">
                        <a:mapping>
                            <a:map from="responsibility_center_id" to="responsibility_center_id"/>
                            <a:map from="center_name_code_display" to="responsibility_center_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price" prompt="EXP_REPORT_LINES.PRIC" required="true" validator="priceValidator"/>
                    <a:field name="allocate_element_type"/>
                    <a:field name="allocate_element_type_desc" displayField="code_value_name" options="eam_batch_asset_allocate_element_type_ds" returnField="allocate_element_type" valueField="code_value"/>
                    <a:field name="allocate_element_name"/>
                    <a:field name="address" prompt="EAM_ASSET_HEADERS.ADDRESS"/>
                    <a:field name="is_valuable_flag"/>
                    <a:field name="reference_number"/>
                    <a:field name="description_sec"/>
                    <a:field name="invoice_number"/>
                    <a:field name="asset_old_id"/>
                    <a:field name="category_old_id"/>
                    <a:field name="entity_class_old_id"/>
                    <a:field name="category_old_desc" readOnly="true"/>
                    <a:field name="category_sec_old_desc" readOnly="true"/>
                    <a:field name="entity_class_old_desc" readOnly="true"/>
                    <a:field name="current_location_desc" readOnly="true"/>
                    <a:field name="batch_create_num" prompt="批量新增数" required="true"/>
                    <a:field name="source_opr" defaultValue="YES"/>
                    <a:field name="contract_num" prompt="合同号"/>
                    <a:field name="price_tax" prompt="含税价" required="true"/>
                    <a:field name="price_no_tax" prompt="不含税价" readOnly="true" required="true"/>
                    <a:field name="tax" prompt="税额" required="true"/>
                    <a:field name="transfer_rate" defaultValue="0" prompt="转出比率" required="true" validator="rateValidator"/>
                    <a:field name="transfer_amount" prompt="转出金额" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="onUpdateFun"/>
                    <a:event name="load" handler="onAssetManLoad"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam_batch_eam_asset_character_values_result_ds" bindName="character_values" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_character_values_query" pageSize="20" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_character_values_edit/batch_update">
                <a:fields>
                    <a:field name="character_value_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="character_id"/>
                    <a:field name="data_type"/>
                    <a:field name="required_flag"/>
                    <a:field name="memo" prompt="备注"/>
                    <a:field name="character_desc" prompt="EAM_ASSET_CHARACTER_VALUES.CHARACTER_DESC" readOnly="true"/>
                    <a:field name="value" prompt="EAM_ASSET_CHARACTER_VALUES.VALUE" requiredMessage="特性参数值需要维护!"/>
                </a:fields>
                <a:events>
                    <a:event name="beforesubmit" handler="onEntityBeforeSubmitFun"/>
                    <a:event name="load" handler="onAssetCharacterValuesLoad"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam_batch_cost_source_ds" bindName="cost_lines" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0310.eam0310_asset_cost_sources_edit" selectable="true">
                <a:fields>
                    <a:field name="cost_source_id"/>
                    <a:field name="source_type" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE"/>
                    <a:field name="source_type_desc" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE"/>
                    <a:field name="source_asset_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="source_asset_code" lovGridHeight="240" lovHeight="400" lovService="eam.eam0310.eam0310_management_asset_query?asset_book_id=${/parameter/@asset_book_id}&amp;asset_id=${/parameter/@input_asset_id}" lovWidth="500" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_CODE" title="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_CODE">
                        <a:mapping>
                            <a:map from="asset_id" to="source_asset_id"/>
                            <a:map from="asset_code" to="source_asset_code"/>
                            <a:map from="asset_name" to="source_asset_name"/>
                            <a:map from="source_asset_cost" to="source_asset_cost"/>
                            <a:map from="source_asset_sum_cost" to="source_asset_sum_cost"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="source_asset_name" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_NAME"/>
                    <a:field name="source_asset_cost" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_COST"/>
                    <a:field name="source_asset_sum_cost" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_SUM_COST"/>
                    <a:field name="cost_value_type" defaultValue="${/model/req_header/record/@value_type}"/>
                    <a:field name="cost_value_type_desc" displayField="code_value_name" options="eam_batch_v_type_ds" prompt="EAM_ASSET_COST_SOURCES.COST_VALUE_TYPE" readOnly="true" returnField="cost_value_type" valueField="code_value"/>
                    <a:field name="cost" prompt="EAM_ASSET_COST_SOURCES.COST"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="onCostSourceAdd"/>
                    <a:event name="beforesubmit" handler="beforeCostSubmit"/>
                    <a:event name="load" handler="onCostLoad"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam_batch_eam_asset_allocations_result_ds" bindName="allocations" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_allocations_query" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_allocations_edit/batch_update">
                <!-- <a:datas dataSource="/model/allocations"/> -->
                <a:fields>
                    <a:field name="allocation_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="company_id" defaultValue="${/model/default_company/record/@company_id}"/>
                    <a:field name="company_desc" defaultValue="${/model/default_company/record/@company_short_name}" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="行社" required="true" title="行社">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_short_name" to="company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="responsibility_center_id"/>
                    <a:field name="responsibility_center_desc" lovGridHeight="300" lovHeight="450" lovService="expm.exp_responsibility_center_lov" lovWidth="550" prompt="EAM_ASSET_ALLOCATIONS.RESPONSIBILITY_CENTER_DESC" required="true" title="FND_RESPONSIBILITY_CENTERS.RESPONSIBILITY_CENTER_ID">
                        <a:mapping>
                            <a:map from="responsibility_center_id" to="responsibility_center_id"/>
                            <a:map from="responsibility_center_name" to="responsibility_center_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="quantity" required="true"/>
                    <a:field name="memo" prompt="说明描述"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="onAllocationUpdateFun"/>
                    <a:event name="beforesubmit" handler="onEntityBeforeSubmitFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="certificate_type_ds">
                <a:datas dataSource="/model/certificate_type_query"/>
            </a:dataSet>
            <!--租入信息 -->
            <a:dataSet id="eam0810_eam_asset_lease_info_result_ds" bindName="lease_info" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_eam_asset_lease_info_query" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_lease_info_edit/batch_update">
                <a:fields>
                    <a:field name="lease_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="contract_header_id"/>
                    <a:field name="contract_header_num" lovGridHeight="300" lovHeight="460" lovService="eam.lease_contract_lov" lovWidth="500" prompt="EAM_ASSET_LEASE_INFO.CONTRACT_HEADER_NUM" title="EAM_ASSET_LEASE_INFO.CONTRACT_HEADER_NUM">
                        <a:mapping>
                            <a:map from="contract_number" to="contract_header_num"/>
                            <a:map from="contract_header_id" to="contract_header_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="lease_price" prompt="EAM_ASSET_LEASE_INFO.LEASE_PRICE" required="true"/>
                    <a:field name="price" prompt="EAM_ASSET_LEASE_INFO.PRICE" required="true"/>
                    <a:field name="currency" prompt="EAM_ASSET_LEASE_INFO.CURRENCY_CODE"/>
                    <a:field name="currency_desc" displayField="currency_name" options="eam_currency_ds" prompt="EAM_ASSET_FINANCE_INFO.CURRENCY_NAME" returnField="currency" valueField="currency_code"/>
                    <a:field name="lessor" prompt="EAM_ASSET_LEASE_INFO.LESSOR" required="true"/>
                    <a:field name="certificate_type" displayField="code_value_name" options="certificate_type_ds" prompt="EAM_ASSET_LEASE_INFO.CERTIFICATE_TYPE" required="true" returnField="certificate_type" valueField="certificate_type"/>
                    <a:field name="certificate_num" prompt="EAM_ASSET_LEASE_INFO.CERTIFICATE_NUM" required="true"/>
                    <a:field name="rent_date_from" prompt="EAM_ASSET_LEASE_INFO.RENT_DATE_FROM" required="true" validator="dateValidate1"/>
                    <a:field name="rent_date_to" prompt="EAM_ASSET_LEASE_INFO.RENT_DATE_TO" required="true" validator="dateValidate1"/>
                    <a:field name="free_date_from" prompt="EAM_ASSET_LEASE_INFO.FREE_DATE_FROM" validator="dateValidate2"/>
                    <a:field name="free_date_to" prompt="EAM_ASSET_LEASE_INFO.FREE_DATE_TO" validator="dateValidate2"/>
                    <a:field name="payment_cycle"/>
                    <a:field name="payment_cycle_desc" displayField="code_value_name" options="eam0310_payment_cycle_ds" prompt="EAM_ASSET_LEASE_INFO.PAYMENT_CYCLE" required="true" returnField="payment_cycle" valueField="code_value"/>
                    <a:field name="unit_rent" prompt="EAM_ASSET_LEASE_INFO.UNIT_RENT" required="true"/>
                    <a:field name="rent_unit" prompt="EAM_ASSET_LEASE_INFO.RENT_UNIT" required="true"/>
                    <a:field name="record_flag" prompt="EAM_ASSET_LEASE_INFO.RECORD_FLAG"/>
                    <a:field name="cash_pledge" prompt="EAM_ASSET_LEASE_INFO.CASH_PLEDGE"/>
                    <a:field name="liquidated_damages" prompt="EAM_ASSET_LEASE_INFO.LIQUIDATED_DAMAGES"/>
                    <a:field name="payment_record" prompt="EAM_ASSET_LEASE_INFO.PAYMENT_RECORD"/>
                    <a:field name="house_rent_num" prompt="EAM_ASSET_LEASE_INFO.HOUSE_RENT_NUM"/>
                    <a:field name="management_cost" prompt="EAM_ASSET_LEASE_INFO.MANAGEMENT_COST"/>
                    <a:field name="floating_rentcal" prompt="EAM_ASSET_LEASE_INFO.FLOATING_RENTCAL"/>
                    <a:field name="asset_usage"/>
                    <a:field name="asset_usage_desc" displayField="usage_name" options="eam0810_asset_usage_type_ds" prompt="EAM_ASSET_LEASE_INFO.ASSET_USAGE" returnField="asset_usage" valueField="usage_id"/>
                </a:fields>
                <!-- <a:events> -->
                <!--<a:event name="beforesubmit" handler="onLeaseBeforeSubmitFun"/>-->
                <!-- <a:event name="load" handler="onAssetLeaseInfoLoad"/> -->
                <!-- </a:events> -->
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:form column="1" labelWidth="100" title="EAM_ASSET_HEADERS.TITLE" width="1024">
                <a:hBox labelWidth="100">
                    <a:textField name="asset_id" bindTarget="eam0810_asset_management_result_ds" prompt="卡片号"/>
                    <!-- <a:textField name="asset_code" bindTarget="eam0810_asset_management_result_ds"/> -->
                    <a:comboBox name="category_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产大类">
                        <a:events>
                            <a:event name="select" handler="categorySelectFun"/>
                            <a:event name="focus" handler="categoryFocusFun"/>
                        </a:events>
                    </a:comboBox>
                    <a:textField name="description" bindTarget="eam0810_asset_management_result_ds" prompt="资产名称"/>
                    <a:lov name="using_unit_desc" bindTarget="eam0810_asset_management_result_ds">
                        <a:events>
                            <a:event name="commit" handler="unitSelectFun"/>
                        </a:events>
                    </a:lov>
                    <!--<a:lov name="entity_class_desc" bindTarget="eam0810_asset_management_result_ds"/>
                    <a:textField name="transaction_type" bindTarget="eam0810_asset_management_result_ds" readOnly="true"/>
                   <a:textField name="tag_number" bindTarget="eam0810_asset_management_result_ds"/>
                    <a:textField name="serial_number" bindTarget="eam0810_asset_management_result_ds"/>-->
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:lov name="entity_man_company_desc" bindTarget="eam0810_asset_management_result_ds" prompt="使用机构"/>
                    <!-- <a:lov name="entity_unit_desc" bindTarget="eam0810_asset_management_result_ds">
                        <a:events> -->
                    <!-- <a:event name="beforetriggerclick" handler="entityUnitBeforeFun"/> -->
                    <!-- <a:event name="commit" handler="entityUnitSelectFun"/>
                        </a:events>
                    </a:lov> -->
                    <!--  <a:lov name="responsibility_center_desc" bindTarget="eam0810_asset_management_result_ds"/> -->
                    <a:lov name="req_employee_name" bindTarget="eam0810_asset_management_result_ds" prompt="使用人"/>
                    <!--<a:textField name="brand" bindTarget="eam0810_asset_management_result_ds" prompt="品牌"/>
                    <a:textField name="model_number" bindTarget="eam0810_asset_management_result_ds" prompt="型号"/>-->
                    <a:lov name="functional_unit_desc" bindTarget="eam0810_asset_management_result_ds" prompt="职能管理部门"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textArea name="req_desc" bindTarget="eam0810_asset_management_result_ds" height="80" prompt="摘要" width="910"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:numberField name="batch_create_num" allowDecimals="false" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" width="150">
                        <a:events>
                            <a:event name="change" handler="onBatchCreateNumHandler"/>
                        </a:events>
                    </a:numberField>
                </a:hBox>
            </a:form>
            <!-- 按钮 -->
            <a:hBox>
                <a:button click="eam_batch_save" text="PROMPT.BATCH_ASSET_CREATION"/>
                <a:button click="eam_batch_back" text="HAP_BACK"/>
            </a:hBox>
            <a:tabPanel id="eam_batch_asset_management_tab" height="260" width="1024">
                <a:events>
                    <a:event name="select" handler="onCostSelectHandler"/>
                </a:events>
                <a:tabs>
                    <!--基本信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.BASIC_INFORMATION" width="80">
                        <a:form column="1" height="200" labelWidth="100" width="890">
                            <a:box column="3" labelWidth="130">
                                <a:textField name="serial_number" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:comboBox name="asset_source_type_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:comboBox name="currency_desc" bindTarget="eam0810_asset_management_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <!-- <a:textField name="reference_number" bindTarget="eam0810_asset_management_result_ds" prompt="批准文号"/> -->
                                <a:datePicker name="start_use_date" bindTarget="eam0810_asset_management_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:comboBox name="asset_unit_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:numberField name="quantity" allowDecimals="false" allowNegative="false" bindTarget="eam0810_asset_management_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="price_tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="price_no_tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="transfer_rate" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="transfer_amount" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <!--<a:lov name="category_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                                <a:numberField name="price" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2" readOnly="true"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="cost" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:comboBox name="category_sec_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产小类">
                                    <a:events>
                                        <a:event name="select" handler="category_secSelectFun"/>
                                    </a:events>
                                </a:comboBox>
                                <a:comboBox name="fin_class_desc" bindTarget="eam0810_asset_management_result_ds">
                                    <a:events>
                                        <a:event name="select" handler="finSelectFun"/>
                                    </a:events>
                                </a:comboBox>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:comboBox name="entity_class_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产实物分类">
                                    <a:events>
                                        <a:event name="select" handler="entitySelectFun"/>
                                    </a:events>
                                </a:comboBox>
                                <a:comboBox name="entity_sub_class_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产实物明细分类"/>
                                <a:textField name="install_position" bindTarget="eam0810_asset_management_result_ds" prompt="物理位置"/>
                                <!--<a:textField name="status_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                                <!--<a:lov name="supplier" bindTarget="eam0810_asset_management_result_ds" prompt="供应商"/>-->
                                <!--<a:textField name="supplier" bindTarget="eam0810_asset_management_result_ds" prompt="供应商"/>-->
                                <!--<a:lov name="entity_class_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:textField name="invoice_number" bindTarget="eam0810_asset_management_result_ds" prompt="发票号"/>
                                <!-- <a:textField name="using_unit_old_desc" bindTarget="eam0810_asset_management_result_ds" prompt="原使用部门"/> -->
                                <a:lov name="contract_name" bindTarget="eam0810_asset_management_result_ds"/>
                            </a:box>
                        </a:form>
                    </a:tab>
                    <!--产权信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.PROPERTY_INFORMATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_property_info.screen" width="80"/>
                    <!--保险信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.INSURANCE_INFORMATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_insure_info.screen" width="80"/>
                    <!--合作伙伴 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.PARTNERS" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_partner_info.screen" width="80"/>
                    <!--特性参数 -->
                    <!-- <a:tab height="100" prompt="EAM_ASSET_HEADERS.CHARACTERISTIC_PARAMETERS" width="80">
                        <a:grid bindTarget="eam_batch_eam_asset_character_values_result_ds" height="179" navBar="true" width="880">
                            <a:toolBar/>
                            <a:columns>
                                <a:column name="character_desc" align="center" editor="eam0810_character_tf" width="180"/>
                                <a:column name="value" align="center" editorFunction="eam0810ValueEdit" width="240"/>
                                <a:column name="memo" align="center" editor="eam0810_character_tf" width="400"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="eam0810_character_tf"/>
                                <a:textField id="eam0810_character_values_tf"/>
                                <a:numberField id="eam0810_character_values_nf" allowDecimals="true" allowNegative="false" decimalPrecision="3"/>
                            </a:editors>
                        </a:grid>
                    </a:tab> -->
                    <!--文档信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.DOCUMENT_INFORMATION" ref="${/request/@context_path}/uploadFile.screen?table_name=EAM_ASSET_HEADERS&amp;header_id=${/parameter/@input_asset_id}" width="80"/>
                    <!--分摊分配 -->
                    <!--  <a:tab height="100" prompt="EAM_ASSET_HEADERS.SHARING_ALLOCATION" width="80">
                        <a:form column="1" height="20" labelWidth="100" width="860">
                            <a:box column="2">
                                <a:comboBox name="allocate_element_type_desc" bindTarget="eam0810_asset_management_result_ds" prompt="EAM_ASSET_HEADERS.ALLOCATE_ELEMENT_TYPE"/>
                                <a:textField name="allocate_element_name" bindTarget="eam0810_asset_management_result_ds" prompt="EAM_ASSET_HEADERS.ALLOCATE_ELEMENT_NAME"/>
                            </a:box>
                        </a:form>
                        <a:grid bindTarget="eam_batch_eam_asset_allocations_result_ds" height="160" navBar="true" width="890">
                            <a:toolBar>
                                <a:button type="add"/>
                                @<a:button click="onSave" icon="${/request/@context_path}/images/save.gif" text="HAP_SAVE"/>
                                <a:button type="delete"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="company_desc" align="center" editor="eam0810_allocations_company_desc_lv" width="120"/>
                                @<a:column name="responsibility_center_desc" align="center" editor="eam0810_allocations_resp_desc_lv" width="200"/> 
                                <a:column name="quantity" align="right" editor="eam0810_allocations_quantity_nf" width="120"/>
                                <a:column name="memo" align="center" editor="eam0810_allocations_memo_tf" width="400"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="eam0810_allocations_company_desc_lv"/>
                                <a:lov id="eam0810_allocations_resp_desc_lv"/>
                                <a:numberField id="eam0810_allocations_quantity_nf"/>
                                <a:textField id="eam0810_allocations_memo_tf"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="gridAllocationsCellClick"/>
                            </a:events>
                        </a:grid>
                    </a:tab> -->
                    <!--租入信息 -->
                    <!-- <a:tab height="100" prompt="租入信息" width="80">
                        <a:form bindTarget="eam0810_eam_asset_lease_info_result_ds" column="1" height="200">
                            <a:box column="3" labelWidth="140">
                                <a:lov name="contract_header_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="lease_price" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                                <a:numberField name="price" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                @<a:comboBox name="currency_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="lessor" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:comboBox name="certificate_type" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="certificate_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:datePicker name="rent_date_from" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:datePicker name="rent_date_to" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:comboBox name="payment_cycle_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                            </a:box>
                            <a:box column="4" labelWidth="140">
                                <a:datePicker name="free_date_from" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:datePicker name="free_date_to" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:numberField name="unit_rent" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="rent_unit" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="cash_pledge" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                                <a:numberField name="liquidated_damages" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="payment_record" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="house_rent_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="management_cost" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="floating_rentcal" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:comboBox name="asset_usage_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:checkBox name="record_flag" bindTarget="eam0810_eam_asset_lease_info_result_ds">
                                    <a:events>
                                        <a:event name="change" handler="onRecordFlagChange"/>
                                    </a:events>
                                </a:checkBox>
                            </a:box>
                        </a:form>
                    </a:tab> -->
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
    </a:view>
</a:screen>
