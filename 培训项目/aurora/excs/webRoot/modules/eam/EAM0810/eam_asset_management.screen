<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Spencer 3893
    $Date: 2013-2-28 下午2:00:50  
    $Revision: 1.0  
    $Purpose: 资产台账管理维护页面
-->
<a:screen xmlns:c="aurora.application.action" xmlns:p="uncertain.proc" xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="eam.eam0020.eam0020_asset_books_lov" queryOrderBy="asset_book_code" rootPath="eam0020_asset_books_list"/>
        <a:model-query defaultWhereClause="company_id=${/session/@company_id}" model="fnd.fnd_companies" rootPath="currentCompanyInfo"/>
    </a:init-procedure>
    <a:view package="aurora.ui.std" template="default">
        <div/>
        <!-- <a:link id="eam_asset_mgt_print_del_link" model="db.cux_eam_birt_pkg.delete_asset_mgt" modelaction="execute"/>
        <a:link id="eam_asset_mgt_print_do_link" model="db.cux_eam_birt_pkg.do_asset_mgt" modelaction="batch_update"/> -->
        <a:link id="eam_deprn_accounts_link" url="${/request/@context_path}/modules/eam/EAM0830/eam_deprn_accounts.screen"/>
        <!-- <script src="${/request/@context_path}/modules/print/zplprint.js" type="text/javascript"/> -->
        <script><![CDATA[
            function gridcellload(ds) {
                //alert(ds.getSelected().length);
            }
            
            // 查询表单数据
            
            function eam0810_queryFun() {
                $('eam0810_asset_management_result_ds').reset();
                $('eam0810_eam_asset_lease_info_result_ds').reset();
                $('eam0810_eam_asset_finance_info_result_ds').reset();
                $('eam0810_asset_management_result_ds').query();
            }
            
            // 重置表单
            
            function eam0810_resetFun() {
                $('eam0810_asset_management_query_ds').reset();
            }
            
            function submit_success() {
                //$('eam0810_asset_management_result_ds').query();
            }
            
            function onQueryUpdateFun(dataSet, record, name, value) {
                //资产账簿修改时资产大类联动改变
                if (name == 'asset_book_id') {
                    record.set('category_id', '');
                    record.set('category_desc', '');
                    record.getMeta().getField('category_desc').setReadOnly(false);
                    $('eam0810_asset_categories_list_ds').setQueryParameter('asset_book_id', record.get("asset_book_id"));
                    $('eam0810_asset_categories_list_ds').query();
                }
                //资产大类修改时财务分类联动改变
                if (name == 'category_id') {
                    //alert(record.get("category_id"));
                    record.set('fin_class_id', '');
                    record.set('entity_class_id', '');
                    record.set('fin_class_desc', '');
                    record.set('entity_class_desc', '');
                    record.getMeta().getField('fin_class_desc').setReadOnly(false);
                    record.getMeta().getField('entity_class_desc').setReadOnly(false);
                    $('eam0810_asset_fin_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                    $('eam0810_asset_fin_class_list_ds').query();
                    //资产大类修改时实物分类联动改变
                    $('eam0810_asset_entity_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                    $('eam0810_asset_entity_class_list_ds').query();
                }
                if (name == 'responsibility_company_id') {
                    record.getField("using_unit_name").setLovPara('company_id', value);
                    record.getField("using_unit_name").setLovPara('company_id', value);
                }
            
            }
            
            function eam0810AssetCodeEdit(record, name) {
                if (name == 'asset_book_desc') {
                    if (!record.isNew) {
                        return '';
                    } else {
                        return 'eam0810_cbbx';
                    }
                }
                if (name == 'status_desc') {
                    if (!record.isNew) {
                        return '';
                    } else {
                        return 'eam0810_cmb';
                    }
                }
            }
            
            //ds第一次加载grid数据第一行对应form数据某些字段可修改
            
            function onAssetManLoad(ds) {
                var record = ds.getAt(0);
                if (record) {
                    var tabs = $('eam0810_asset_management_tab');
                    var asset_id = record.get('asset_id');
            
                    var subTab = tabs.items[7];
                    if (subTab.prompt == 'EAM_ASSET_HEADERS.DOCUMENT_INFORMATION') {
                        subTab.ref = "${/request/@context_path}/uploadFile.screen?table_name=EAM_ASSET_HEADERS&header_id=" + asset_id;
                    }
            
                    //if (record.get('asset_book_id') != undefined && record.get('asset_book_id') != '' && record.get('asset_book_id') != null) {
                    if (!Ext.isEmpty(record.get('asset_book_id'))) {
                        record.getField("value_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                        record.getField("entity_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                        record.getField("responsibility_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                    }
            
                    //if (record.get('value_man_company_id') != undefined && record.get('value_man_company_id') != '' && record.get('value_man_company_id') != null) {
                    if (!Ext.isEmpty(record.get('value_man_company_id'))) {
                        record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                        record.getField("value_man_unit_desc").setLovPara('company_id', record.get('value_man_company_id'));
                    }
            
                    //if (record.get('value_man_unit_id') != undefined && record.get('value_man_unit_id') != '' && record.get('value_man_unit_id') != null) {
                    if (!Ext.isEmpty(record.get('value_man_unit_id'))) {
                        record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                        record.getField("value_man_position_desc").setLovPara('unit_id', record.get('value_man_unit_id'));
                    }
            
                    //if (record.get('entity_company_id') != undefined && record.get('entity_company_id') != '' && record.get('entity_company_id') != null) {
                    if (!Ext.isEmpty(record.get('entity_company_id'))) {
                        record.getMeta().getField('entity_man_unit_desc').setReadOnly(false);
                        record.getField("entity_man_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                    }
            
                    //if (record.get('entity_unit_id') != undefined && record.get('entity_unit_id') != '' && record.get('entity_unit_id') != null) {
                    if (!Ext.isEmpty(record.get('entity_unit_id'))) {
                        record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                        record.getField("entity_man_position_desc").setLovPara('unit_id', record.get('entity_unit_id'));
                    }
            
                    //if (record.get('responsibility_company_id') != undefined && record.get('responsibility_company_id') != '' && record.get('responsibility_company_id') != null) {
                    if (!Ext.isEmpty(record.get('responsibility_company_id'))) {
                        record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                        record.getField("responsibility_center_desc").setLovPara('company_id', record.get('responsibility_company_id'));
                    }
                    //if (record.get('responsibility_company_id') != undefined && record.get('responsibility_company_id') != '' && record.get('responsibility_company_id') != null) {
                    if (!Ext.isEmpty(record.get('responsibility_company_id'))) {
                        record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                        record.getField("responsibility_center_desc").setLovPara('company_id', record.get('responsibility_company_id'));
                    }
                }
            }
            
            function onIndexChangeFun(ds, record) {
                if (record) {
                    var tabs = $('eam0810_asset_management_tab');
                    var asset_id = record.get('asset_id');
            
                    // if(record.get('category_code') == '10' || record.get('category_code') == '50'){
                    // record.getField("reference_number").setReadOnly(true);
                    // }else{
                    // record.getField("reference_number").setReadOnly(false);
                    // }
            
                    var subTab = tabs.items[6];
                    if (subTab.prompt == 'EAM_ASSET_HEADERS.DOCUMENT_INFORMATION') {
                        subTab.ref = "${/request/@context_path}/uploadFile.screen?table_name=EAM_ASSET_HEADERS&header_id=" + asset_id;
                    }
                    tabs.reloadTab(7, "${/request/@context_path}/uploadFile.screen?table_name=EAM_ASSET_HEADERS&header_id=" + asset_id);
            
                    tabs.selectTab(0, true);
                    var lease_rs = $('eam0810_eam_asset_lease_info_result_ds').getAll(0);
            
                    //if (record.get('asset_book_id') != undefined && record.get('asset_book_id') != '' && record.get('asset_book_id') != null) {
                    if (!Ext.isEmpty(record.get('asset_book_id'))) {
                        record.getField("value_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                        record.getField("entity_man_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                        record.getField("responsibility_company_desc").setLovPara('asset_book_id', record.get('asset_book_id'));
                    }
                    /* if (record.get('category_id') != undefined && record.get('category_id') != '' && record.get('category_id') != null) {
                     record.getMeta().getField('entity_class_desc').setReadOnly(false);
                     record.getField("entity_class_desc").setLovPara('category_id', record.get('category_id'));
                     } */
                    //if (record.get('value_man_company_id') != undefined && record.get('value_man_company_id') != '' && record.get('value_man_company_id') != null) {
                    if (!Ext.isEmpty(record.get('value_man_company_id'))) {
                        record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                        record.getField("value_man_unit_desc").setLovPara('company_id', record.get('value_man_company_id'));
                    }
            
                    //if (record.get('value_man_unit_id') != undefined && record.get('value_man_unit_id') != '' && record.get('value_man_unit_id') != null) {
                    if (!Ext.isEmpty(record.get('value_man_unit_id'))) {
                        record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                        record.getField("value_man_position_desc").setLovPara('unit_id', record.get('value_man_unit_id'));
                    }
            
                    //if (record.get('entity_company_id') != undefined && record.get('entity_company_id') != '' && record.get('entity_company_id') != null) {
                    if (!Ext.isEmpty(record.get('entity_company_id'))) {
                        record.getMeta().getField('entity_man_unit_desc').setReadOnly(false);
                        record.getField("entity_man_unit_desc").setLovPara('company_id', record.get('entity_company_id'));
                    }
            
                    //if (record.get('entity_unit_id') != undefined && record.get('entity_unit_id') != '' && record.get('entity_unit_id') != null) {
                    if (!Ext.isEmpty(record.get('entity_unit_id'))) {
                        record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                        record.getField("entity_man_position_desc").setLovPara('unit_id', record.get('entity_unit_id'));
                    }
            
                    //if (record.get('responsibility_company_id') != undefined && record.get('responsibility_company_id') != '' && record.get('responsibility_company_id') != null) {
                    if (!Ext.isEmpty(record.get('responsibility_company_id'))) {
                        record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                        record.getField("responsibility_center_desc").setLovPara('company_id', record.get('responsibility_company_id'));
                    }
            
                    //if(record.get('asset_id') != undefined && record.get('asset_id') != '' && record.get('asset_id') != null){
                    if (!Ext.isEmpty(record.get('asset_id'))) {
                        $('eam0810_eam_asset_finance_info_result_ds').removeAll();
                        $('eam0810_eam_asset_lease_info_result_ds').removeAll();
            
                        if (record.get('is_valuable_flag') == 'Y') {
                            $('eam0810_eam_asset_finance_info_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                            $('eam0810_eam_asset_finance_info_result_ds').query();
                        }
                        //查询特性参数
                        if (record.get('copy_flag') == 'N') {
                            $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                            $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('entity_class_old_id', record.get('entity_class_old_id'));
                            $('eam0810_eam_asset_character_values_result_ds').query();
                        } else {
                            $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                            $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('entity_class_id', record.get('entity_class_id'));
                            $('eam0810_eam_asset_character_values_result_ds').query();
                        }
                        //分摊分配
                        $('eam0810_eam_asset_allocations_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                        $('eam0810_eam_asset_allocations_result_ds').query();
            
                        //租入信息
                        $('eam0810_eam_asset_lease_info_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                        $('eam0810_eam_asset_lease_info_result_ds').query();
                        //维护维修
                        // $('eam_asset_readonly_maintenace_ds').setQueryParameter('asset_id',record.get('asset_id'));
                        // $('eam_asset_readonly_maintenace_ds').query();
                        record.set('current_location_desc', record.get('install_position'));
                        //计量单位为必输
                        //record.getField('asset_unit_desc').setRequired(true);--060
                        //资产类别选择固定资产或无形资产或长期待摊费用或在建工程时，批准文号必输
                        if (record.get('category_code') == '10' || record.get('category_code') == '30' || record.get('category_code') == '40' || record.get('category_code') == '50') {
                            //record.getField("reference_number").setRequired(true);
                        } else {
                            record.getField("reference_number").setRequired(false);
                        }
                    }
                }
            }
            
            function onUpdateFun(dataSet, record, name, value) {
                var lovField;
                if (name == 'asset_book_id') {
            
                    var lovField3 = record.getField("value_man_company_desc");
                    lovField3.setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    var lovField4 = record.getField("entity_man_company_desc");
                    lovField4.setLovPara('asset_book_id', record.get('asset_book_id'));
            
                    var lovField5 = record.getField("responsibility_company_desc");
                    lovField5.setLovPara('asset_book_id', record.get('asset_book_id'));
                }
                /* if (name == 'category_id') {
                 lovField = record.getField("entity_class_desc");
                 record.getMeta().getField('entity_class_desc').setReadOnly(false);
                 record.set('entity_class_id', '');
                 record.set('entity_class_desc', '');
                 lovField.setLovPara('category_id', record.get('category_id'));
                 } */
            
                //当实物分类改变 重新查询特性参数
                /* if (name == 'entity_class_id') {
                 $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('asset_id', record.get('asset_id'));
                 $('eam0810_eam_asset_character_values_result_ds').setQueryParameter('entity_class_id', record.get('entity_class_id'));
                 $('eam0810_eam_asset_character_values_result_ds').query();
                 } */
            
                if (name == 'value_man_company_id') {
                    lovField = record.getField("value_man_unit_desc");
                    record.getMeta().getField('value_man_unit_desc').setReadOnly(false);
                    record.set('value_man_unit_id', '');
                    record.set('value_man_unit_desc', '');
                    record.set('value_man_position_id', '');
                    record.set('value_man_position_desc', '');
                    lovField.setLovPara('company_id', record.get('value_man_company_id'));
                }
                if (name == 'value_man_unit_id') {
                    lovField = record.getField("value_man_position_desc");
                    record.getMeta().getField('value_man_position_desc').setReadOnly(false);
                    record.set('value_man_position_id', '');
                    record.set('value_man_position_desc', '');
                    lovField.setLovPara('unit_id', record.get('value_man_unit_id'));
                }
                if (name == 'entity_company_id') {
                    lovField = record.getField("entity_man_unit_desc");
                    record.getMeta().getField('entity_man_unit_desc').setReadOnly(false);
                    record.set('entity_unit_id', '');
                    record.set('entity_man_unit_desc', '');
                    record.set('entity_position_id', '');
                    record.set('entity_man_position_desc', '');
                    lovField.setLovPara('company_id', record.get('entity_company_id'));
                }
                if (name == 'entity_unit_id') {
                    lovField = record.getField("entity_man_position_desc");
                    record.getMeta().getField('entity_man_position_desc').setReadOnly(false);
                    record.set('entity_position_id', '');
                    record.set('entity_man_position_desc', '');
                    lovField.setLovPara('unit_id', record.get('entity_unit_id'));
                }
            
                if (name == 'responsibility_company_id') {
                    lovField = record.getField("responsibility_center_desc");
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.set('responsibility_center_id', '');
                    record.set('responsibility_center_desc', '');
                    lovField.setLovPara('company_id', record.get('responsibility_company_id'));
                }
            }
            
            //date_of_purchase  gain_date  start_use_date
            
            function dateValidate(record, name, value) {
                if (record) {
                    if (name == 'date_of_purchase' || name == 'gain_date' || name == 'start_use_date') {
                        var date_of_purchase = record.get('date_of_purchase');
                        var gain_date = record.get('gain_date');
                        var start_use_date = record.get('start_use_date');
                        if (typeof(gain_date) != 'undefined' && !Ext.isEmpty(gain_date)) {
                            if (!compareDate(date_of_purchase, gain_date)) {
                                return '${l:EAM_ASSET_HEADERS.GAIN_DATE_VALIDATE}';
                            }
                        }
                        if (typeof(start_use_date) != 'undefined' && !Ext.isEmpty(start_use_date)) {
                            if (!compareDate(gain_date, start_use_date)) {
                                return '${l:EAM_ASSET_HEADERS.START_USE_DATE_VALIDATE}';
                            }
                        }
                        return true;
                    }
                }
            }
            
            function compareDate(start, end) {
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            function onBlurGainDateFun() {
                var record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                if (record) {
                    var date_of_purchase = record.get('date_of_purchase');
                    var gain_date = record.get('gain_date');
                    if (typeof(gain_date) != 'undefined' && !Ext.isEmpty(gain_date)) {
                        if (!compareDate(date_of_purchase, gain_date)) {
                            return '${l:EAM_ASSET_HEADERS.GAIN_DATE_VALIDATE}';
                        }
                    }
                    return true;
                }
            }
            
            function onBlurStartUseDateFun() {
                var record = $('eam0810_asset_management_result_ds').getCurrentRecord();
                if (record) {
                    var gain_date = record.get('gain_date');
                    var start_use_date = record.get('start_use_date');
                    if (typeof(start_use_date) != 'undefined' && !Ext.isEmpty(start_use_date)) {
                        if (!compareDate(gain_date, start_use_date)) {
                            return '${l:EAM_ASSET_HEADERS.START_USE_DATE_VALIDATE}';
                        }
                    }
                    return true;
                }
            }
            
            function eam0810_saveAssetMan() {
            
                //判断是否有记录
                var myRecords = $('eam0810_asset_management_result_ds').getSelected();
                if (myRecords.length < 1) {
                    Aurora.showWarningMessage('', '没有有效数据可以保存！', null, 240, 120);
                    return;
                }
                if ($('eam0810_asset_management_result_ds').getCurrentRecord()) {
                    var allocate_element_type = $('eam0810_asset_management_result_ds').getCurrentRecord().get('allocate_element_type');
                    //mantis24468 当因子类型为比率时,保存分配记录时,先校验分配数量的和是否为1,不为1则报错.
                    if (allocate_element_type == 'RATIO') {
            
                        var result_ds = $('eam0810_eam_asset_allocations_result_ds');
                        var rs = result_ds.getAll();
                        var sum = 0;
                        if (rs.length > 0) {
                            for (var j = 0;j < rs.length;j++) {
                                var r = rs[j];
                                sum += r.get('quantity');
                            }
                            if (sum != 1) {
                                Aurora.showErrorMessage('${l:PROMPT}', '${l:EAM_ASSET_ALLOCATIONS.ALLOCATE_ELEMENT_TYPE}');
                                return;
                            }
                        }
                    }
            
                    $('eam0810_asset_management_result_ds').submit();
                }
            }
            
            //特性参数
            
            function onValuesBeforeSubmitFun(ds) {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var asset_id = categories_record.get('asset_id');
                if (asset_id == ' ' || asset_id == null || asset_id == undefined) {
                    Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.DO_SAVE_EAM_ASSET_HEADERS}');
                    return false;
                }
                var result_ds = $('eam0810_eam_asset_character_values_result_ds');
                if (result_ds.validate()) {
                    var records = result_ds.getAll();
                    var len = records.length;
                    if (len < 1) {
                        Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.ADD_DATA}');
                    } else {
                        for (var i = 0;i < len;i++) {
                            var record = records[i];
                            record.set('asset_id', asset_id);
                        }
                    }
                }
            }
            
            function eam0810ValueEdit(record, name) {
                if (name == 'value') {
                    var data_type = record.get('data_type');
                    if (data_type == 'NUMERIC') {
                        return 'eam0810_character_values_nf';
                    } else if (data_type == 'TEXT') {
                        return 'eam0810_character_values_tf';
                    }
                }
            }
            
            function onAssetCharacterValuesLoad(ds) {
                var records = ds.getAll();
                var len = records.length;
                for (var i = 0;i < len;i++) {
                    var required_flag = records[i].get('required_flag');
                    if (required_flag == 'Y') {
                        records[i].getMeta().getField('value').setRequired(true);
                    }
                }
            }
            
            
            //分摊分配
            
            function onAllocationsBeforeSubmitFun(ds) {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var asset_id = categories_record.get('asset_id');
                var allocate_element_type = categories_record.get('allocate_element_type');
                //if (asset_id == ' ' || asset_id == null || asset_id == undefined) {
                if (Ext.isEmpty(asset_id)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.DO_SAVE_EAM_ASSET_HEADERS}');
                    return false;
                }
                var result_ds = $('eam0810_eam_asset_allocations_result_ds');
                if (result_ds.validate()) {
                    var records = result_ds.getAll();
                    var len = records.length;
                    if (len < 1) {
                        Aurora.showMessage('${l:PROMPT}', '${l:EAM_ASSET_PARTNER_INFO.ADD_DATA}');
                        return false;
                    } else {
                        for (var i = 0;i < len;i++) {
                            var record = records[i];
                            record.set('asset_id', asset_id);
                        }
                    }
                }
            }
            
            function onAllocationsUpdateFun(dataSet, record, name, value) {
                if (name == 'company_id') {
                    lovField = record.getField("responsibility_center_desc");
                    record.getMeta().getField('responsibility_center_desc').setReadOnly(false);
                    record.set('responsibility_center_id', '');
                    record.set('responsibility_center_desc', '');
                    lovField.setLovPara('company_id', record.get('company_id'));
                }
            }
            
            function onSave() {
                var categories_result = $('eam0810_asset_management_result_ds');
                var categories_record = categories_result.getCurrentRecord();
                var allocate_element_type = categories_record.get('allocate_element_type');
                //mantis24468 当因子类型为比率时,保存分配记录时,先校验分配数量的和是否为1,不为1则报错.
                if (allocate_element_type == 'RATIO') {
                    var result_ds = $('eam0810_eam_asset_allocations_result_ds');
                    var rs = result_ds.getAll();
                    var sum = 0;
                    var len = rs.length;
                    for (var j = 0;j < len;j++) {
                        var r = rs[j];
                        sum += r.get('quantity');
                    }
                    if (sum != 1) {
                        Aurora.showErrorMessage('${l:PROMPT}', '${l:EAM_ASSET_ALLOCATIONS.ALLOCATE_ELEMENT_TYPE}');
                        return;
                    }
                }
                $('eam0810_eam_asset_allocations_result_ds').submit();
            }
            
            function gridAllocationsCellClick(grid, row, name, record) {
                var MetaData = record.getMeta();
                if (name == 'responsibility_center_desc') {
                    var MetaField1 = MetaData.getField('responsibility_center_desc');
                    MetaField1.setLovPara('company_id', $('eam0810_eam_asset_allocations_result_ds').getCurrentRecord().get('company_id'));
                }
                if (name == 'company_desc') {
                    var MetaField2 = MetaData.getField('company_desc');
                    MetaField2.setLovPara('asset_book_id', $('eam0810_asset_management_result_ds').getCurrentRecord().get('asset_book_id'));
                }
            }
            
            function assetSelectFun() {
                var headDataSet = $('eam0810_asset_management_query_ds');
                var record = headDataSet.getAt(0);
                var ds = $('eam0810_asset_categories_list_ds');
                ds.setQueryParameter('asset_book_id', record.get('asset_book_id') || '${/model/eam0020_asset_books_list/record/@asset_book_id}');
                ds.query();
            }
            //资产大类
            
            function categorySelectFun() {
                var headDataSet = $('eam0810_asset_management_query_ds');
                var record = headDataSet.getAt(0);
                var ds = $('eam0810_asset_categories_list2_ds');
                ds.setQueryParameter('asset_book_id', record.get('asset_book_id') || '${/model/eam0020_asset_books_list/record/@asset_book_id}');
                ds.setQueryParameter('category_code', record.get('category_code') || -1);
                ds.query();
                record.set('category_sec_desc', '');
                record.set('category_sec_id', '');
                record.set('fin_class_desc', '');
                record.set('fin_class_id', '');
                record.set('entity_class_desc', '');
                record.set('entity_class_id', '');
            }
            //资产小类
            
            function category_secSelectFun() {
                var headDataSet = $('eam0810_asset_management_query_ds'); //财务分类
                var record = headDataSet.getAt(0);
                var ds = $('eam0810_asset_fin_class_list_ds');
                ds.setQueryParameter('category_id', record.get('category_id') || -1);
                ds.setQueryParameter('category_sec_id', record.get('category_sec_id') || -1);
                ds.query();
                record.set('fin_class_desc', '');
                record.set('fin_class_id', '');
                record.set('entity_class_desc', '');
                record.set('entity_class_id', '');
            }
            //财务分类
            
            function finSelectFun() {
                var headDataSet = $('eam0810_asset_management_query_ds'); //实物分类
                var record = headDataSet.getAt(0);
                var ds = $('eam0810_asset_entity_class_list_ds');
                ds.setQueryParameter('category_id', record.get('category_id') || -1);
                ds.setQueryParameter('fin_class_id', record.get('fin_class_id') || -1);
                ds.query();
                record.set('entity_class_desc', '');
                record.set('entity_class_id', '');
            }
            
            function printFunction() {
                //var myRecords = $('eam0810_asset_management_result_ds').getSelected();
                //window.open('${/request/@context_path}/reports?__report=asset_management_print.rptdesign&asset_id=' + myRecords[0].get('asset_id'));
            
                //return;
                var params = $('eam0810_asset_management_result_ds').getJsonData(true);
                if (params.length < 1) {
                    Aurora.showInfoMessage('${l:PROMPT}', '${l:PROMPT.PLEASE_SELECT}', null, 250, 100);
                    return;
                }
            
                Aurora.request({
                    url: $('eam_asset_mgt_print_del_link').getUrl(),
                    para: {
                        user_id: '${/session/@user_id}'
                    },
                    success: function() {
                        Aurora.request({
                            url: $('eam_asset_mgt_print_do_link').getUrl(),
                            para: params,
                            success: function() {
                                window.open('${/request/@context_path}/reports?__report=asset_management_print.rptdesign&__format=pdf&LANGUAGE=ZHS&user_id=' + '${/session/@user_id}');
                            },
                            scope: this
                        });
            
                    },
                    scope: this
                });
            
            }
            
            function othermessageprintFunction() {
                var myRecords = $('eam0810_asset_management_result_ds').getSelected();
                window.open('${/request/@context_path}/reports?__report=asset_other_message.rptdesign&asset_id=' + myRecords[0].get('asset_id'));
            }
            
            function tabSelectFunction(tab, index) {
                if (index == 10) {
                    try {
                        var records = $('eam0810_eam_asset_lease_info_result_ds').getAt(0);
                        records.getMeta().getField('contract_header_num').setReadOnly(false);
                        records.getMeta().getField('payment_cycle_desc').setReadOnly(false);
                        records.getMeta().getField('payment_record').setReadOnly(false);
                        records.getMeta().getField('house_rent_num').setReadOnly(false);
                        records.getMeta().getField('management_cost').setReadOnly(false);
                        records.getMeta().getField('floating_rentcal').setReadOnly(false);
                        records.getMeta().getField('record_flag').setReadOnly(false);
                        var record_flag = records.get('record_flag');
                        if ('Y' == record_flag) {
                            records.getMeta().getField('house_rent_num').setRequired(true);
                            records.getMeta().getField('management_cost').setRequired(true);
                        } else {
                            records.getMeta().getField('house_rent_num').setRequired(false);
                            records.getMeta().getField('management_cost').setRequired(false);
                        }
                    } catch (e) {
                        $('eam0810_eam_asset_lease_info_result_ds').create();
                        var records = $('eam0810_eam_asset_lease_info_result_ds').getAt(0);
                        records.getMeta().getField('contract_header_num').setReadOnly(true);
                        records.getMeta().getField('payment_cycle_desc').setReadOnly(true);
                        records.getMeta().getField('payment_record').setReadOnly(true);
                        records.getMeta().getField('house_rent_num').setReadOnly(true);
                        records.getMeta().getField('management_cost').setReadOnly(true);
                        records.getMeta().getField('floating_rentcal').setReadOnly(true);
                        records.getMeta().getField('record_flag').setReadOnly(true);
                    }
            
            
                }
            }
            
            function print_asset() {
                var ds = $('eam0810_asset_management_result_ds');
                var rs = ds.getSelected();
                if (rs.length == 0) {
                    Aurora.showInfoMessage('${l:PROMPT}', '${l:BGT_PERIOD.PLEASE_CHOOSE_LINE}', null, 250, 100);
                    return;
                }
                var records = new Array();
                for (var i = 0;i < rs.length;i++) {
                    records.push(rs[i].data);
                }
            
                var barcodeParam = new Array();
            
                for (var i = 0;i < records.length;i++) {
                    //alert(records[i].barcode.replace(',',''));
                    barcodeParam.push(records[i].tag_number.replace(',', '') + ";;;" + 1 + ";;;" + '资产名称：' + records[i].description + " ;;;" + '资产类别：' + records[i].entity_class_code + records[i].entity_class_desc + " ;;;" + '启用日期：' + records[i].start_use_date + " ;;;" + records[i].company_full_name + " ");
                    //alert($$.toJSON(barcodeParam));
                }
                //alert(barcodeParam);
                zplPrint(barcodeParam);
            }
            
            function zplPrint(data) {
                if (data.length != 0) {
                    //alert(data);
                    callprintZpl(data, 'ASSET', '${/request/@context_path}/modules/print/');
                } else {
                    Aurora.showInfoMessage('${l:PROMPT}', '${l:BGT_PERIOD.PLEASE_CHOOSE_LINE}', null, 250, 100);
                    return;
                }
            }
            
            function onRecordFlagChange(combox, value, oldValue) {
                var li_record = $("eam0810_eam_asset_lease_info_result_ds").getCurrentRecord();
                if ('Y' == value) {
                    li_record.getMeta().getField('house_rent_num').setRequired(true);
                    li_record.getMeta().getField('management_cost').setRequired(true);
                } else {
                    li_record.getMeta().getField('house_rent_num').setRequired(false);
                    li_record.getMeta().getField('management_cost').setRequired(false);
                }
            }
            
            function accounts_info_func(value, record, name) {
                var source_code = 'DEPRN';
                var transaction_header_id = record.get("asset_dep_detail_id");
                var period_name = record.get("period_name");
                var url = $('eam_deprn_accounts_link').getUrl() + "?period_name=" + period_name + "&transaction_header_id=" + transaction_header_id + "&source_code=" + source_code;
                return '<a href="javascript:view_accounts_info(\'' + url + '\')">' + '凭证信息' + '</a>';
            }
            
            function view_accounts_info(url) {
                new Aurora.Window({
                    url: url,
                    title: '折旧凭证信息',
                    id: 'eam_deprn_accounts_window',
                    width: 840,
                    height: 340
                });
            }
            //add by whf 060
            
            function onFinLoad(ds) {
                var record_fin = ds.getAt(0);
                //alert(record_fin.get('depreciate_enable_flag'));
                if (record_fin.get('depreciate_enable_flag') == 'N') {
                    // Aurora.showInfoMessage('提示', '该资产不允许折旧', null, 250, 100);
                    record_fin.getMeta().getField('depreciate_flag').setReadOnly(true);
            
            
            
                }
            
            
            
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="eam_asset_readonly_maintenace_ds" autoPageSize="true" autoQuery="true" model="eam.eam0810.eam0810_asset_maintenace" queryUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_maintenace/query?asset_id=${/parameter/@asset_id}">
                <a:fields>
                    <a:field name="maintenace_date"/>
                    <a:field name="maintenace"/>
                    <a:field name="report_line_amount"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="eam0810_asset_books_list_ds">
                <a:datas dataSource="/model/eam0020_asset_books_list"/>
            </a:dataSet>
            <a:dataSet id="eam0810_asset_categories_list2_ds" model="eam.eam0810.eam0810_asset_categories2_all_cmb"/>
            <a:dataSet id="eam0810_asset_fin_class_list_ds" model="eam.eam0810.eam0810_asset_fin_class_all_cmb"/>
            <a:dataSet id="eam0810_asset_entity_class_list_ds" model="eam.eam0810.eam0810_asset_entity_class_all_cmb"/>
            <a:dataSet id="eam0810_asset_usage_type_ds" model="eam.eam0810.eam0810_asset_usage_type_cmb"/>
            <a:dataSet id="eam0810_asset_categories_list_ds" model="eam.eam0810.eam0810_asset_categories_all_cmb"/>
            <a:dataSet id="eam0810_asset_status_ds" lookupCode="EAM_ASSET_STATUS"/>
            <a:dataSet id="eam0810_asset_source_type_ds" lookupCode="EAM_AST_SOURCE_TYPE"/>
            <a:dataSet id="eam0810_asset_allocate_element_type_ds" lookupCode="EAM_ALLOCATE_ELEMENT_TYPE"/>
            <a:dataSet id="eam0310_payment_cycle_ds" lookupcode="PAYMENT_CYCLE"/>
            <a:dataSet id="eam0310_u_measurement_ds" lookupcode="UNITS_OF_MEASUREMENT"/>
            <!--报废类型-->
            <a:dataSet id="retirement_type_ds" lookupCode="RETIREMENT_TYPE"/>
            <a:dataSet id="eam0810_asset_management_query_ds">
                <a:fields>
                    <a:field name="asset_book_id"/>
                    <a:field name="asset_book_desc" defaultValue="${/model/eam0020_asset_books_list/record/@asset_book_desc}" displayField="asset_book_desc" options="eam0810_asset_books_list_ds" prompt="EAM_ASSET_CATEGORIES.ASSET_BOOK" returnField="asset_book_id" valueField="asset_book_id"/>
                    <a:field name="asset_code" prompt="EAM_ASSET_HEADERS.ASSET_CODE"/>
                    <a:field name="description" prompt="EAM_ASSET_HEADERS.DESCRIPTION"/>
                    <a:field name="category_id"/>
                    <a:field name="category_sec_id"/>
                    <a:field name="category_code"/>
                    <a:field name="category_sec_code"/>
                    <a:field name="category_desc" displayField="description_sec" options="eam0810_asset_categories_list_ds" prompt="资产大类" returnField="category_code" valueField="category_code">
                        <a:mapping>
                            <a:map from="category_id" to="category_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="category_sec_desc" displayField="description_sec" options="eam0810_asset_categories_list2_ds" prompt="资产小类" returnField="category_id" valueField="category_id">
                        <a:mapping>
                            <a:map from="category_sec_id" to="category_sec_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="fin_class_id"/>
                    <a:field name="fin_class_code"/>
                    <a:field name="fin_class_desc" displayField="description" options="eam0810_asset_fin_class_list_ds" prompt="EAM_ASSET_HEADERS.FIN_CLASS_ID" returnField="fin_class_id" valueField="class_id">
                        <a:mapping>
                            <a:map from="class_code" to="fin_class_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_class_id"/>
                    <a:field name="entity_class_desc" displayField="description" options="eam0810_asset_entity_class_list_ds" prompt="EAM_ASSET_HEADERS.ENTITY_CLASS_ID" returnField="entity_class_id" valueField="class_id"/>
                    <a:field name="entity_class_code"/>
                    <a:field name="company_full_name"/>
                    <a:field name="status"/>
                    <a:field name="status_desc" displayField="code_value_name" options="eam0810_asset_status_ds" prompt="EAM_ASSET_HEADERS.STATUS" returnField="status" valueField="code_value"/>
                    <a:field name="tag_number" prompt="资产卡片号"/>
                    <a:field name="serial_number" prompt="EAM_ASSET_HEADERS.SERIAL_NUMBER"/>
                    <a:field name="responsibility_company_id"/>
                    <a:field name="responsibility_company_name" lovGridHeight="350" lovHeight="500" lovService="expm.exp_fy_apply_close" lovWidth="500" prompt="AST_ASSET.ASSET_TRANSFER_ORGANIZATION" title="AST_ASSET.ASSET_TRANSFER_ORGANIZATION">
                        <a:mapping>
                            <a:map from="id" to="responsibility_company_id"/>
                            <a:map from="name" to="responsibility_company_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="using_unit_id"/>
                    <a:field name="using_unit_name" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="折旧承担部门" title="折旧承担部门">
                        <a:mapping>
                            <a:map from="unit_id" to="using_unit_id"/>
                            <a:map from="unit_code_name" to="using_unit_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="all_company_flag" checkedValue="Y" defaultValue="N" prompt="包含子机构" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="onQueryUpdateFun"/>
                </a:events>
            </a:dataSet>
            <!-- selectionModel="single" -->
            <a:dataSet id="eam0810_asset_management_result_ds" autoQuery="true" model="eam.eam0810.eam0810_asset_headers_query" modifiedcheck="false" pageSize="5" queryDataSet="eam0810_asset_management_query_ds" selectable="true" submitUrl="${/request/@context_path}/modules/eam/EAM0810/eam_asset_management_save.svc">
                <a:fields>
                    <a:field name="asset_id"/>
                    <a:field name="asset_name" prompt="资产名称"/>
                    <a:field name="asset_code" prompt="资产编号"/>
                    <a:field name="responsibility_center_desc" prompt="责任中心"/>
                    <a:field name="entity_man_unit_desc" prompt="管理部门"/>
                    <a:field name="using_unit_desc" prompt="折旧承担部门"/>
                    <a:field name="user_people"/>
                    <a:field name="req_employee_name" prompt="使用人"/>
                    <a:field name="asset_book_id"/>
                    <a:field name="category_id"/>
                    <a:field name="install_position"/>
                    <a:field name="status"/>
                    <a:field name="post_status"/>
                    <a:field name="post_status_desc" prompt="入账状态"/>
                    <a:field name="retirement_type"/>
                    <a:field name="retirement_type_desc" prompt="清理类型"/>
                    <a:field name="responsibility_center_id"/>
                    <a:field name="entity_unit_id"/>
                    <a:field name="using_unit_id"/>
                    <a:field name="supplier" readOnly="true"/>
                    <a:field name="price" prompt="EXP_REPORT_LINES.PRIC" readOnly="true"/>
                    <a:field name="contract_name" prompt="CON_CONTRACT_HEADERS.CONTRACT_NUMBER" readOnly="true"/>
                    <a:field name="asset_book_desc" displayField="asset_book_desc" options="eam0810_asset_books_list_ds" prompt="资产账簿" returnField="asset_book_id" valueField="asset_book_id"/>
                    <a:field name="description" prompt="EAM_ASSET_HEADERS.DESCRIPTION"/>
                    <a:field name="tag_number" prompt="资产卡片号"/>
                    <a:field name="status_desc" displayField="code_value_name" options="eam0810_asset_status_ds" prompt="EAM_ASSET_HEADERS.STATUS" readOnly="true" returnField="status" valueField="code_value"/>
                    <a:field name="serial_number" prompt="EAM_ASSET_HEADERS.SERIAL_NUMBER"/>
                    <a:field name="asset_source_type"/>
                    <a:field name="asset_source_type_desc" displayField="code_value_name" options="eam0810_asset_source_type_ds" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE" readOnly="true" returnField="asset_source_type" valueField="code_value"/>
                    <a:field name="lock_flag" checkedValue="Y" prompt="EAM_ASSET_HEADERS.LOCK_FLAG" readOnly="true" uncheckedValue="N"/>
                    <a:field name="date_of_purchase" prompt="EAM_ASSET_HEADERS.DATE_OF_PURCHASE" readOnly="true"/>
                    <a:field name="gain_date" prompt="EAM_ASSET_HEADERS.GAIN_DATE" readOnly="true"/>
                    <a:field name="start_use_date" prompt="EAM_ASSET_HEADERS.START_USE_DATE" readOnly="true"/>
                    <a:field name="asset_unit" prompt="EAM_ASSET_HEADERS.ASSET_UNIT"/>
                    <a:field name="asset_unit_desc" displayField="code_value_name" options="eam0310_u_measurement_ds" prompt="EAM_ASSET_HEADERS.ASSET_UNIT" returnField="asset_unit" valueField="code_value"/>
                    <a:field name="quantity" prompt="EAM_ASSET_HEADERS.QUANTITY" readOnly="true"/>
                    <a:field name="cost" prompt="EAM_ASSET_HEADERS.COST" readOnly="true"/>
                    <a:field name="is_valuable_flag"/>
                    <a:field name="category_sec_id"/>
                    <a:field name="using_unit_old_id"/>
                    <a:field name="using_unit_old_desc" readOnly="true"/>
                    <a:field name="category_sec_desc" displayField="description_sec" options="eam0810_asset_categories_list2_ds" prompt="资产小类" readOnly="true" returnField="category_id" valueField="category_id">
                        <a:mapping>
                            <a:map from="category_sec_id" to="category_sec_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="category_desc" displayField="code_value_name" options="eam0810_asset_categories_list_ds" prompt="EAM_ASSET_HEADERS.CATEGORY_ID" readOnly="true" returnField="category_code" title="EAM_ASSET_HEADERS.CATEGORY_ID" valueField="code_value">
                        <a:mapping>
                            <a:map from="code_value" to="category_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_class_id"/>
                    <a:field name="entity_class_desc" displayField="description" options="eam0810_asset_entity_class_list_ds" prompt="EAM_ASSET_HEADERS.ENTITY_CLASS_ID" readOnly="true" returnField="entity_class_id" valueField="class_id"/>
                    <a:field name="currency_code"/>
                    <a:field name="currency_name" prompt="EAM_TRANSACTION_ACCOUNTS.CURRENCY_CODE" readOnly="true"/>
                    <a:field name="reference_number"/>
                    <a:field name="price" readOnly="true"/>
                    <a:field name="category_sec_id"/>
                    <a:field name="description_sec"/>
                    <a:field name="invoice_number"/>
                    <a:field name="tag_number_old" readOnly="true"/>
                    <a:field name="category_old_id"/>
                    <a:field name="entity_class_old_id"/>
                    <a:field name="category_old_desc" readOnly="true"/>
                    <a:field name="category_sec_old_desc" readOnly="true"/>
                    <a:field name="entity_class_old_desc" readOnly="true"/>
                    <a:field name="location_id"/>
                    <a:field name="current_location_desc" readOnly="true"/>
                    <a:field name="location_type_desc" readOnly="true"/>
                    <a:field name="value_man_company_id"/>
                    <a:field name="value_man_company_desc" autoCompleteField="company_short_name_id" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_COMPANY_ID" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_id" to="value_man_company_id"/>
                            <a:map from="company_short_name" to="value_man_company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="value_man_unit_id"/>
                    <a:field name="value_man_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_UNIT_ID" readOnly="true" title="PUR_REQUISITION_ALLOCATE.UNIT_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="unit_id" to="value_man_unit_id"/>
                            <a:map from="unit_code_name" to="value_man_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="value_man_position_id"/>
                    <a:field name="value_man_position_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_position_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.VALUE_MAN_POSITION_ID" readOnly="true" title="BGT_BUDGET_ITEM_MAPPING.POSITION_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="position_id" to="value_man_position_id"/>
                            <a:map from="position_code_name" to="value_man_position_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_company_id"/>
                    <a:field name="entity_man_company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_MAN_COMPANY_ID" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_id" to="entity_company_id"/>
                            <a:map from="company_short_name" to="entity_man_company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_man_unit_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_unit_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_MAN_UNIT_ID" readOnly="true" title="PUR_REQUISITION_ALLOCATE.UNIT_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="unit_id" to="entity_unit_id"/>
                            <a:map from="unit_code_name" to="entity_man_unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="entity_position_id"/>
                    <a:field name="entity_man_position_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_exp_org_position_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.ENTITY_MAN_POSITION_ID" readOnly="true" title="BGT_BUDGET_ITEM_MAPPING.POSITION_CODE_SEARCH">
                        <a:mapping>
                            <a:map from="position_id" to="entity_position_id"/>
                            <a:map from="position_code_name" to="entity_man_position_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="responsibility_company_id"/>
                    <a:field name="responsibility_company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_COMPANY_ID" title="BGT_BUDGET_ITEM_MAPPING.COMPANY_SEARCH">
                        <a:mapping>
                            <a:map from="company_id" to="responsibility_company_id"/>
                            <a:map from="company_short_name" to="responsibility_company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="responsibility_center_desc" lovGridHeight="300" lovHeight="450" lovService="expm.exp_responsibility_center_lov" lovWidth="550" prompt="EAM_ASSET_HEADERS.RESPONSIBILITY_CENTER_ID" readOnly="true" title="FND_RESPONSIBILITY_CENTERS.RESPONSIBILITY_CENTER_ID">
                        <a:mapping>
                            <a:map from="responsibility_center_id" to="responsibility_center_id"/>
                            <a:map from="responsibility_center_name" to="responsibility_center_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="allocate_element_type"/>
                    <a:field name="allocate_element_type_desc" displayField="code_value_name" options="eam0810_asset_allocate_element_type_ds" returnField="allocate_element_type" valueField="code_value"/>
                    <a:field name="allocate_element_name"/>
                    <a:field name="copy_flag"/>
                    <a:field name="address" prompt="EAM_ASSET_HEADERS.ADDRESS" readOnly="true"/>
                    <a:field name="fin_class_desc" prompt="财务分类"/>
                    <a:field name="contract_num" prompt="合同号" readOnly="true"/>
                    <a:field name="price_tax" prompt="含税价" readOnly="true"/>
                    <a:field name="price_no_tax" prompt="不含税价" readOnly="true"/>
                    <a:field name="tax" prompt="税额" readOnly="true"/>
                    <a:field name="transfer_rate" prompt="转出比率" readOnly="true"/>
                    <a:field name="transfer_amount" prompt="转出金额" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="onUpdateFun"/>
                    <a:event name="submitsuccess" handler="submit_success"/>
                    <a:event name="load" handler="onAssetManLoad"/>
                    <a:event name="indexchange" handler="onIndexChangeFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam0810_eam_asset_finance_info_result_ds" bindName="finance_info" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_finance_info_query">
                <a:fields>
                    <a:field name="asset_finance_info_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="finance_class_id"/>
                    <a:field name="asset_card_num" readOnly="true"/>
                    <a:field name="depreciate_flag" prompt="EAM_ASSET_FINANCE_INFO.DEPRECIATE_FLAG"/>
                    <!-- readOnly="true" -->
                    <a:field name="currency_code" readOnly="true"/>
                    <a:field name="currency_desc" prompt="EAM_ASSET_FINANCE_INFO.CURRENCY_NAME" readOnly="true"/>
                    <a:field name="original_cost" readOnly="true"/>
                    <a:field name="current_cost" readOnly="true"/>
                    <a:field name="accumulated_dep_amt" readOnly="true"/>
                    <a:field name="impairment_loss_amt" readOnly="true"/>
                    <a:field name="salvage_value" readOnly="true"/>
                    <a:field name="start_depreciatite_date" readOnly="true"/>
                    <a:field name="last_depr_period_name" readOnly="true"/>
                    <a:field name="last_depr_date" readOnly="true"/>
                    <a:field name="life_in_month" readOnly="true"/>
                    <a:field name="remaining_life_in_month" readOnly="true"/>
                    <a:field name="scrap_cost" readOnly="true"/>
                    <a:field name="scrap_amount" readOnly="true"/>
                    <a:field name="annual_dep_amt" readOnly="true"/>
                    <a:field name="mount_dep_percent" readOnly="true"/>
                    <a:field name="mount_dep_percent_show" readOnly="true"/>
                    <a:field name="month_dep_amount" readOnly="true"/>
                    <a:field name="fin_class_old_desc" readOnly="true"/>
                    <a:field name="finance_class_desc" prompt="EAM_ASSET_FINANCE_INFO.FINANCE_CLASS_DESC" readOnly="true"/>
                    <a:field name="net_asset_value" readOnly="true"/>
                    <a:field name="depreciate_enable_flag" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="onFinLoad"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam0810_eam_asset_character_values_result_ds" autoPageSize="true" bindName="character_values" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_character_values_query" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_character_values_edit/batch_update">
                <a:fields>
                    <a:field name="character_value_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="character_id"/>
                    <a:field name="data_type"/>
                    <a:field name="required_flag"/>
                    <a:field name="character_desc" prompt="EAM_ASSET_CHARACTER_VALUES.CHARACTER_DESC" readOnly="true"/>
                    <a:field name="value" prompt="EAM_ASSET_CHARACTER_VALUES.VALUE"/>
                    <a:field name="memo" prompt="备注事项"/>
                </a:fields>
                <a:events>
                    <a:event name="beforesubmit" handler="onValuesBeforeSubmitFun"/>
                    <a:event name="load" handler="onAssetCharacterValuesLoad"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam0810_eam_asset_allocations_result_ds" bindName="allocations" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_allocations_query" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_allocations_edit/batch_update">
                <a:fields>
                    <a:field name="allocation_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="company_id"/>
                    <a:field name="company_desc" lovGridHeight="300" lovHeight="450" lovService="eam.eam0030.eam0030_companies_vl_set_of_books_lov" lovWidth="550" prompt="行社" required="true" title="行社">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_short_name" to="company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="responsibility_center_id"/>
                    <a:field name="responsibility_center_desc" lovGridHeight="300" lovHeight="450" lovService="expm.exp_responsibility_center_lov" lovWidth="550" prompt="EAM_ASSET_ALLOCATIONS.RESPONSIBILITY_CENTER_DESC" required="true" title="FND_RESPONSIBILITY_CENTERS.RESPONSIBILITY_CENTER_ID">
                        <a:mapping>
                            <a:map from="responsibility_center_id" to="responsibility_center_id"/>
                            <a:map from="responsibility_center_name" to="responsibility_center_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="quantity"/>
                    <a:field name="memo"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="onAllocationsUpdateFun"/>
                    <a:event name="beforesubmit" handler="onAllocationsBeforeSubmitFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eam0810_eam_asset_cost_source_result_ds" autoQuery="true" bindName="cost_source" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_asset_cost_sources_query" selectable="true">
                <a:fields>
                    <a:field name="cost_source_id"/>
                    <a:field name="source_type" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE" readOnly="true"/>
                    <a:field name="source_type_desc" prompt="EAM_ASSET_HEADERS.ASSET_SOURCE_TYPE" readOnly="true"/>
                    <a:field name="source_asset_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="source_asset_code" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_CODE" readOnly="true"/>
                    <a:field name="source_asset_name" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_NAME" readOnly="true"/>
                    <a:field name="source_asset_cost" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_COST" readOnly="true"/>
                    <a:field name="source_asset_sum_cost" prompt="EAM_ASSET_COST_SOURCES.SOURCE_ASSET_SUM_COST" readOnly="true"/>
                    <a:field name="cost_value_type" readOnly="true"/>
                    <a:field name="cost_value_type_desc" prompt="EAM_ASSET_COST_SOURCES.COST_VALUE_TYPE" readOnly="true"/>
                    <a:field name="cost" prompt="EAM_ASSET_COST_SOURCES.COST" readOnly="true"/>
                    <a:field name="cost_value" prompt="EAM_ASSET_COST_SOURCES.COST" readOnly="true"/>
                    <a:field name="final_cost" prompt="EAM_ASSET_COST_SOURCES.FINAL_COST" readOnly="true"/>
                    <a:field name="confirm_status" prompt="EAM_ASSET_COST_SOURCES.CONFIRM_STATUS" readOnly="true"/>
                    <a:field name="setlement_date" prompt="EAM_ASSET_COST_SOURCES.SETLEMENT_DATE" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <!--租入信息 -->
            <a:dataSet id="eam0810_eam_asset_lease_info_result_ds" autoQuery="true" bindName="lease_info" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam0810_eam_asset_lease_info_query" selectable="true" submitUrl="${/request/@context_path}/autocrud/eam.eam0810.eam0810_asset_lease_info_edit/batch_update">
                <a:fields>
                    <a:field name="lease_id"/>
                    <a:field name="asset_id"/>
                    <a:field name="contract_header_id"/>
                    <a:field name="contract_header_num" lovGridHeight="300" lovHeight="460" lovService="eam.lease_contract_lov" lovWidth="500" prompt="EAM_ASSET_LEASE_INFO.CONTRACT_HEADER_NUM" readOnly="true" title="EAM_ASSET_LEASE_INFO.CONTRACT_HEADER_NUM">
                        <a:mapping>
                            <a:map from="contract_number" to="contract_header_num"/>
                            <a:map from="contract_header_id" to="contract_header_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="lease_price" prompt="EAM_ASSET_LEASE_INFO.LEASE_PRICE" readOnly="true"/>
                    <a:field name="price" prompt="EAM_ASSET_LEASE_INFO.PRICE" readOnly="true"/>
                    <a:field name="currency" prompt="EAM_ASSET_LEASE_INFO.CURRENCY_CODE" readOnly="true"/>
                    <a:field name="lessor" prompt="EAM_ASSET_LEASE_INFO.LESSOR" readOnly="true"/>
                    <a:field name="certificate_type" prompt="EAM_ASSET_LEASE_INFO.CERTIFICATE_TYPE" readOnly="true"/>
                    <a:field name="certificate_num" prompt="EAM_ASSET_LEASE_INFO.CERTIFICATE_NUM" readOnly="true"/>
                    <a:field name="rent_date_from" prompt="EAM_ASSET_LEASE_INFO.RENT_DATE_FROM" readOnly="true"/>
                    <a:field name="rent_date_to" prompt="EAM_ASSET_LEASE_INFO.RENT_DATE_TO" readOnly="true"/>
                    <a:field name="free_date_from" prompt="EAM_ASSET_LEASE_INFO.FREE_DATE_FROM" readOnly="true"/>
                    <a:field name="free_date_to" prompt="EAM_ASSET_LEASE_INFO.FREE_DATE_TO" readOnly="true"/>
                    <a:field name="payment_cycle" prompt="EAM_ASSET_LEASE_INFO.PAYMENT_CYCLE" readOnly="true"/>
                    <a:field name="unit_rent" prompt="EAM_ASSET_LEASE_INFO.UNIT_RENT" readOnly="true"/>
                    <a:field name="rent_unit" prompt="EAM_ASSET_LEASE_INFO.RENT_UNIT" readOnly="true"/>
                    <a:field name="record_flag" prompt="EAM_ASSET_LEASE_INFO.RECORD_FLAG" readOnly="true"/>
                    <a:field name="payment_cycle_desc" displayField="code_value_name" options="eam0310_payment_cycle_ds" prompt="EAM_ASSET_LEASE_INFO.PAYMENT_CYCLE" readOnly="true" returnField="payment_cycle" valueField="code_value"/>
                    <a:field name="cash_pledge" prompt="EAM_ASSET_LEASE_INFO.CASH_PLEDGE" readOnly="true"/>
                    <a:field name="liquidated_damages" prompt="EAM_ASSET_LEASE_INFO.LIQUIDATED_DAMAGES" readOnly="true"/>
                    <a:field name="payment_record" prompt="EAM_ASSET_LEASE_INFO.PAYMENT_RECORD" readOnly="true"/>
                    <a:field name="house_rent_num" prompt="EAM_ASSET_LEASE_INFO.HOUSE_RENT_NUM" readOnly="true"/>
                    <a:field name="management_cost" prompt="EAM_ASSET_LEASE_INFO.MANAGEMENT_COST" readOnly="true"/>
                    <a:field name="floating_rentcal" prompt="EAM_ASSET_LEASE_INFO.FLOATING_RENTCAL" readOnly="true"/>
                    <a:field name="asset_usage"/>
                    <a:field name="asset_usage_desc" displayField="usage_name" options="eam0810_asset_usage_type_ds" prompt="EAM_ASSET_LEASE_INFO.ASSET_USAGE" readOnly="true" returnField="asset_usage" valueField="usage_id"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="eam0810_eam_asset_deprn_detail_ds" bindName="deprn_info" bindTarget="eam0810_asset_management_result_ds" model="eam.eam0810.eam_asset_dep_details"/>
        </a:dataSets>
        <a:screenBody>
            <a:form column="4" labelWidth="90" title="EAM_ASSET_HEADERS.TITLE" width="1024">
                <a:comboBox name="asset_book_desc" bindTarget="eam0810_asset_management_query_ds">
                    <a:events>
                        <a:event name="select" handler="assetSelectFun"/>
                    </a:events>
                </a:comboBox>
                <a:textField name="tag_number" bindTarget="eam0810_asset_management_query_ds" prompt="资产卡片号"/>
                <a:textField name="description" bindTarget="eam0810_asset_management_query_ds" prompt="资产名称"/>
                <a:comboBox name="status_desc" bindTarget="eam0810_asset_management_query_ds"/>
                <a:comboBox name="category_desc" bindTarget="eam0810_asset_management_query_ds" prompt="资产大类">
                    <a:events>
                        <a:event name="select" handler="categorySelectFun"/>
                    </a:events>
                </a:comboBox>
                <a:comboBox name="category_sec_desc" bindTarget="eam0810_asset_management_query_ds" prompt="资产小类">
                    <a:events>
                        <a:event name="select" handler="category_secSelectFun"/>
                    </a:events>
                </a:comboBox>
                <a:comboBox name="fin_class_desc" bindTarget="eam0810_asset_management_query_ds">
                    <a:events>
                        <a:event name="select" handler="finSelectFun"/>
                    </a:events>
                </a:comboBox>
                <a:comboBox name="entity_class_desc" bindTarget="eam0810_asset_management_query_ds"><![CDATA[      
                ]]></a:comboBox>
                <!--<a:textField name="tag_number" bindTarget="eam0810_asset_management_query_ds">
                    <a:events>
                        <a:event name="enterdown" handler="eam0810_queryFun"/>
                    </a:events>
                </a:textField>-->
                <a:lov name="responsibility_company_name" bindTarget="eam0810_asset_management_query_ds" prompt="折旧承担机构"/>
                <a:lov name="using_unit_name" bindTarget="eam0810_asset_management_query_ds" prompt="折旧承担部门"/>
                <a:checkBox name="all_company_flag" Width="120" bindTarget="eam0810_asset_management_query_ds" prompt="包含子机构"/>
                <!-- <a:textField name="serial_number" bindTarget="eam0810_asset_management_query_ds"/> -->
            </a:form>
            <!-- 按钮 -->
            <a:hBox>
                <a:button click="eam0810_queryFun" text="HAP_QUERY"/>
                <a:button click="eam0810_resetFun" text="HAP_RESET"/>
                <a:button click="eam0810_saveAssetMan" text="HAP_SAVE"/>
                <!-- <a:button click="printFunction" text="打印资产卡片"/>
                <a:button click="othermessageprintFunction" text="打印资产信息附注"/>
                <a:button click="print_asset" text="PROMPT.PRINT_ASSET"/> -->
            </a:hBox>
            <a:grid bindTarget="eam0810_asset_management_result_ds" height="220" navBar="true" selectable="true" selectionModel="single" width="1024">
                <!-- <a:toolBar>
                    <a:button type="add"/>
                    <a:button type="save"/>
                    <a:button type="delete"/>
                </a:toolBar> -->
                <a:toolBar>
                    <a:label/>
                </a:toolBar>
                <a:columns>
                    <a:column name="asset_book_desc" align="center" width="120"/>
                    <a:column name="tag_number" align="center" width="120"/>
                    <a:column name="description" align="center" width="160"/>
                    <!-- <a:column name="asset_code" align="center" width="80"/> -->
                    <a:column name="status_desc" align="center" width="80"/>
                    <a:column name="post_status_desc" align="center" width="80"/>
                    <!-- <a:column name="retirement_type_desc" align="center" width="80"/>
                    <a:column name="responsibility_center_desc" align="center" width="115"/> -->
                    <a:column name="category_desc" align="center" width="80"/>
                    <a:column name="fin_class_desc" align="center" width="80"/>
                    <a:column name="entity_class_desc" align="center" width="80"/>
                    <!-- <a:column name="entity_man_unit_desc" align="center" width="100"/> -->
                    <a:column name="responsibility_company_desc" align="center" prompt="折旧承担机构  " width="100"/>
                    <a:column name="using_unit_desc" align="center" width="100"/>
                    <a:column name="req_employee_name" align="center" width="80"/>
                </a:columns>
                <a:editors>
                    <a:comboBox id="eam0810_cbbx"/>
                    <a:textField id="eam0810_tf"/>
                    <a:textField id="eam0810_tf_upper" typeCase="upper"/>
                    <a:comboBox id="eam0810_cmb"/>
                </a:editors>
            </a:grid>
            <a:tabPanel id="eam0810_asset_management_tab" height="280" width="1024">
                <a:tabs>
                    <!--基本信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.BASIC_INFORMATION" width="80">
                        <a:form column="1" height="200" labelWidth="100" width="960">
                            <a:box column="3" labelWidth="130">
                                <a:textField name="serial_number" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:comboBox name="asset_source_type_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:textField name="currency_name" bindTarget="eam0810_asset_management_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <!-- <a:textField name="reference_number" bindTarget="eam0810_asset_management_result_ds" prompt="批准文号"/> -->
                                <a:datePicker name="start_use_date" bindTarget="eam0810_asset_management_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:comboBox name="asset_unit_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:numberField name="quantity" allowDecimals="false" allowNegative="false" bindTarget="eam0810_asset_management_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="price_tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="price_no_tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="tax" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="transfer_rate" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <a:numberField name="transfer_amount" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <!--<a:lov name="category_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                                <a:numberField name="price" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2" readOnly="true"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="cost" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_asset_management_result_ds" decimalPrecision="2"/>
                                <!--<a:lov name="category_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                                <a:textField name="category_sec_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产小类"/>
                                <a:textField name="entity_class_desc" bindTarget="eam0810_asset_management_result_ds" prompt="资产实物分类"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:textField name="invoice_number" bindTarget="eam0810_asset_management_result_ds" prompt="发票号"/>
                                <a:textField name="category_old_desc" bindTarget="eam0810_asset_management_result_ds" prompt="原资产大类"/>
                                <a:textField name="category_sec_old_desc" bindTarget="eam0810_asset_management_result_ds" prompt="原资产小类"/>
                                <!--<a:textField name="status_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                                <!--<a:lov name="supplier" bindTarget="eam0810_asset_management_result_ds" prompt="供应商"/>-->
                                <!--<a:textField name="supplier" bindTarget="eam0810_asset_management_result_ds" prompt="供应商"/>-->
                                <!--<a:lov name="entity_class_desc" bindTarget="eam0810_asset_management_result_ds"/>-->
                            </a:box>
                            <!-- <a:box column="3" labelWidth="130"> -->
                            <!-- <a:textField name="tag_number_old" bindTarget="eam0810_asset_management_result_ds" prompt="原卡片号"/> -->
                            <!--<a:textField name="user_people" bindTarget="eam0810_asset_management_result_ds" prompt="使用人"/>-->
                            <!-- </a:box> -->
                            <a:box column="3" labelWidth="130">
                                <a:textField name="entity_class_old_desc" bindTarget="eam0810_asset_management_result_ds" prompt="原资产实物分类"/>
                                <!--  <a:textField name="using_unit_old_desc" bindTarget="eam0810_asset_management_result_ds" prompt="原使用部门"/> -->
                                <a:textField name="contract_num" bindTarget="eam0810_asset_management_result_ds"/>
                                <a:checkBox name="lock_flag" bindTarget="eam0810_asset_management_result_ds" prompt="锁定标识"/>
                            </a:box>
                        </a:form>
                    </a:tab>
                    <!--财务信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.FINANCIAL_INFORMATION" width="80">
                        <a:form column="1" height="200" labelWidth="100" width="960">
                            <a:box column="3" labelWidth="130">
                                <a:textField name="finance_class_desc" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>
                                <!--<a:textField name="asset_card_num" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>-->
                                <a:textField name="currency_desc" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>
                                <!-- 
			                    	modified by majianjian at 2013-12-16 14:35 
			                    	是的，你没有看错，original_cost在这里就是总成本
			                    	end modify
			                    	-->
                                <a:numberField name="original_cost" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" prompt="原始成本" renderer="Aurora.formatMoney"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:numberField name="current_cost" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                                <a:numberField name="annual_dep_amt" bindTarget="eam0810_eam_asset_finance_info_result_ds" renderer="Aurora.formatMoney"/>
                                <a:numberField name="accumulated_dep_amt" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                                <!---->
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <!--  <a:textField name="mount_dep_percent_show" bindTarget="eam0810_eam_asset_finance_info_result_ds" prompt="月折旧率"/> -->
                                <a:numberField name="month_dep_amount" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" prompt="月折旧额" renderer="Aurora.formatMoney"/>
                                <a:numberField name="impairment_loss_amt" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                                <a:numberField name="salvage_value" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                            </a:box>
                            <a:box column="3" labelWidth="130">
                                <a:textField name="start_depreciatite_date" bindTarget="eam0810_eam_asset_finance_info_result_ds" renderer="Aurora.formatDate"/>
                                <a:numberField name="life_in_month" allowDecimals="false" allowNegative="false" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>
                                <!--<a:textField name="scrap_cost" bindTarget="eam0810_eam_asset_finance_info_result_ds" renderer="Aurora.formatMoney"/>-->
                                <a:numberField name="remaining_life_in_month" allowDecimals="false" allowNegative="false" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>
                                <a:numberField name="scrap_amount" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                                <a:textField name="last_depr_period_name" bindTarget="eam0810_eam_asset_finance_info_result_ds"/>
                                <a:textField name="last_depr_date" bindTarget="eam0810_eam_asset_finance_info_result_ds" renderer="Aurora.formatDate"/>
                                <a:textField name="fin_class_old_desc" bindTarget="eam0810_eam_asset_finance_info_result_ds" prompt="原财务分类"/>
                                <a:numberField name="net_asset_value" bindTarget="eam0810_eam_asset_finance_info_result_ds" decimalPrecision="2" renderer="Aurora.formatMoney"/>
                                <a:checkBox name="depreciate_flag" bindTarget="eam0810_eam_asset_finance_info_result_ds" checkedValue="Y" uncheckedValue="N" width="152"/>
                            </a:box>
                        </a:form>
                    </a:tab>
                    <!--位置信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.LOCATION_INFORMATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_location_histories.screen" width="80"/>
                    <!--产权信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.PROPERTY_INFORMATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_property_info.screen" width="80"/>
                    <!--保险信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.INSURANCE_INFORMATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_insure_info.screen" width="80"/>
                    <!--合作伙伴 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.PARTNERS" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_partner_info.screen" width="80"/>
                    <!--特性参数 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.CHARACTERISTIC_PARAMETERS" width="80">
                        <a:grid bindTarget="eam0810_eam_asset_character_values_result_ds" height="179" navBar="true" width="960">
                            <a:toolBar><![CDATA[
                            ]]></a:toolBar>
                            <a:columns>
                                <a:column name="character_desc" align="center" width="180"/>
                                <a:column name="value" align="center" width="240"/>
                                <a:column name="memo" align="center" width="400"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="eam0810_character_tf"/>
                                <a:textField id="eam0810_character_values_tf"/>
                                <a:numberField id="eam0810_character_values_nf" allowDecimals="true" allowFormat="true" allowNegative="false" decimalPrecision="2"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <!--文档信息 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.DOCUMENT_INFORMATION" width="80"/>
                    <!--分摊分配 -->
                    <!-- <a:tab height="100" prompt="EAM_ASSET_HEADERS.SHARING_ALLOCATION" width="80">
                        <a:grid bindTarget="eam0810_eam_asset_allocations_result_ds" height="160" navBar="true" width="960">
                            <a:columns>
                                <a:column name="company_desc" align="center" editor="eam0810_allocations_company_desc_lv" width="120"/>
                                <a:column name="responsibility_center_desc" align="center" editor="eam0810_allocations_resp_desc_lv" width="200"/>
                                <a:column name="quantity" align="right" editor="eam0810_allocations_quantity_nf" width="120"/>
                                <a:column name="memo" align="center" editor="eam0810_allocations_memo_tf" width="400"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="eam0810_allocations_company_desc_lv"/>
                                <a:lov id="eam0810_allocations_resp_desc_lv"/>
                                <a:numberField id="eam0810_allocations_quantity_nf"/>
                                <a:textField id="eam0810_allocations_memo_tf"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="gridAllocationsCellClick"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
 -->
                    <!--成本来源 -->
                    <a:tab height="100" prompt="EAM_ASSET_HEADERS.EAM_ASSET_COST_SOURCES" width="80">
                        <a:grid bindTarget="eam0810_eam_asset_cost_source_result_ds" height="160" navBar="true" width="960">
                            <a:columns>
                                <a:column name="source_type_desc" align="center" width="80"/>
                                <a:column name="source_asset_code" align="center" width="100"/>
                                <a:column name="source_asset_name" align="center" width="100"/>
                                <a:column name="source_asset_cost" align="right" renderer="Aurora.formatMoney" width="80"/>
                                <a:column name="source_asset_sum_cost" align="right" renderer="Aurora.formatMoney" width="80"/>
                                <a:column name="cost_value_type_desc" align="center" width="80"/>
                                <a:column name="cost_value" align="right" renderer="Aurora.formatMoney" width="80"/>
                                <a:column name="confirm_status" align="center" width="80"/>
                                <a:column name="final_cost" align="right" renderer="Aurora.formatMoney" width="80"/>
                                <a:column name="setlement_date" align="center" width="80"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <!--租入信息 -->
                    <!--  <a:tab height="100" prompt="租入信息" width="80">
                        <a:form column="1" height="200">
                            <a:box column="3" labelWidth="140">
                                <a:lov name="contract_header_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="lease_price" allowDecimals="true" allowFormat="true" allowNegative="true" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                                <a:numberField name="price" allowDecimals="true" allowFormat="true" allowNegative="true" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:comboBox name="currency_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="lessor" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="certificate_type" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="certificate_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:datePicker name="rent_date_from" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:datePicker name="rent_date_to" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:comboBox name="payment_cycle_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                            </a:box>
                            <a:box column="4" labelWidth="140">
                                <a:datePicker name="free_date_from" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:datePicker name="free_date_to" bindTarget="eam0810_eam_asset_lease_info_result_ds"><![CDATA[
                                ]]></a:datePicker>
                                <a:numberField name="unit_rent" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="rent_unit" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="cash_pledge" allowDecimals="true" allowFormat="true" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                                <a:numberField name="liquidated_damages" allowDecimals="true" allowFormat="true" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="payment_record" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:textField name="house_rent_num" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:numberField name="management_cost" allowDecimals="true" allowFormat="true" bindTarget="eam0810_eam_asset_lease_info_result_ds" decimalPrecision="2"/>
                            </a:box>
                            <a:box column="3" labelWidth="140">
                                <a:textField name="floating_rentcal" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:comboBox name="asset_usage_desc" bindTarget="eam0810_eam_asset_lease_info_result_ds"/>
                                <a:checkBox name="record_flag" bindTarget="eam0810_eam_asset_lease_info_result_ds">
                                    <a:events>
                                        <a:event name="change" handler="onRecordFlagChange"/>
                                    </a:events>
                                </a:checkBox>
                            </a:box>
                        </a:form>
                    </a:tab> -->
                    <!--折旧信息 -->
                    <a:tab height="100" prompt="折旧信息" width="80">
                        <a:grid bindTarget="eam0810_eam_asset_deprn_detail_ds" height="160" navBar="true" width="960">
                            <a:columns>
                                <a:column name="period_name" align="center" prompt="折旧期间" width="80"/>
                                <a:column name="dep_run_date" align="center" prompt="折旧日期" renderer="Aurora.formatDate" width="100"/>
                                <a:column name="dep_amount" align="right" prompt="本月累计折旧额" renderer="Aurora.formatMoney" width="120"/>
                                <a:column name="dep_sys_amount" align="right" prompt="月折旧额" renderer="Aurora.formatMoney" width="120"/>
                                <a:column name="dep_adj_amount" align="right" prompt="折旧调整金额" renderer="Aurora.formatMoney" width="120"/>
                                <a:column name="ytd_dep_amount" align="right" prompt="本年折旧" renderer="Aurora.formatMoney" width="120"/>
                                <a:column name="accumulated_dep_amt" align="right" prompt="累计折旧" renderer="Aurora.formatMoney" width="120"/>
                                <a:column name="accounts_info" align="center" renderer="accounts_info_func" width="80"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <!-- <a:tab height="100" prompt="EAM_ASSET_HEADERS.CHARACTERISTIC_PARAMETERS" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_character_values.screen" width="80"/> -->
                    <!-- <a:tab height="100" prompt="维护维修信息" width="100">
                        <a:grid id="maintenace" bindtarget="eam_asset_readonly_maintenace_ds" height="160" navBar="true" width="890">
                            <a:columns>
                                <a:column name="maintenace_date" align="center" prompt="日期" renderer="Aurora.formatDate"/>
                                <a:column name="maintenace" align="center" prompt="维护维修信息" width="400"/>
                                <a:column name="report_line_amount" align="right" prompt="金额" renderer="Aurora.formatMoney" width="100"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>-->
                    <!-- <a:tab height="100" prompt="EAM_ASSET_HEADERS.SHARING_ALLOCATION" ref="${/request/@context_path}/modules/eam/EAM0810/eam_asset_allocations.screen" width="80"/> -->
                    <!-- <a:tab height="100" prompt="EAM_ASSET_HEADERS.ORGANIZATIONAL_STRUCTURE" width="80">
                        <a:form column="1" height="200" labelWidth="100" width="890">
                            <a:fieldSet title="EAM_LOCATIONS.VALUE_MAN_ORG">
                                <a:box column="3">
                                    <a:lov name="value_man_company_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                    <a:lov name="value_man_unit_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                    <a:lov name="value_man_position_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                </a:box>
                            </a:fieldSet>
                            <a:fieldSet title="EAM_LOCATIONS.ENTITY_MAN_ORG">
                                <a:box column="3">
                                    <a:lov name="entity_man_company_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                    <a:lov name="entity_man_unit_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                    <a:lov name="entity_man_position_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                </a:box>
                            </a:fieldSet>
                            <a:fieldSet title="EAM_ASSET_HEADERS.RESPONSIBILITY_ATTRIBUTION">
                                <a:box column="3">
                                    <a:lov name="responsibility_company_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                    <a:lov name="responsibility_center_desc" bindTarget="eam0810_asset_management_result_ds"/>
                                </a:box>
                            </a:fieldSet>
                        </a:form>
                    </a:tab> -->
                    <!-- <a:tab height="100" prompt="事务记录" width="80">
                        <a:grid bindTarget="eam0810_eam_asset_deprn_detail_ds" height="310" marginWidth="20" navBar="true" style="width:99%">
                            <a:columns>
                                <a:column name="write_off_date" prompt="卡片号" width="90"/>
                                <a:column name="period_name" prompt="基础事务" width="80"/>
                                <a:column name="write_off_type" prompt="单据编号" width="125"/>
                                <a:column name="transaction_class" prompt="单据确认日期" width="80"/>
                                <a:column name="exp_report_number" prompt="事务凭证" renderer="docdetail" width="125"/>
                                <a:column name="transaction_num" prompt="详细信息" width="125"/>
                            </a:columns>
                            <a:editors>
                                <a:numberField id="numf"/>
                            </a:editors>
                        </a:grid>
                    </a:tab> -->
                </a:tabs>
                <a:events>
                    <a:event name="select" handler="tabSelectFunction"/>
                </a:events>
            </a:tabPanel>
        </a:screenBody>
        <script><![CDATA[
            function init() {
                $('eam0810_asset_categories_list_ds').setQueryParameter('asset_book_id', '${/model/eam0020_asset_books_list/record/@asset_book_id}');
                $('eam0810_asset_categories_list_ds').query();
            
                // //资产大类修改时财务分类联动改变
                // if (name == 'category_id') {
                // //alert(record.get("category_id"));
                // record.set('fin_class_id', '');
                // record.set('entity_class_id', '');
                // record.set('fin_class_desc', '');
                // record.set('entity_class_desc', '');
                // record.getMeta().getField('fin_class_desc').setReadOnly(false);
                // record.getMeta().getField('entity_class_desc').setReadOnly(false);
                // $('eam0810_asset_fin_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                // $('eam0810_asset_fin_class_list_ds').query();
                // //资产大类修改时实物分类联动改变
                // $('eam0810_asset_entity_class_list_ds').setQueryParameter('category_id', record.get("category_id"));
                // $('eam0810_asset_entity_class_list_ds').query();
                // }
            
                $('eam0810_eam_asset_character_values_result_ds').modifiedcheck = false;
                var query_record = $('eam0810_asset_management_query_ds').getAt(0);
                query_record.set('responsibility_company_id', '${/model/currentCompanyInfo/record/@company_id}');
                query_record.set('responsibility_company_name', '${/model/currentCompanyInfo/record/@company_short_name}');
            }
            init();
        ]]></script>
    </a:view>
</a:screen>
