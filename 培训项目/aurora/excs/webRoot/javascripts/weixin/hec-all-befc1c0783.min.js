/**
 * ==================  angular-ios9-uiwebview.patch.js v1.1.1 ==================
 *
 * This patch works around iOS9 UIWebView regression that causes infinite digest
 * errors in Angular.
 *
 * The patch can be applied to Angular 1.2.0 – 1.4.5. Newer versions of Angular
 * have the workaround baked in.
 *
 * To apply this patch load/bundle this file with your application and add a
 * dependency on the "ngIOS9UIWebViewPatch" module to your main app module.
 *
 * For example:
 *
 * ```
 * angular.module('myApp', ['ngRoute'])`
 * ```
 *
 * becomes
 *
 * ```
 * angular.module('myApp', ['ngRoute', 'ngIOS9UIWebViewPatch'])
 * ```
 *
 *
 * More info:
 * - https://openradar.appspot.com/22186109
 * - https://github.com/angular/angular.js/issues/12241
 * - https://github.com/driftyco/ionic/issues/4082
 *
 *
 * @license AngularJS
 * (c) 2010-2015 Google, Inc. http://angularjs.org
 * License: MIT
 */

angular.module('ngIOS9UIWebViewPatch', ['ng']).config(['$provide', function($provide) {
    'use strict';

    $provide.decorator('$browser', ['$delegate', '$window', function($delegate, $window) {


        if (isIOS9UIWebView($window.navigator.userAgent)) {
            return applyIOS9Shim($delegate);
        }

        return $delegate;

        function isIOS9UIWebView(userAgent) {
            return /(iPhone|iPad|iPod).* OS 9_\d/.test(userAgent) && !/Version\/9\./.test(userAgent);
        }

        function applyIOS9Shim(browser) {
            var pendingLocationUrl = null;
            var originalUrlFn= browser.url;

            browser.url = function() {
                if (arguments.length) {
                    pendingLocationUrl = arguments[0];
                    return originalUrlFn.apply(browser, arguments);
                }

                return pendingLocationUrl || originalUrlFn.apply(browser, arguments);
            };

            window.addEventListener('popstate', clearPendingLocationUrl, false);
            window.addEventListener('hashchange', clearPendingLocationUrl, false);

            function clearPendingLocationUrl() {
                pendingLocationUrl = null;
            }

            return browser;
        }
    }]);
}]);
!function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/weixinlogin.html",'<ion-view hide-nav-bar="true" ng-controller="WeixinLoginCtrl"> <ion-content> <div class="load8"> <div class="load8-container container1"> <div class="circle1"> <div class="circle2"> <div class="circle3"> <div class="circle4"> </div> <div class="load8-container container2"> <div class="circle1"> <div class="circle2"> <div class="circle3"> <div class="circle4"> </div> <div class="load8-container container3"> <div class="circle1"> <div class="circle2"> <div class="circle3"> <div class="circle4"> </div> </div> </div></div></div></div></div></div></div></div></div></div></div></div></ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/home/home.html",'<ion-view view-title="君康人寿费控" ng-controller="HomeController" hide-back-button="true" cache-view="true" hide-nav-bar="true"> <ion-content id="home-main" scroll="false" style="background: #EFF4F7;"> <div class="home-main-body fill-parent"> <div class="top-image fill-width slider-img-block" style="height: auto"> <img id="bohai-logo-img" class="fill-parent" src="images/weixin/index_02.png"> </div> <div id="main-body-bottom"> <hec-nine-block delegate-handle="fun-list" base-url="{{config.baseUrlName}}" nine-data-local="" from-remote="true" nine-data-remote-url="autocrud/weixin.sys.sys_user_mobile_function_query/query"> </hec-nine-block></div> </div> </ion-content> </ion-view> ')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/home/main.html",'<ion-view view-title="君康人寿费控" hide-back-button="true" cache-view="true" hide-nav-bar="true"> <ion-nav-view name="homeContent"></ion-nav-view> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/templates/hecNineBlock.html",'<div class="hecui-nine-block-wrapper nine" ng-class="{\'three-line\':(config.nineBlockData.length==3),\'four-line\':(config.nineBlockData.length==4)}"> <div class="hec-nine-block-container fill-parent" style="background-color: white;position: relative;top: -.3em;"> <style>\n            .hecui-nine-block-wrapper .hec-line-cell {\n                display: table-cell;\n                vertical-align: middle;\n                text-align: center;\n                border-right: 1px solid #E4DFDF;\n                border-bottom: 1px solid #E4DFDF;\n            } \n            .yd-home-count-tip {\n                position: relative;\n                top: -.2rem;\n                left: -.2rem;\n            }\n\n            .count-waiting-tip-bg {\n                background-color: transparent !important;\n            }\n        </style> <div class="hec-nine-block fill-parent"> <div class="hec-line" ng-repeat="line in config.nineBlockData" ng-class="{\'first\':($index==0),\'last\':(($index+1)==config.nineBlockData.length)}"> <div ng-if="setLine($index)"></div> <div class="hec-line-cell" ng-repeat="cell in line" ng-class="{\'first\':($index==0),\'last\':(($index+1)==config.nineBlockData.length)}"> <div ng-if="!cell.fun_name"> <div ng-if="setlie($index,config.nineBlockData)"> <span class="icon ion-plus" style="color: #dee4e8;"></span>  </div> </div> <div class="hec-9grid-cell" ng-click="goState(cell.fun_url);"> <div class="hec-icon-wrapper"> <div class="hec-count-tip" ng-class="{\'count-tip-bg\':(cell.hasGotCount),\'count-waiting-tip-bg\':(!cell.hasGotCount)}" ng-if="cell.needGotCount" style="background-color: #e22e26;border: 2px solid white;height: 1.75em;width: 1.75em;"> <ion-spinner class="yd-home-count-tip" icon="ios-small" ng-if="!cell.hasGotCount"></ion-spinner> <span ng-if="cell.hasGotCount" style="color: white;position:relative;top:-2px;"> {{cell.count_number}} </span> </div> <img src="{{cell.fun_icon}}" style="width: 3em;" ng-if="cell.fun_icon != undefined"> </div> <div class="hec-fun-name"> <span>{{cell.fun_name}}</span> </div> </div> </div> </div> </div> </div> </div>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/user/abs_user.html",'  <ion-view hide-back-button="false" cache-view="false" hide-nav-bar="false"> <ion-nav-view name="userContent"></ion-nav-view> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/user/user_info.html",' <ion-view view-title="员工信息" id="hec-wfl-user-info-view" cache-view="false" ng-controller="UserInfoController"> <ion-content id="hec-wfl-user-content"> <style>\n            .user-info-header-image {\n                background: url("images/weixin/user_info_logo.png");\n                background-repeat: no-repeat;\n                background-size: 100% 100%;\n                width: 100%;\n                height: 8.5rem;\n            }            \n        </style> <div ng-if="config.userInfo" class="user-info-header-image"> <div style="position: absolute;top: 1.25rem;left:0;right:0;margin:auto;margin: auto;width: 4rem;height: 4rem;border-radius: 50%;border: 1px solid white;text-align: center;"> <img ng-if="config.userInfo.exp_emp_weixin_avatar" style="width: 3.625rem;height: 3.625rem;border-radius: 50%;position: relative;top: 2px;" src="{{config.userInfo.exp_emp_weixin_avatar}}"> <img ng-if="!config.userInfo.exp_emp_weixin_avatar" style="width: 3.625rem;height: 3.625rem;border-radius: 50%;position: relative;top: 2px;" src="images/weixin/icon_avatar_default.png"> </div> <div style="position: absolute;top: 5.5rem;left:0;right:0;margin:auto;width: 10rem;height: 2rem;line-height: 2rem;text-align: center;font-size: 1.5rem;color: #fff;"> <span ng-bind="config.userInfo.exp_emp_name"></span> </div> </div> <div ng-if="config.userInfo"> <div class="row" style="margin: 0.25rem 0"> <div style="width: 3rem;height: 3rem;line-height: 3rem;margin-left: 0.5rem;text-align: center;font-size: 2rem;">  <img src="images/weixin/user_info_tel.png" style="width: 2.25rem;height: 2.25rem;margin-top: 0.375rem;"> </div> <div> <div style="font-size: 1.125rem;font-weight: bold;color: #333;height: 1.5rem;line-height: 1.5rem;"> {{config.userInfo.exp_emp_mobile}} </div> <div style="font-size: 1rem;color: #999;height: 1.5rem;line-height: 1.5rem;">电话</div> </div> </div> <div class="row" style="margin: 0.25rem 0"> <div style="width: 3rem;height: 3rem;line-height: 3rem;margin-left: 0.5rem;text-align: center;font-size: 2rem;">  <img src="images/weixin/user_info_email.png" style="width: 2.25rem;height: 2.25rem;margin-top: 0.375rem;"> </div> <div> <div style="font-size: 1.125rem;font-weight: bold;color: #333;height: 1.5rem;line-height: 1.5rem;"> {{config.userInfo.exp_emp_email}} </div> <div style="font-size: 1rem;color: #999;height: 1.5rem;line-height: 1.5rem;">邮箱</div> </div> </div> <div style="margin-left: 1rem;margin-right: 1rem;border-top: 1px solid #eee;"></div> <div class="row" style="margin: 0.25rem 0"> <div style="width: 3rem;height: 3rem;line-height: 3rem;margin-left: 0.5rem;text-align: center;font-size: 2rem;">  <img src="images/weixin/user_info_chatbubble.png" style="width: 2.25rem;height: 2.25rem;margin-top: 0.375rem;"> </div> <div> <div style="font-size: 1.125rem;font-weight: bold;color: #333;height: 1.5rem;line-height: 1.5rem;"> {{config.userInfo.exp_emp_weixin}} </div> <div style="font-size: 1rem;color: #999;height: 1.5rem;line-height: 1.5rem;">信息</div> </div> </div> <div style="margin-left: 1rem;margin-right: 1rem;border-top: 1px solid #eee;"></div> <div style="margin-left: 3.5rem;padding: 5px;"> <div style="height: 2rem;line-height: 2rem;color: #999;">公司:&nbsp;&nbsp;{{config.userInfo.exp_company_name}}</div> <div style="height: 2rem;line-height: 2rem;color: #999;">部门:&nbsp;&nbsp;{{config.userInfo.exp_unit_name}}</div> <div style="height: 2rem;line-height: 2rem;color: #999;">岗位:&nbsp;&nbsp;{{config.userInfo.exp_position_name}}</div> </div> </div> </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/user/user_selectuser.html",'<ion-view id="wfl-add-approver-view" view-title="选择员工" ng-controller="UserSelectController" hide-nav-bar="false" hide-back-button="false" cache-view="false" class="empSelcect"> <ion-content scroll="false"> <style>\n            .empSelcect .search {\n                padding: 22px;\n            }\n\n            .empSelcect .searchI {\n                font-size: 1.3em;\n            }\n\n            .empSelcect .searchForm {\n                padding-top: 3px;\n            }\n\n            .empSelcect .cancelButton {\n                background-color: #EBEBEB;\n                border-color: #EBEBEB;\n                color: #040407;\n                font-size: 15px;\n            }\n\n            .empSelcect .sureButton {\n                background-color: #2196F3;\n                color: white;\n                font-size: 15px;\n            }\n\n            /*.empSelcect .contentMargin {*/\n            /*margin-top: 10px;*/\n            /*}*/\n\n            .empSelcect #hec-wfl-add-users .user-info {\n                border-bottom: 0;\n                width: 70%;\n            }\n\n            .empSelcect #hec-wfl-add-users .user-info-wrapper {\n                display: table;\n                border-bottom: 1px solid #EFEBE9;\n            }\n\n            .header-search {\n                width: 100%;\n                background-color: #f5f5f5;\n                border: 1px solid #e3e0e0;\n                padding: 0.5rem;\n                z-index: 3;\n            }\n\n            .input-search {\n                width: 100%;\n                height: 2.375rem;\n                padding: 0.375rem;\n                font-size: 0.875rem;\n                line-height: 1.42857143;\n                color: #555;\n                background-color: #fff;\n                background-image: none;\n                border: 1px solid #e3e0e0;\n                border-left: none;\n                border-radius: 0 0.375rem 0.375rem 0;\n                -webkit-appearance: none;\n            }\n\n            .input-left {\n                padding: 0.25rem 0 0.25rem 0.5rem;\n                font-size: 1.75rem;\n                color: #555;\n                text-align: center;\n                background-color: #fff;\n                border: 1px solid #e3e0e0;\n                border-right: none;\n                border-radius: 0.375rem 0 0 0.375rem;\n                height: 2.375rem;\n            }\n\n            .checkbox input {\n                position: relative;\n                top: 0.25rem;\n                width: 1.5rem;\n                height: 1.5rem;\n                float: right;\n            }\n\n            .checkbox input:checked:before {\n                background: #ffc107;\n                border-color: #ffc107;\n            }\n            .user-info-wrapper{\n                width: 100%;\n            }\n            .user-info-wrapper .user-select{\n                text-align: right;                \n                padding-right: 5px;\n            }\n        </style> <div class="wfl-add-approver-content fill-parent"> <div class="row header-search" style="height: 56px;"> <div class="input-left" style="width: 12%;"><i class="ion-ios-search"></i></div> <div style="width: 88%;"> <input class="input-search" placeholder="输入用户名搜索" ng-model="config.queryStr" ng-keyup="searchInputOnKeyup($event);"> </div> </div>                 <div id="hec-wfl-add-users" class="fill-width" style="height: 100%;padding-bottom: 3.5rem;"> <div class="users-isloading fill-width" ng-if="config.status_loading"> <ion-spinner icon="ios-small" class="users-loading-spinner" style="margin-right:1rem;"></ion-spinner> <span class="loading-text">正在加载</span> </div> <div class="users-loaded-nodata fill-width" ng-if="config.status_loaded && (!config.users || config.users.length ==0)" style="margin-top:1rem;color:#ADA4A4;;"> 无匹配用户 </div> <ion-scroll scrollbar-y="false" class="fill-parent contentMargin" has-bouncing="true" ng-if="config.status_loaded && config.users && config.users.length>0"> <div class="user-info-item" ng-repeat="user in config.users" ng-class="{\'cannot-selected-second\':(user.cannotSelectSecond)}"> <div class="user-info-wrapper" ng-click="selectUser($index);"> <div class="user-info"> {{user.exp_emp_name}}&nbsp;&nbsp;:&nbsp;&nbsp;{{user.exp_emp_org_info}} </div> <div class="user-select"> <label class="checkbox"> <input type="checkbox" ng-disabled="user.cannotSelectSecond" name="abcboren" ng-checked="user.selected"> </label> </div> </div> </div> </ion-scroll> </div> </div> </ion-content> <ion-footer-bar id="hec-wfl-handle-footer" align-title="center" class=""> <div class="buttons fill-parent"> <button ng-click="cancel();" class="button button-block cancelButton">取&nbsp;&nbsp;消 </button> <button ng-disabled="showOkBtn();" ng-click="selectOk();" class="button button-block button-calm sureButton">确&nbsp;&nbsp;定 </button> </div> </ion-footer-bar> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/loading_select_priority.html",'<div id="hecui-select-loading" ng-controller="WflSelectController" cound-hide="" ng-click="hideLoading($event);"> <div class="hecui-select-items" cound-hide=""> <div class="hecui-select-items-inner padding"> <div class="hecui-select-item" ng-class="{\'last\':(($index+1)==config.select_priority.length),\'first\':($index==0)}" ng-repeat="item in config.select_priority"> <div class="hecui-select-item-inner fill-parent" ng-click="selectPriority(item)"> <div class="hecui-select-item-show"> {{item.value}} </div> </div> </div> </div> </div> </div> ')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/loading_select_search_category.html",'<div id="hecui-select-loading" ng-controller="WflSelectController" cound-hide="" ng-click="hideLoading($event);"> <div class="hecui-select-items" cound-hide=""> <div class="hecui-select-items-inner padding"> <div class="hecui-select-item" ng-class="{\'last\':(($index+1)==config.select_category.length),\'first\':($index==0)}" ng-repeat="item in config.select_category"> <div class="hecui-select-item-inner fill-parent" ng-click="selectCategory(item)"> <div class="hecui-select-item-show"> {{item.value}} </div> </div> </div> </div> </div> </div>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/main.html",'<ion-view hide-back-button="false" cache-view="true" hide-nav-bar="false">  <ion-nav-view name="wflContent"></ion-nav-view> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/todoAndDone.html",' <ion-view hide-back-button="false" cache-view="true" ng-controller="TodoDoneCategoryCtrl" hide-nav-bar="false"> <ion-content> <div class="top-image"> <img src=""> </div> <div class="category-select"> <div class="category-lines"> <div class="category-line" ng-repeat="item in config.categories" ng-click="goListPage(item);"> <span>{{item.category_desc}}</span> </div> </div> </div> </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/wfl_category.html",'<ion-view hide-back-button="false" cache-view="true" hide-nav-bar="false"> <ion-nav-view name="tododoneContent"></ion-nav-view> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/wfl_category_tododone.html",'<ion-view view-title="{{config.viewTitle}}" hide-back-button="false" cache-view="true" ng-controller="TodoDoneCategoryCtrl" hide-nav-bar="false"> <ion-content id="wfl-category-tododone-content" scroll="false"> <div class="top-image fill-width" style="height: auto"> <img class="fill-parent" src="images/weixin/list_category_02.png"> </div> <div class="category-select fill-width" style="margin-top:1.0em"> <div class="category-lines fill-width"> <div class="row" ng-repeat="item in config.categories" ng-click="goListPage(item);"> <div class="col col-10" style="padding: 5px"> <div class="col-demo col-offset-10"><img src="{{item.img_src}}" class="ini"></div> </div> <div class="col col-80" style="padding:5px"> <div class="ccol-demo col-offset-5">{{item.category_desc}}</div> </div> <div class="col col-10" style="border-bottom: 1px solid #f4f4f4;padding-top: 3%"> <div class="col-demo col-offset-25"><img src="images/weixin/arrow_right.png"></div> </div> </div> </div> </div> <style>\n            .queryAll {\n                margin-top: 1em;\n                margin-left: 0.6em;\n                margin-right: 0.6em;\n                height: 3em;\n                background-color: #ffc107;\n                border-radius: 5px;\n                color: white;\n                text-align: center;\n                line-height: 3em;\n                box-shadow: 0 1px 3px rgba(196, 21, 28, .8);\n            }\n\n            img.ini {\n                width: 96%;\n                margin-top: 25%;\n            }\n\n            .category-select.fill-width {\n                background-color: white;\n            }\n\n            .col.col-80 {\n                border-bottom: 1px solid #f4f4f4;\n            }\n\n            .ccol-demo.col-offset-5.ng-binding {\n                margin-top: 3%;\n            }\n\n            /*.col.col-10 {*/\n            /*border-bottom: 1px solid #f4f4f4;*/\n            /*}*/\n            .ccol-demo.col-offset-5.ng-binding {\n\n            /*font-weight: bold;*/\n            /*}*/\n            /*.row {*/\n            /*height: 146%;*/\n            /*}*/\n            .fill-width {\n                width: 100%;\n                height: 25.25%;\n            }\n\n            element.style {\n                margin-top: 0.8em;\n            }\n        </style> <div ng-click="allGoListPage();" class="queryAll"> 查看全部 </div> </ion-content> </ion-view> ')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/detail/abs_detail.html",'<ion-view hide-back-button="false" cache-view="false" hide-nav-bar="false" ng-controller="WflDetailController"> <ion-nav-bar class="bar-positive"> <ion-nav-back-button> </ion-nav-back-button> </ion-nav-bar> <ion-content scroll="false">  <ion-nav-view name="detailContent"></ion-nav-view> </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/detail/wfl_detail_doc_attachment.html",'<style>\n    .col {\n        padding: 0;\n    }\n</style> <ion-view view-title="{{$parent.config.viewTitle}}" ng-controller="WflDocAttachmentController" cache-view="true"> <ion-content> <ion-list> <ion-item ng-repeat="item in datas.attachments" ng-click="atmDownload(item)" style="padding: 0.25rem 0.75rem"> <div class="row"> <div class="col col-75"> <div style="height: 1.75rem;line-height: 1.75rem;font-size: 1.25rem;"> {{item.file_name}} </div> <div style="height: 1.25rem;line-height: 1.25rem;font-size: 0.75rem;"> {{item.creation_date}} </div> </div> <div class="col col-25" style="height: 3rem;"> <img src="images/weixin/attachment-download.png" style="width: 1.25rem;height: 1.25rem;margin-top: 0.875rem;"> <span style="position: relative;top: -2px;">{{item.file_size}}</span> </div> </div> </ion-item> </ion-list> </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/detail/wfl_detail_doc_flow.html",'<ion-view view-title="{{$parent.config.viewTitle}}" cache-view="true"> <ion-content id="doc-flow-content" scrollbar-y="false" class="doc-infos-content" scroll="false" ng-controller="WflDocFlowController"> <style>\n            .detail-approve-btns-reload .hecui-line-buttons .hecui-button {\n                height: 2.7em;\n                vertical-align: middle;\n                display: table-cell;\n                border-radius: 0px;\n            }\n            .detail-approve-btns-reload .selected {\n                border: none;\n                border-bottom: 2px #e6b400 solid;\n                color: #e6b400;\n            }\n            .doc-flow-wrapper-reload {\n                margin: 1rem 0 2rem;\n                background: white;;\n            }\n\n            .doc-flow-wrapper-reload .doc-flow-start, .doc-flow-end {\n                width: 4.5rem;\n                height: 2.2rem;\n                text-align: center;\n                border: 1px solid #207FFA;\n                background-color: #207FFA;\n                color: white;\n                border-radius: 20px;\n                margin: auto;\n                display: -webkit-box;\n                display: -webkit-flex;\n                display: -moz-box;\n                display: -moz-flex;\n                display: -ms-flexbox;\n                display: flex;\n                -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                -webkit-justify-content: center;\n                -moz-justify-content: center;\n                justify-content: center;\n                -webkit-box-align: center;\n                -ms-flex-align: center;\n                -webkit-align-items: center;\n                -moz-align-items: center;\n                align-items: center; }\n\n            .doc-flow-arrow {\n                width: 100%;\n                text-align: center;\n                font-size: 2rem;\n                line-height: 1;\n                padding-top: .6rem;\n                padding-bottom: .6rem;}\n\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title{\n                /*padding:0rem 1rem;*/\n                height: 3rem;\n                line-height: 3rem;\n                border-top-left-radius: .5rem;\n                border-top-right-radius: .5rem;\n                background: #e8e8e8;border: 1px #e8e8e8 solid;\n            }\n\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title .node-status{\n                width:25%;\n                float: left;\n                color: #007aff;\n                padding-left: .6rem;\n            }\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title .node-name{\n                width:50%;\n                float: left;\n                text-align: center;\n                font-size: 1.3rem;\n            }\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title .node-approve-type{\n                width:25%;\n                float: left;\n                text-align: right;\n                padding-right: .6rem;\n            }\n\n            .doc-flow-nodes-reload .doc-flow-node-approves .doc-flow-node-approve{\n                /*:0rem 1rem;\n                height: 4rem;*/\n                height: 3rem;\n                background: white;\n                border: 1px #e8e8e8 solid;\n                border-top: 0px #e8e8e8 solid;\n            }\n            .doc-flow-nodes-reload .doc-flow-node-approves .doc-flow-node-approve.first-flow-node-approve{\n                border-top: 1px #e8e8e8 solid;\n            }\n\n            .doc-flow-nodes-reload .left-info{\n                /*width:85%;*/\n                float: left;\n                /*height: 4rem;*/\n                height: 3rem;\n                line-height: 2rem;\n            }\n\n            .doc-flow-nodes-reload .left-info .line1{\n                /*font-size: 1rem*/\n                padding-left: .6rem;\n                line-height: 2rem;\n                height: 2rem;\n            }\n\n            .doc-flow-nodes-reload .left-info .line2{\n                font-size: 1rem;\n                font-size: 0.8rem;color: #999999;\n                padding-left: .6rem;\n            }\n            .doc-flow-nodes-reload .right-button{\n                width: 1.5rem;\n                float: right;\n                height: 3.75rem;\n                line-height: 3.75rem;\n                text-align: left;\n                font-size: 1rem;\n            }\n            .doc-flow-wrapper-reload .doc-flow-start, .doc-flow-end {\n                width: 4.5rem;\n                height: 2.2rem;\n                text-align: center;\n                border: 1px solid #ffc107;\n                background-color: #ffc107;\n                color: white;\n                border-radius: 20px;\n                margin: auto;\n                display: -webkit-box;\n                display: -webkit-flex;\n                display: -moz-box;\n                display: -moz-flex;\n                display: -ms-flexbox;\n                display: flex;\n                -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                -webkit-justify-content: center;\n                -moz-justify-content: center;\n                justify-content: center;\n                -webkit-box-align: center;\n                -ms-flex-align: center;\n                -webkit-align-items: center;\n                -moz-align-items: center;\n                align-items: center;\n            }\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title .node-status {\n                width: 25%;\n                float: left;\n                color: #d67d80;\n                padding-left: .6rem;\n            }\n            .ion-chevron-right:before {\n                content: "\\f125";\n                color: #E0878B;\n            }\n            .ion-ios-arrow-thin-down:before {\n                content: "\\f3d4";\n                color: #ffecb8;\n            }\n            .doc-flow-nodes-reload .doc-flow-node-reload .doc-flow-title .node-approve-type {\n                width: 25%;\n                float: left;\n                text-align: right;\n                padding-right: .6rem;\n\n            }\n            .flow-node-waiting {\n                background-color: white;\n            }\n            .ion-chevron-right:before {\n                content: "\\f125";\n                color: #E0878B;\n            }\n        </style> <style>\n        </style> <div class="detail-approve-btns-reload"> <div class="buttons hecui-line-buttons fill-parent"> <div ng-click="goDocInfoView();" ng-disabled="false" class="button hecui-button button-block button-light" style="border-right:0px;">单据明细 </div> <div class="button hecui-button button-block button-light selected" style="border-left:0px;">流程预览 </div> </div> </div> <ion-scroll id="doc-flow-scroll" has-bouncing="false" scrollbar-y="false"> <div class="doc-flow-wrapper-reload padding fill-parent"> <div class="doc-flow-start"> 开始 </div> <div class="doc-flow-arrow ion-ios-arrow-thin-down"></div> <div class="doc-flow-nodes-reload"> <div ng-repeat="node in datas.approveFlows"> <div class="doc-flow-node-reload" ng-class="{\'flow-node-current\':(node.isCurrent),\'flow-node-waiting\':(node.isWaiting)}"> <div class="doc-flow-title" style="height:2rem;line-height:2rem;"> <div class="node-status"> {{node.node_status_desc}} </div> <div class="node-name" style="font-size:1.1rem;"> {{node.node_name}} </div> <div class="node-approve-type"> {{node.node_approve_type}} </div> </div> <style>\n                                .doc-flow-node-approves .doc-flow-node-approve:last-child{\n                                    border-bottom-right-radius: 8px;\n                                    border-bottom-left-radius: 8px;\n                                }\n                            </style> <div class="doc-flow-node-approves fill-width"> <div class="doc-flow-node-approve fill-width" ng-repeat="item in node.nodeApprovers" ng-click="goUserDetailPage(item.approve_user_id, item.approve_emp_id);" style="height:4rem;" ng-class="{\'first-flow-node-approve\':($index==0)}"> <div class="left-info fill-height" style="height:1.5rem;line-height:1.5rem;flex: 1;padding-right: 5px;"> <div class="ht-detail-desc" style="padding-top: 0px;"> <div class="line1">{{item.approve_emp_name}} : <span>{{getDateDescStr(item.approve_date);}}</span> <span>{{item.approve_action}}</span> </div> <div class="line2">意见: {{item.approve_opinion}}</div> </div> </div> <div class="right-button fill-height"> <i class="icon ion-chevron-right"></i> </div> </div> </div> </div> <div class="doc-flow-arrow ion-ios-arrow-thin-down"></div> </div> <div class="no-flow-nodes" ng-if="!config.loaindFlowNode && (!datas.approveFlows || datas.approveFlows.length == 0)"> <div class="text-tip fill-width">无节点信息</div> <div class="doc-flow-arrow ion-ios-arrow-thin-down"></div> </div> <div class="loading-flow-nodes" ng-if="config.loaindFlowNode"> <div class="loading-flow-nodes-inner"> <ion-spinner icon="ios-small" style="margin-right:1rem;"></ion-spinner> <span>正在加载节点信息</span> </div> <div class="doc-flow-arrow ion-ios-arrow-thin-down"></div> </div> </div> <div class="doc-flow-end"> 结束 </div> </div> </ion-scroll>  </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/detail/wfl_detail_doc_info.html",'<ion-view view-title="{{$parent.config.viewTitle}}" ng-controller="DocInfoController" cache-view="true" class="apl"> <ion-content id="doc-infos-content" class="doc-infos-content" scrollbar-y="false" scroll="false" ng-click="hidePartOfAllButtons($event);"> <div class="detail-approve-btns"> <div class="buttons hecui-line-buttons fill-parent"> <div ng-click="goDocInfoView();" ng-disabled="false" class="button hecui-button button-block leftButton">单据明细 </div> <div ng-click="goDocFlowView()" ng-disabled="false" class="button hecui-button button-block rightButton">流程预览 </div> </div> </div> <style>\n            .apl .leftButton {\n                background-color: white !important;\n                color: #EEBA1B;\n                border-bottom: 3px solid #FEC006;\n                border-right: 0;\n                padding: 10px;\n            }\n\n            .apl .rightButton {\n                border-left: 0;\n                background-color: white;\n                border-bottom: 2px solid #C7C0C0;\n            }\n\n            #doc-created-by-info .user-info-right .info-line {\n                height: 1.6em;\n            }\n\n            #doc-lines-info .hecui-table {\n                display: table;\n                border: 1px solid #9C9A9A;\n            }\n\n            #doc-lines-info .table-line-header {\n                background-color: white;\n            }\n\n            #doc-approve-history .doc-approve-history-title,\n            #doc-header-info .doc-header-info-title,\n            #doc-lines-info .doc-lines-info-title {\n                font-size: 1em;\n                color: #00f;\n                font-weight: 500;\n                line-height: 2.4em;\n            }\n\n            .apl .doc-lines-info-title {\n                letter-spacing: 0;\n                word-spacing: 0.2rem;\n            }\n        </style> <ion-scroll id="doc-info-scroll" has-bouncing="false" scrollbar-y="false"> <div id="document-detail-content" class="padding" style="margin-top: .5em;padding: 1px 1.3em;"> <div id="doc-header-info" class="fill-width"> <div class="doc-header-info-title" style="color: #D5595D;"> 报销单头信息 </div> <div class="info-lines fill-width" style="margin-top: .3em;"> <div class="info-line"> <div class="left-name">标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;题&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.ins_doc_hd_title}} </div> </div> <div class="info-line"> <div class="left-name"> <span ng-if="isExpReport();" style="color: #000">报销单编号&nbsp;:&nbsp;</span> <span ng-if="isExpRequisition();" style="color: #000">申请单编号&nbsp;:&nbsp;</span> <span ng-if="isPayRequisition();" style="color: #000">借款单编号&nbsp;:&nbsp;</span> </div> <div class="right-value"> {{datas.header.exp_rep_num}} </div> </div> <div class="info-line"> <div class="left-name"> 单据类型&nbsp;:&nbsp; </div> <div class="right-value"> {{datas.header.ins_doc_hd_type_name}} </div> </div> <div class="info-line"> <div class="left-name">报销日期&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_date}} </div> </div> <div class="info-line"> <div class="left-name">公&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;司&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_com_name}} </div> </div> <div class="info-line"> <div class="left-name">制&nbsp;&nbsp;单&nbsp;&nbsp;人&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_created_by_name}} </div> </div> <div class="info-line"> <div class="left-name">申&nbsp;&nbsp;请&nbsp;&nbsp;人&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_emp_name}} </div> </div> <div class="info-line"> <div class="left-name">岗&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;位&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_pos_name}} </div> </div> <div class="info-line"> <div class="left-name">币&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;种&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_currency_name}} </div> </div> <div class="info-line"> <div class="left-name">总&nbsp;&nbsp;金&nbsp;&nbsp;额&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_total_amount | currency:\'\' }} </div> </div> <div class="info-line"> <div class="left-name">描&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;述&nbsp;:&nbsp;</div> <div class="right-value"> {{datas.header.exp_rep_desc}} </div> </div> </div> </div> <i class="icon ion-more"></i>  <style>\n                    .doc-lines-info-title {\n                        letter-spacing: 0.2rem;\n                        word-spacing: 0.2rem;\n                    }\n                </style> <div id="doc-lines-info" class="fill-width" ng-if="isExpRequisition() || isExpReport()"> <div class="doc-lines-info-title fill-width" ng-if="isExpReport();" style="color: #D5595D;"> 报销费用明细 </div> <div class="doc-lines-info-title fill-width" ng-if="isExpRequisition();" style="color: #D5595D;"> 申请费用明细 </div> <div class="lines-info-block fill-width"> <div class="hecui-table-wrapper fill-width"> <div class="hecui-table fill-width"> <div class="hecui-table-line first-line table-line-header"> <div class="hecui-table-cell first-col">责任中心</div> <div class="hecui-table-cell">报销类型</div> <div class="hecui-table-cell">申请项目</div> <div class="hecui-table-cell last-col">金额</div> </div> <div class="hecui-table-line" style="color: #949498;" ng-class="{\'last-line\':(($index+1)==datas.lines.length)}" ng-repeat="item in datas.lines"> <div class="hecui-table-cell first-col">{{item.exp_rep_line_resp_name}}</div> <div class="hecui-table-cell">{{item.exp_rep_line_exp_type_name}}</div> <div class="hecui-table-cell">{{item.exp_rep_line_exp_item_name}}</div> <div class="hecui-table-cell last-col">{{item.exp_rep_line_amount | currency :\'\' }} </div> </div> </div> </div> </div> </div> <div id="doc-lines-info" class="fill-width" ng-if="isExpReport()"> <div class="doc-lines-info-title fill-width" ng-if="isExpReport();" style="color: #D5595D;"> 计划付款行明细 </div> <div class="lines-info-block fill-width"> <div class="hecui-table-wrapper fill-width"> <div class="hecui-table fill-width"> <div class="hecui-table-line first-line table-line-header"> <div class="hecui-table-cell first-col">核销金额</div> <div class="hecui-table-cell">收款方</div> <div class="hecui-table-cell last-col">金额</div> </div> <div class="hecui-table-line" style="color: #949498;" ng-class="{\'last-line\':(($index+1)==datas.lines.length)}" ng-repeat="item in datas.pmtplan"> <div class="hecui-table-cell first-col">{{item.exp_rep_write_off_amount | currency :\'\'}} </div> <div class="hecui-table-cell">{{item.exp_rep_payee_partner_name}}</div> <div class="hecui-table-cell last-col">{{item.exp_rep_due_amount | currency :\'\' }} </div> </div> </div> </div> </div> </div> <div id="doc-lines-info" class="fill-width" ng-if="isPayRequisition();"> <div class="doc-lines-info-title fill-width" style="color: #1E5FCC;"> 借款明细 </div> <div class="lines-info-block fill-width"> <div class="hecui-table-wrapper fill-width"> <div class="hecui-table fill-width"> <div class="hecui-table-line first-line table-line-header"> <div class="hecui-table-cell first-col">收款方</div> <div class="hecui-table-cell last-col">金额</div> </div> <div class="hecui-table-line" ng-class="{\'last-line\':(($index+1)==datas.lines.length)}" ng-repeat="item in datas.lines"> <div class="hecui-table-cell first-col">{{item.exp_pay_req_partner_name}}</div> <div class="hecui-table-cell last-col">{{item.exp_pay_req_line_amount | currency:\'\' }} </div> </div> </div> </div> </div> </div> <div id="doc-approve-history" class="fill-width" style="margin-bottom: 0"> <div class="doc-approve-history-title fill-width" style="color: #D5595D;">附件</div> <div class="approve-ht-blocks fill-width padding" style="padding: 0;background: white;"> <div class="approve-ht-block fill-width" ng-if="datas.header.attchment_flag>0" ng-click="goAttachmentList()"> <div class="left-info fill-height"> <div class="left-info-inner fill-parent"> <div class="ht-detail-desc" style="height: 100%;line-height: 1.5rem;"> 附件状态:&nbsp;有附件 </div> </div> </div> <div class="right-button fill-height"> <span style="font-size: 0.875rem;position: relative;top: -2px;color: #000;">查看</span> <i class="icon ion-chevron-right" style="color: #A7A1A1;font-size: .8em;"></i> </div> </div> <div class="approve-ht-block fill-width" ng-if="datas.header.attchment_flag==0"> <div class="left-info fill-height"> <div class="left-info-inner fill-parent"> <div class="ht-detail-desc" style="height: 100%;line-height: 1.5rem;"> 附件状态:&nbsp;无附件 </div> </div> </div> <div class="right-button fill-height not"> <span style="font-size: 0.875rem;position: relative;top: -2px;color: #999;">查看</span> <i class="icon ion-chevron-right" style="color: #999;font-size: .8em;"></i> </div> </div> </div> </div> <div id="doc-approve-history" class="fill-width"> <div class="doc-approve-history-title fill-width" style="color: #D5595D;">审批记录</div> <div class="no-approve-ht" ng-if="!datas.approveHt || !datas.approveHt.length || datas.approveHt.length == 0"> 暂无审批记录 </div> <div class="approve-ht-blocks fill-width padding" style="padding: 0;background: white;"> <div class="approve-ht-block fill-width" ng-repeat="item in datas.approveHt" ng-click="goUserDetailPage(item.user_id, item.exp_emp_id);"> <div class="left-info fill-height"> <div class="left-info-inner fill-parent"> <div class="ht-detail-desc"> {{item.detailDesc}} </div> <div class="ht-comment"> 意见&nbsp;&nbsp;:&nbsp;&nbsp;{{item.comment}} </div> </div> </div> <div class="right-button fill-height"> <i class="icon ion-chevron-right" style="color: #A7A1A1;font-size: .8em;"></i> </div> </div> </div> </div> </div> </ion-scroll> <style>\n            .handle-loading-tip {\n                width: 100%;\n                height: 100%;\n                display: table;\n\n            }\n\n            .handle-loading-tip span {\n                display: table-cell;\n                vertical-align: middle;\n                text-align: center;\n            }\n\n            span {\n                color: #808083;\n                /*background-color: white;*/\n            }\n\n            .ion-chevron-right:before {\n                content: "\\f125";\n                color: #E0878B;\n            }\n\n            .not .ion-chevron-right:before {\n                content: "\\f125";\n                color: #999;\n            }\n\n            .br-top-1, .br-top-2 {\n                position: relative !important;\n                left: -6rem !important;\n                width: 6rem !important;\n                background-color: white;\n                text-align: center;\n            }\n        </style>   <div id="hec-bottom-buttons-div" class="tabs tabs-icon-top tabs-positive" style="position: static" ng-if="config.isTodo==true">  <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="showOpinionPopup(\'reject\')"> <i class="ion-close" style="display: block;font-size: 1.125rem;height: 1.25rem;color: #c4151c;"></i> <span style="color: #b4b4b5">拒绝</span> </div>  <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="showOpinionPopup(\'nod\')"> <i class="ion-checkmark" style="display: block;font-size: 1.125rem;height: 1.25rem;color: #c4151c;"></i> <span style="color: #b4b4b5">同意</span> </div> <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="goBatchTransfer();"> <i class="ion-android-share" style="display: block;font-size: 1.25rem;color: #c4151c;"></i> <span style="color: #b4b4b5">转交</span> </div> <div class="tab-item" style="margin-top: 8px;opacity: 1;"> <i cound-switch="" class="icon ion-android-more-horizontal"></i> </div> <div style="width:0px; max-width:0px;height:2rem;max-height:2rem;min-height:2rem;"> <div cound-switch="" class="br-top-1 select-operation has-border-bottom addhandler" ng-class="{\'show-me\':(config.showAllBottons),\'hide-me\':(!config.showAllBottons)}" ng-click="goBatchAddHandler();"> <span>添加处理人</span> </div> <div cound-switch="" ng-class="{\'show-me\':(config.showAllBottons),\'hide-me\':(!config.showAllBottons)}" class="br-top-2 select-operation has-border-bottom notify" ng-click="goBatchNotify();"> <span style="background-color: white">通知</span> </div> </div> </div>  <div class="hec-bottom-content-div fill-width hec-bottom-for-done" ng-if="config.isDone==true">  <div class="hec-bottom-buttons-wrapper fill-parent"> <div class="hec-bottom-buttons fill-parent"> <div class="hec-bottom-buttons-inner fill-parent"> <div class="select-operation notify" ng-click="goBatchNotify();" style="background: #c4151c;border-right: none;">  <span style="color: #fff;">通知</span> </div> <div ng-if="rootConfig.can_back_to_pre_node_flag==\'Y\'" class="select-operation notify" ng-click="cancleInstanceDone();" style="background: #c4151c;border-right: none;"> <span style="color: #fff;">收回</span> </div> </div> </div> </div> </div>  <div class="hec-bottom-content-div fill-width hec-bottom-for-apply" ng-if="config.isApply==true && datas.header.can_cancel==\'1\'"> <div class="hec-bottom-buttons-wrapper fill-parent"> <div class="hec-bottom-buttons fill-parent"> <div class="hec-bottom-buttons-inner fill-parent"> <div class="select-operation notify" style="background: #c4151c;border-right: none;" ng-click="cancleInstance();">  <span style="color: #fff;">收回</span> </div> </div> </div> </div> </div> </ion-content>  <style>\n        .ion-checkmark:before {\n            content: "\\f122";\n            color: #c4151c;\n        }\n\n        .ion-android-share:before {\n            content: "\\f2f8";\n            color: #c4151c;\n        }\n\n        .ion-android-more-horizontal:before {\n            content: "\\f396";\n            color: #c4151c;\n        }\n\n        div#hec-bottom-buttons-div {\n            /*border: 1px solid white;*/\n            background-color: white;\n        }\n\n        .ion-more:before {\n            content: "\\f20b";\n            margin-left: 40%;\n            margin-right: 40%;\n            width: 20%;\n        }\n\n\n    </style> </ion-view>');
}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/list/wfl_list.html",' <ion-view hide-back-button="false" cache-view="true" hide-nav-bar="false"> <ion-nav-view name="wflListContent"></ion-nav-view> </ion-view> ')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/list/wfl_list_tododone.html",'<ion-view view-title="{{config.viewTitle}}" hide-back-button="false" cache-view="true" ng-controller="WflListTododoneCtrl" hide-nav-bar="false"> <ion-nav-buttons side="right" id="wfl-list-page-nav-buttons"> <div class="hec-circl-button wfl_select_button" ng-if="config.isListPage && isSelectMode() && config.showSelectAllButton" ng-click="selectAll();"> <span style="color: #fff"> 全选 </span> </div> <div class="hec-circl-button wfl_select_button" ng-if="config.isListPage && isSelectMode() && config.isSelectAll && !config.showSelectAllButton" ng-click="unSelectAll();"> <span style="color: #fff">取消</span> </div> <div class="hec-circl-button wfl_select_button" ng-if="isWflListTododoneState() && config.isListPage && isSelectMode() && config.selectNum > 0 && !config.showSelectAllButton && !config.isSelectAll" ng-click="clickNumberButton();"> <span style="color: #fff;">{{config.selectNum}} </span> </div> </ion-nav-buttons> <ion-content id="wfl-list-todo-content" scroll="false" ng-click="hidePartOfAllButtons($event);" style="background: #EBEBEB;"> <div class="list-todo-content-inner fill-parent"> <div class="header-search"> <div class="input-shadow"> <div class="input-left" style="width: 12%;"><i class="ion-ios-search"></i></div> <div style="width: 88%;"> <input class="input-search" placeholder="输入条件查询" ng-model="config.queryStr" ng-keyup="searchInputOnKeyup($event);"> </div> </div> </div> <ion-scroll id="hec-tododone-list-scroll" has-bouncing="true"> <ion-refresher pulling-text="{{config.refresherText}}" on-refresh="reloadData();"> </ion-refresher> <div id="br-wfl-todo-list" class="br-wfl-todo-list-yd-only-one timeline" ng-if="config.isTodo"> <div class="card-item-outset" ng-class="{\'first-card-item-outset\':item.showSubDate}" ng-repeat="item in config.listData"> <div class="card-item-inset" ng-class="{\'first-card-item-inset\':item.showSubDate,\'last-card-item-inset\':item.showSubDatePre}"> <div class="row item-title"> <span class="col col-90" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;"> {{item.ins_sub_date_day}}【{{item.ins_doc_hd_title}}】 </span> <label ng-click="selectItem($index)" class="col col-10 checkbox"> <input type="checkbox" class="listdata-item-selected-todo"> </label> </div> <div style="padding: 0.375rem 0.75rem" ng-click="goDetailPage(item);"> <div class="item-line"> 制单人:&nbsp;{{item.ins_sub_emp}} </div> <div class="item-line"> 金<span style="display: inline-block;text-indent: 0.75rem">额</span>:&nbsp; {{item.ins_doc_amount | currency : \'\'}} </div> </div> </div> </div> </div> <div id="br-wfl-done-list" class="br-wfl-done-list-yd-only-one timeline" ng-if="config.isDone"> <div class="card-item-outset" ng-class="{\'first-card-item-outset\':item.showSubDate}" ng-repeat="item in config.listData"> <div class="card-item-inset" ng-class="{\'first-card-item-inset\':item.showSubDate,\'last-card-item-inset\':item.showSubDatePre}"> <div class="row item-title"> <span class="col col-90" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;"> {{item.ins_sub_date_day}}【{{item.ins_doc_hd_title}}】 </span> <label ng-click="selectItem($index)" class="col col-10 checkbox"> <input type="checkbox" class="listdata-item-selected-done" ng-class="{\'not-selected\':(item.ins_doc_status!=1)}"> </label> </div> <div style="padding: 0.375rem 0.75rem" ng-click="goDetailPage(item);"> <div class="item-line" style="display: flex"> <div class="col col-60"> 当前审批人:&nbsp;{{item.ins_cur_node_emp_name}} </div> <div class="col col-40"> 制单人:&nbsp;{{item.ins_sub_emp}} </div> </div> <div class="item-line" style="display: flex"> <div class="col col-60"> 审批状态:&nbsp;{{item.ins_doc_status_name}} </div> <div class="col col-40"> 金<span style="display: inline-block;text-indent: 0.75rem">额</span>:&nbsp; {{item.ins_doc_amount | currency : \'\'}} </div> </div> </div> </div> </div> </div> <div id="br-wfl-apply-list" class="timeline" ng-if="config.isApply"> <div class="card-item-outset" ng-class="{\'first-card-item-outset\':item.showSubDate}" ng-repeat="item in config.listData"> <div class="card-item-inset" ng-class="{\'first-card-item-inset\':item.showSubDate,\'last-card-item-inset\':item.showSubDatePre}"> <div class="item-title" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;"> {{item.ins_sub_date_day}}【{{item.ins_doc_hd_title}}】 </div> <div style="padding: 0.375rem 0.75rem" ng-click="goDetailPage(item);"> <div class="item-line"> 单据编号:&nbsp;{{item.ins_doc_num}} </div> <div class="item-line" style="display: flex"> <div class="col col-60"> 当前审批人:&nbsp;{{item.ins_cur_node_emp_name}} </div> <div class="col col-40"> 审批状态:&nbsp;{{item.status_name}} </div> </div> </div> </div> </div> </div> <style>\n                    .header-search {\n                        width: 100%;\n                        background-color: #EBEBEB;\n                        border: 1px solid #e3e0e0;\n                        padding: 0.5rem 0.625rem 0.625rem;\n                        z-index: 3;\n                    }\n\n                    .input-shadow {\n                        display: flex;\n                        width: 100%;\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, .3);\n                        border-radius: 0.375rem;\n                    }\n\n                    .input-search {\n                        width: 100%;\n                        height: 2.25rem;\n                        padding: 0.375rem;\n                        font-size: 0.875rem;\n                        line-height: 1.42857143;\n                        color: #555;\n                        background-color: #fff;\n                        background-image: none;\n                        border: none;\n                        border-radius: 0 0.375rem 0.375rem 0;\n                        -webkit-appearance: none;\n                    }\n\n                    .input-left {\n                        padding: 0.25rem 0 0.25rem 0.5rem;\n                        font-size: 1.75rem;\n                        color: #555;\n                        text-align: center;\n                        background-color: #fff;\n                        border: none;\n                        border-radius: 0.375rem 0 0 0.375rem;\n                        height: 2.25rem;\n                    }\n\n                    .timeline {\n                        position: relative;\n                        width: 100%;\n                        margin: 0 auto;\n                        padding: 0.25em 0;\n                        list-style-type: none;\n                    }\n\n                    .timeline:before {\n                        content: "";\n                        position: absolute;\n                        left: 0.75rem;\n                        top: 0;\n                        display: block;\n                        width: 1px;\n                        height: 100%;\n                        background: rgb(200, 200, 200);\n                        background: -webkit-linear-gradient(top, rgba(200, 200, 200, 0) 0%, rgb(200, 200, 200) 8%, rgb(200, 200, 200) 92%, rgba(200, 200, 200, 0) 100%);\n                        background: -ms-linear-gradient(top, rgba(200, 200, 200, 0) 0%, rgb(200, 200, 200) 8%, rgb(200, 200, 200) 92%, rgba(200, 200, 200, 0) 100%);\n                        background: linear-gradient(to bottom, rgba(200, 200, 200, 0) 0%, rgb(200, 200, 200) 8%, rgb(200, 200, 200) 92%, rgba(200, 200, 200, 0) 100%);\n                        z-index: 5;\n                    }\n\n                    .card-item-outset {\n                        position: relative;\n                        margin: 0 0.5rem;\n                    }\n\n                    .first-card-item-outset {\n                        margin: 0.75rem 0.5rem 0;\n                    }\n\n                    .first-card-item-outset:before {\n                        content: "";\n                        position: absolute;\n                        top: 0.875rem;\n                        left: 2px;\n                        display: block;\n                        width: 5px;\n                        height: 5px;\n                        background: #fff;\n                        border-radius: 50%;\n                        border: 1px solid rgb(255, 80, 80);\n                        z-index: 10;\n                    }\n\n                    .first-card-item-outset:after {\n                        content: "";\n                        position: absolute;\n                        left: 0.5rem;\n                        top: 1rem;\n                        height: 16px;\n                        width: 16px;\n                        margin-top: -8px;\n                        border: solid transparent;\n                        border-right-color: rgb(248, 248, 248);\n                        border-width: 8px;\n                        pointer-events: none;\n                    }\n\n                    .card-item-inset {\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, .3);\n                        overflow: hidden;\n                        margin: 0 0.375rem 0 1.5rem;\n                        background-color: #fff;\n                    }\n\n                    .first-card-item-inset {\n                        border-top-left-radius: 4px;\n                        border-top-right-radius: 4px;\n                    }\n\n                    .last-card-item-inset {\n                        border-bottom-left-radius: 4px;\n                        border-bottom-right-radius: 4px;\n                    }\n\n                    .card-item-outset:last-child {\n                        margin-bottom: 0.75rem;\n                    }\n\n                    .card-item-outset:last-child .card-item-inset {\n                        border-bottom-left-radius: 4px;\n                        border-bottom-right-radius: 4px;\n                    }\n\n                    .item-title {\n                        font-size: 0.875rem;\n                        padding: 0 0.75rem;\n                        height: 2rem;\n                        line-height: 2rem;\n                        overflow: hidden;\n                        white-space: nowrap;\n                        text-overflow: ellipsis;\n                        color: #333;;\n                        background: #f8f8f8;\n                        border-bottom: 1px dashed #e4e4e4;\n                    }\n\n                    .item-line {\n                        font-size: 0.75rem;\n                        height: 1.375rem;\n                        line-height: 1.375rem;\n                        color: #333;\n                    }\n\n                    /* ionic样式调整 */\n                    .col,\n                    .checkbox {\n                        padding: 0;\n                    }\n\n                    .checkbox input {\n                        position: relative;\n                        top: 0.25rem;\n                        width: 1.5rem;\n                        height: 1.5rem;\n                        float: right;\n                    }\n\n                    .checkbox input:after {\n                        position: absolute;\n                        top: 34%;\n                        left: 20%;\n                    }\n\n                    .checkbox input:checked:before {\n                        background: #ffc107;\n                        border-color: #ffc107;\n                    }\n                </style> <div class="isFirstReloading" ng-if="config.isFirstReloading" style="height:3rem;line-height:3rem;font-size:0.8rem;width:100%;text-align:center;color:rgba(49, 49, 49, 0.51);"> <ion-spinner icon="ios-small" class="users-loading-spinner" style="margin-right:1rem;"></ion-spinner> <span>正在刷新数据</span> </div> <div class="no-more-data" style="height:3rem;line-height:3rem;font-size:0.8rem;width:100%;text-align:center;color:rgba(49, 49, 49, 0.51);" ng-if="(config.isLoadingMore || config.isReloading ) ? false : !config.hasNextPage"> 暂无更多数据了 </div> <ion-infinite-scroll ng-if="!config.isReloading && (config.isLoadingMore ? true : config.hasNextPage)" immediate-check="false" distance="1%" on-infinite="loadMoreData();"> </ion-infinite-scroll> </ion-scroll>  <div id="hec-bottom-buttons-div" class="tabs tabs-icon-top tabs-positive" style="position: static" ng-if="config.isTodo==true">  <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="showOpinionPopup(\'reject\')"> <i class="ion-close" style="display: block;font-size: 1.125rem;height: 1.25rem;"></i> <span class="t">拒绝</span> </div> <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="showOpinionPopup(\'nod\')"> <i class="ion-checkmark" style="display: block;font-size: 1.25rem"></i> <span class="t">同意</span> </div> <div class="tab-item" style="margin-top: 5px;opacity: 1;" ng-click="goBatchTransfer();"> <i class="ion-android-share" style="display: block;font-size: 1.25rem"></i> <span class="t">转交</span> </div> <div class="tab-item" style="margin-top: 8px;opacity: 1;"> <i cound-switch="" class="icon ion-android-more-horizontal"></i> </div> <div style="width:0px; max-width:0px;height:2rem;max-height:2rem;min-height:2rem;"> <div cound-switch="" class="br-top-1 select-operation has-border-bottom addhandler" ng-class="{\'show-me\':(config.showAllBottons),\'hide-me\':(!config.showAllBottons)}" ng-click="goBatchAddHandler();"> <span class="t">添加处理人</span> </div> <div cound-switch="" ng-class="{\'show-me\':(config.showAllBottons),\'hide-me\':(!config.showAllBottons)}" class="br-top-2 select-operation has-border-bottom notify" ng-click="goBatchNotify();"> <span class="t">通知</span> </div> </div> </div>  <div class="hec-bottom-content-div fill-width hec-bottom-for-done" ng-if="config.isDone==true"> <div class="hec-bottom-buttons-wrapper fill-parent"> <div class="hec-bottom-buttons fill-parent"> <div class="hec-bottom-buttons-inner fill-parent"> <div class="select-operation notify" ng-click="goBatchNotify();" style="background: #c4151c;border-right: none;">  <span style="color: #fff;">通知</span> </div> </div> </div> </div> </div> <style>\n                textarea.reject-textarea-comment::-webkit-input-placeholder {\n                    color: #FFAEAE;\n                }\n\n                textarea.reject-textarea-comment:-ms-input-placeholder {\n                    color: #FFAEAE;\n                }\n\n                textarea.reject-textarea-comment:-moz-placeholder {\n                    color: #FFAEAE;\n                }\n\n                textarea.reject-textarea-comment::-moz-placeholder {\n                    color: #FFAEAE;\n                }\n\n                textarea.approve-textarea-comment::-webkit-input-placeholder {\n                    color: #FFAEAE;\n                }\n\n                /*#br-wfl-done-list .listdata-item-selected-done.not-selected:before {*/\n                /*background-color: #f8f8f8 !important;*/\n                /*border-color: #f8f8f8 !important;*/\n                /*}*/\n\n                /*#br-wfl-done-list .listdata-item-selected-done.not-selected:after {*/\n                /*border-color: #f8f8f8 !important;*/\n                /*}*/\n\n                .handle-loading-tip {\n                    width: 100%;\n                    height: 100%;\n                    display: table;\n\n                }\n\n                .handle-loading-tip span {\n                    display: table-cell;\n                    vertical-align: middle;\n                    text-align: center;\n                }\n\n                i.ion-close {\n                    color: #c4151c;\n                }\n\n                i.ion-checkmark {\n                    color: #c4151c;\n                }\n\n                i.ion-android-share {\n                    color: #c4151c;\n                }\n\n                i.ion-android-more-horizontal {\n                    color: #c4151c;\n                }\n\n                span.t {\n                    color: #7c7d7f;\n                }\n\n                .tabs-positive > .tabs, .tabs.tabs-positive {\n                    border-color: white;\n                    background-color: white;\n                    background-image: linear-gradient(0deg, #0c63ee, #0c63ee 50%, transparent 50%);\n                    color: #fff;\n                }\n\n                .br-top-1, .br-top-2 {\n                    position: relative !important;\n                    left: -6rem !important;\n                    width: 6rem !important;\n                    background-color: white;\n                    text-align: center;\n                }\n\n                .select-operation.notify {\n                    background-color: #c4151c;\n                }\n\n                span.t {\n                    background-color: white;\n                }\n\n                .select-operation.notify {\n                    background-color: #c4151c;\n                }\n\n                button.button.ng-binding.button-positive {\n                    background-color: #c4151c;\n                    border: 1px solid #c4151c;\n                }\n\n                /*button.button.ng-binding.button-default {*/\n                /*background-color: #c4151c;*/\n                /*border:1px solid #c4151c;*/\n                /*}*/\n            </style> </div>                                                                                                                                                                                                                                                                                </ion-content> </ion-view>')}])}(),function(e){try{e=angular.module("hec-templates")}catch(n){e=angular.module("hec-templates",[])}e.run(["$templateCache",function(e){"use strict";e.put("html/weixin/wfl/handle/wfl_handle.html",'<ion-view view-title="{{config.viewTitle}}" class="hec-wfl-handle-page-class" id="hec-wfl-handle-page" hide-nav-bar="false" hide-back-button="false" cache-view="true" ng-controller="WflHandleController"> <ion-nav-buttons side="right" style="background-color: #c4151c"> <div ng-disabled="true" class="hec-circl-button wfl_select_button" style="background-color: #c4151c;"> <span ng-if="showHandleSelectCount();" style="background-color: #c4151c;color: #fff;">{{config.insidNodeidArray.length}}</span> </div> </ion-nav-buttons> <style>\n        .handle-loading-tip {\n            width: 100%;\n            height: 100%;\n            display: table;\n        }\n\n        .handle-loading-tip span {\n            display: table-cell;\n            vertical-align: middle;\n            text-align: center;\n        }\n\n        button.button.button-block.button-calm.sureButton {\n            background-color: #c4151c;\n            border: 1px solid #c4151c;\n        }\n    </style> <ion-content id="hec-wfl-handle-page-content" class="has-footer" scroll="false"> <div class="wfl-handle-content fill-parent"> <div class="handle-type-tip" style="height: 5%;line-height: 2rem;padding-left: 0.75rem;background: #eeedf3;color: #737272;" ng-class="{\'approve\':(config.isApproveType),\'reject\':(config.isRejectType),\'transfer\':(config.isTransferType),\'addhandler\':(config.isAddHandlerType)}"> <span>{{config.handleTip}}</span> </div> <div id="handle-approve-reject-content" ng-if="config.isApproveType || config.isRejectType" style="height:94%;"> <div class="approve-comment fill-parent"> <div class="approve-comment-div padding fill-parent"> <textarea placeholder="{{config.commentTextareaHolder}}" class="handle-comment-textarea fill-parent padding" ng-model="config.handleComment"></textarea> </div> </div> </div> <div id="handle-notify-content" style="height:94%;width:100%;" ng-if="config.isNotifyType"> <div class="notify-content-inner fill-parent"> <div class="yd-notify-textarea"> <textarea placeholder="{{config.commentTextareaHolder}}" class="handle-comment-textarea fill-parent padding" ng-model="config.handleComment"></textarea> </div> <style>\n                        .yd-notify-textarea {\n                            margin: .1rem 0px 1rem 0px;\n                            height: 6rem;\n                            padding: 3px 0px 10px 0px;\n                            background-color: white;\n                        }\n\n                        .yd-notify-textarea textarea {\n                            padding-top: 10px;\n                            padding-bottom: 10px;\n                            border: 0px !important;\n                        }\n                    </style> <ion-scroll class="fill-parent wfl-notify-content-users-scroll" scrollbar-y="false" has-bouncing="true"> <div class="yd-notify-users"> <div class="yd4-notify-user" ng-repeat="user in config.notifyEmps"> <div class="yd4-left-logo"> <img src="images/weixin/user_default.png" style="width: 2rem;height: 2rem;"> </div> <div class="yd4-right-text"> {{user.exp_emp_name}} </div> <div class="yd4-right-icon" style="line-height: 1.25rem;" ng-click="deleteNotifer($index);"> <i class="icon ion-ios-close-empty" style="font-size: 2rem;"></i> </div> </div> </div> <style>\n                            .yd4-notify-user {\n                                display: table;\n                                height: 3rem;\n                                width: 100%;\n                                border-bottom: 1px solid #F1F1F1;\n                                background: white;\n                            }\n\n                            .yd4-right-icon {\n                                display: table-cell;\n                                vertical-align: middle;\n                                width: 3rem;\n                                padding-left: 1rem;\n                                text-align: left;\n                                font-size: 3rem;\n                                color: #B1AFAF;\n                                height: 100%;\n                            }\n\n                            .yd4-left-logo {\n                                display: table-cell;\n                                vertical-align: middle;\n                                text-align: center;\n                                width: 18%;\n                                height: 2rem;\n                                min-height: 2rem;\n                                max-height: 2rem;\n                            }\n\n                            .yd4-left-logo img {\n                                max-width: 100%;\n                                max-height: 100%;\n                                height: 100%;\n                                vertical-align: middle;\n                            }\n\n                            .yd4-right-text {\n                                display: table-cell;\n                                vertical-align: middle;\n                                text-align: left;\n                            }\n                        </style> <div class="yd-notify-add-user-btn"> <div class="yd-added-user-line-btn" ng-click="goSelectUserPage();"> <div class="yd4-left-image"> <img src="images/weixin/wfl_addhandler_adduser.png" style="width: 2rem;height: 2rem;"> </div> <div class="yd4-center-text"> 添加员工 </div> <div class="yd4-right-arrow" style="line-height: 2rem;"> <i class="icon ion-ios-arrow-right" style="font-size: 1.5rem;"></i> </div> </div> <style>\n                                .yd-added-user-line-btn {\n                                    display: table;\n                                    width: 100%;\n                                    height: 3rem;\n                                    background-color: white;\n                                }\n\n                                .yd4-left-image {\n                                    display: table-cell;\n                                    height: 2rem;\n                                    min-height: 2rem;\n                                    max-height: 2rem;\n                                    vertical-align: middle;\n                                    width: 18%;\n                                    text-align: center;\n                                }\n\n                                .yd4-left-image img {\n                                    max-width: 100%;\n                                    max-height: 100%;\n                                    height: 100%;\n                                    vertical-align: middle;\n                                }\n\n                                .yd4-center-text {\n                                    display: table-cell;\n                                    height: 3rem;\n                                    vertical-align: middle;\n                                }\n\n                                .yd4-right-arrow {\n                                    display: table-cell;\n                                    height: 3rem;\n                                    line-height: 3rem;\n                                    font-size: 2.5rem;\n                                    color: #B1AFAF;\n                                    padding-left: 1rem;\n                                    width: 3rem;\n                                }\n\n                                .buttons.buttons-right {\n                                    background-color: #c4151c;\n                                }\n\n                                span.right-buttons {\n\n                                }\n\n                            </style> </div> </ion-scroll> </div> </div> <style>\n                /*\n                    .notify-content-inner{\n                        display: flex; \n                        flex-direction: column;\n                    }\n                    .yd-notify-textarea{\n                        height: 6rem;\n                    }\n                    .wfl-notify-content-users-scroll{\n                        flex: 1;\n                        padding-top: .4rem;\n                        padding-bottom: 1rem;\n                        margin-bottom: 1rem;\n                    }\n                */\n            </style> <div id="handle-transfer-content" style="height:94%;" ng-if="config.isTransferType"> <div class="yd-added-user-line-btn" ng-click="goSelectUserPage();" style="background: #fff;"> <div class="yd3-left-image"> <img src="images/weixin/user_default.png" style="width: 2rem;height: 2rem;"> </div> <div class="yd3-center-text"> <span ng-if="!config.currentUser.exp_emp_name" style="display: block;width: 100%;height: 2rem;margin-top: 0.25rem;padding: 0.25rem;font-size: 1rem;color: #999;"> 请点击选择转交人 </span> <span ng-if="config.currentUser.exp_emp_name" style="display: block;width: 100%;height: 2rem;margin-top: 0.25rem;padding: 0.25rem;font-size: 1rem;"> {{config.currentUser.exp_emp_name}} </span> </div> <div class="yd3-right-arrow" style="line-height: 0.813rem;"> <i class="icon ion-ios-arrow-right" style="font-size: 1.5rem;"></i> </div> </div> <div class="approve-comment fill-parent padding"> <div class="transfer-comment-div"> <textarea placeholder="{{config.commentTextareaHolder}}" class="handle-comment-textarea padding" ng-model="config.handleComment" style="height: 80%;width: 100%;border-radius: 5px;"></textarea> </div> </div> <style>\n                    .yd-added-user-line-btn {\n                        height: 3rem;\n                        width: 100%;\n                        display: table;\n                    }\n\n                    .yd3-left-image {\n                        display: table-cell;\n                        vertical-align: middle;\n                        height: 2rem;\n                        width: 18%;\n                        text-align: center;\n                    }\n\n                    .yd3-left-image img {\n                        max-height: 100%;\n                        max-width: 100%;\n                        vertical-align: middle;\n                    }\n\n                    .yd3-center-text {\n                        display: table-cell;\n                        height: 100%;\n                        vertical-align: middle;\n                    }\n\n                    .yd3-right-arrow {\n                        height: 100%;\n                        display: table-cell;\n                        vertical-align: middle;\n                        width: 3rem;\n                        padding-left: 1rem;\n                        font-size: 2.5rem;\n                        color: #B1AFAF;\n                    }\n                </style> </div> <div id="handle-addhandler-content" style="height:94%;" ng-if="config.isAddHandlerType"> <div class="add-approver-wrapper fill-parent" style="display:block !important;"> <div class="hecui-input-icon-line first-line" style="margin-bottom: 0.5rem;"> <div class="yd-add-priority-line" style="width:100%;"> <div class="yd-left-image"> <img src="images/weixin/wfl_handle_priority_icon.png" style="width: 1.25rem;height: 1.375rem;margin-top: 0.25rem;"> </div> <div class="yd-left-text"> 添加顺序: </div> <div class="yd-right"> <select class="none-appearance-select" name="handle-priority" ng-model="config.currentPriorityId" ng-options="value.name as value.value for value in config.select_priority"> <option value=""></option>  </select> <i class="icon ion-arrow-down-b"></i> </div> <style>\n                                select.none-appearance-select {\n                                    -webkit-appearance: none;\n                                    -moz-appearance: none;\n                                    appearance: none;\n                                }\n                            </style> </div> <style>\n                            #hec-wfl-handle-page-content .handle-type-tip {\n                                background-color: initial;\n                                color: #737272;\n                            }\n\n                            #hec-wfl-handle-page-content .handle-type-tip span {\n                                color: #737272;\n                            }\n\n                            .yd-add-priority-line {\n                                display: table;\n                                width: 100%;\n                                height: 3rem;\n                                background-color: white;\n                            }\n\n                            .yd-left {\n                                width: 40%;\n                                height: 100%;\n                                display: inline-table;\n                                float: left;\n                            }\n\n                            .yd-add-priority-line img {\n                                max-width: 100%;\n                                max-height: 1.3rem;\n                                /*height: 1.3rem;*/\n                            }\n\n                            .yd-left-text, .yd-left-image {\n                                display: table-cell;\n                                vertical-align: middle;\n                            }\n\n                            .yd-left-image {\n                                margin-right: .3rem;\n                                display: table-cell;\n                                width: 18%;\n                                text-align: center;\n                                vertical-align: middle;\n                            }\n\n                            .yd-left-text {\n                                display: table-cell;\n                                width: 25%;\n                                vertical-align: middle;\n                            }\n\n                            .yd-right {\n                                display: table-cell;\n                                padding-left: .6rem;\n                                vertical-align: middle;\n                            }\n\n                            .yd-right select {\n                                border: 0px;\n                                min-width: 3rem;\n                                background-color: white !important;\n                            }\n\n                            .yd-right i.icon {\n                                margin-left: -.2rem;\n                            }\n                        </style> </div> <style>\n                        .add-approver-height-0 {\n                            height: 3rem !important;\n                        }\n\n                        .add-approver-height-1 {\n                            height: 6rem !important;\n                        }\n\n                        .add-approver-height-3 {\n                            height: 9rem !important;\n                        }\n\n                        .add-approver-height-4 {\n                            height: 12rem !important;\n                        }\n\n                        .add-approver-height-5 {\n                            height: 15rem !important;\n                        }\n\n                        .add-approver-height-6 {\n                            height: 18rem !important;\n                        }\n\n                        .add-approver-height-7 {\n                            height: 21rem !important;\n                        }\n\n                        .add-approver-height-8 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-9 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-10 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-11 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-12 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-13 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-14 {\n                            height: 24rem !important;\n                        }\n\n                        .add-approver-height-15 {\n                            height: 24rem !important;\n                        }\n                    </style> <div class="add-approver {{\'add-approver-height-\'+(config.selectedForAddHandler.length+1)}}" style="max-height:88% !important; height: 3rem;flex:1;"> <ion-scroll class="fill-parent" scrollbar-y="false" has-bouncing="true" style="max-height:24rem;overflow: hidden;background-color:white;"> <div class="yd-added-user-line-btn" ng-click="goSelectUserPage();"> <div class="yd3-left-image"> <img src="images/weixin/wfl_addhandler_adduser.png" style="width: 2rem;height: 2rem;"> </div> <div class="yd3-center-text"> 添加员工 </div> <div class="yd3-right-arrow" style="line-height: 0.813rem;"> <i class="icon ion-ios-arrow-right" style="font-size: 1.5rem;"></i> </div> </div> <style>\n                                #handle-addhandler-content .add-approver {\n                                    min-height: 3rem;\n                                }\n\n                                div.add-approver {\n                                    height: initial !important;\n                                    min-height: 3rem !important;\n                                    border: 0px !important;\n                                }\n\n                                .yd-added-user-line-btn {\n                                    height: 3rem;\n                                    width: 100%;\n                                    display: table;\n                                }\n\n                                .yd3-left-image {\n                                    display: table-cell;\n                                    vertical-align: middle;\n                                    height: 2rem;\n                                    min-height: 2rem;\n                                    max-height: 2rem;\n                                    width: 18%;\n                                    text-align: center;\n                                }\n\n                                .yd3-left-image img {\n                                    max-height: 100%;\n                                    max-width: 100%;\n                                    height: 100%;\n                                    vertical-align: middle;\n                                }\n\n                                .yd3-center-text {\n                                    display: table-cell;\n                                    height: 100%;\n                                    vertical-align: middle;\n                                }\n\n                                .yd3-right-arrow {\n                                    height: 100%;\n                                    display: table-cell;\n                                    vertical-align: middle;\n                                    width: 3rem;\n                                    padding-left: 1rem;\n                                    font-size: 2.5rem;\n                                    color: #B1AFAF;\n                                }\n                            </style> <div class="yd-added-users"> <div class="yd3-added-user" ng-repeat="item in config.selectedForAddHandler"> <div class="yd3-left-logo"> <img src="images/weixin/user_default.png" style="width: 2rem;height: 2rem;"> </div> <div class="yd3-right-text"> {{item.exp_emp_name}} </div> <div class="yd3-right-icon" style="line-height: 1.25rem;" ng-click="deleteHandler($index);"> <i class="icon ion-ios-close-empty" style="font-size: 2rem;"></i> </div> </div> <style>\n                                    .yd3-right-icon {\n                                        display: table-cell;\n                                        vertical-align: middle;\n                                        width: 3rem;\n                                        padding-left: 1rem;\n                                        text-align: left;\n                                        font-size: 3rem;\n                                        color: #B1AFAF;\n                                    }\n\n                                    .yd3-added-user {\n                                        display: table;\n                                        height: 3rem;\n                                        max-height: 3rem;\n                                        width: 100%;\n                                        text-align: center;\n                                        border-bottom: 1px solid #F3F3F3;\n                                    }\n\n                                    .yd3-left-logo {\n                                        display: table-cell;\n                                        vertical-align: middle;\n                                        width: 18%;\n                                        height: 2rem;\n                                        min-height: 2rem;\n                                        max-height: 2rem;\n                                    }\n\n                                    .yd3-left-logo img {\n                                        max-width: 100%;\n                                        max-height: 100%;\n                                        height: 100%;\n                                        vertical-align: middle;\n                                    }\n\n                                    .yd3-right-text {\n                                        display: table-cell;\n                                        vertical-align: middle;\n                                        text-align: left;\n                                    }\n                                </style> </div> </ion-scroll> </div> </div> </div> <style>\n                /*.abc{\n                    background-color: #FB7749;\n                    border: 0px;\n                }\n                #hec-wfl-handle-page-content{\n                    display: flex;\n                    flex-direction: column;\n                }\n                #hec-wfl-handle-page-content .{\n\n                }*/\n            </style> </div> </ion-content> <ion-footer-bar id="hec-wfl-handle-footer" align-title="center" class="bar-assertive" ng-if="!config.isAddHandlerType"> <div class="buttons fill-parent"> <button ng-disabled="disableBottomOkBtn();" style="background-color:#c4151c; border:0px;font-size: 1rem;" ng-click="handleOperator();" class="button button-block button-calm">确&nbsp;&nbsp;定 </button>  </div> </ion-footer-bar> <ion-footer-bar id="hec-wfl-handle-footer" align-title="center" ng-if="config.isAddHandlerType"> <div class="buttons fill-parent"> <button ng-disabled="disableBottomOkBtn();" style="background-color:#c4151c; border:0px;font-size: 1rem;" ng-click="handleOperator();" class="button button-block button-calm">确&nbsp;&nbsp;定 </button> </div> </ion-footer-bar> </ion-view>');
}])}();
//'hec-templates' 
//var hecModule = angular.module('hec-ui', ['ionic']); 
var hecModule = angular.module('hec-ui',['ionic', 'hec-templates']);
hecModule.views = {}; 
hecModule.service('$AuHttp', ['$http', '$q', '$filter', '$ionicPopup', function ($http, $q, $filter, $ionicPopup) {
    return {
        request: request
    }
    function request(opt) {
        var delay = $q.defer();
        //alert(JSON.stringify(opt));
        $http.post(
            opt.url,
            "_request_data=" + encodeURIComponent( $filter('json')({parameter: opt.para}) ), 
            {headers: {"Content-Type": "application/x-www-form-urlencoded"}}
        ) 
        .success(function (data, status, headers, config) {
            //alert(JSON.stringify(data));
            /*alert(status);
            alert(JSON.stringify(headers));
            alert(JSON.stringify(config));*/
            // alert('success');
            var resultData = null;
            if (data.success) {
                if (data && data.result) {
                    if (data.result.record) {
                        if (data.result.record.length) {
                            resultData = data.result.record;
                        } else {
                            resultData = [];
                            resultData.push(data.result.record);
                        }
                    }
                }
                delay.resolve({
                    data: resultData,
                    status: status,
                    headers: headers,
                    config: config,
                    response: data
                });
            }else {
                var msgBox;
                if(angular.isString(data)&&data.indexOf('login')>=0){
                    msgBox = $ionicPopup.alert({
                        title: '错误',
                        template: 'session超时'
                    });
                }else{
                    msgBox = $ionicPopup.alert({
                        title: '错误',
                        template: data.error.message
                    });
                };
                

                delay.reject({
                    data: resultData,
                    status: status,
                    headers: headers,
                    config: config,
                    response: data,
                    msgBox: msgBox
                });
            }
        })
        .error(function (data, status, headers, config) {
            void 0;
            var msgBox = $ionicPopup.alert({
                title: '错误',
                template: '请求失败'
            });
            
            
            /*console.log(data);
            console.log(status);
            console.log(headers);
            console.log(config);*/

            delay.reject({
                data: data,
                status: status,
                headers: headers,
                config: config,
                resp: data,
                msgBox: msgBox
            });
        });
        return delay.promise;
    }
}]);
hecModule.service('$nineBlockDelegate', ionic.DelegateService([
	'refreshTipCount'
]));
hecModule.directive('hecNineBlock', [
	'$timeout',
	'$controller',
	'$AuHttp', 
	function($timeout, $controller, auHttp){
	return {
		restrict: 'E',
		scope: true,
		templateUrl: 'html/weixin/templates/hecNineBlock.html',
		compile: function (element){
			
			return {pre: preLink};

			function preLink($scope, $element, $attr){
				$scope.config = {
					delegateHandle: $attr.delegateHandle,
					baseUrl: $attr.baseUrl,
					nineDataRemoteUrl: $attr.nineDataRemoteUrl,
					nineDataRemote: [],
					nineDataLocal : $attr.nineDataLocal,
					fromRemote : $attr.fromRemote,
					nineBlockData: []
				};
				
				var nineBlockViewOptions = {
		            el: angular.element($element[0]),
		            delegateHandle: $attr.delegateHandle
		        }; 
		        $controller('$nineBlockCtrl', {
		            $scope: $scope,
		            nineBlockViewOptions: nineBlockViewOptions
		        }); 

				if($scope.config.fromRemote && $scope.config.fromRemote == 'true'){
					__getAndHandleNineDataFromRemote($scope);					
				}else if($scope.config.nineDataLocal){
					$scope.config.nineBlockData = __handleNineBlockData($scope, $scope.config.nineDataLocal);
				};

				$scope.refreshTipsCount = function(){
					void 0;
					var rows = $scope.config.nineBlockData;
					if(!rows || rows.length==0)
						return;
					for (var i = 0; i < rows.length; i++) {
						var row = rows[i];
						for (var j = 0; j < row.length; j++) {
							var cell = row[j];
							if(cell.needGotCount){
								delete cell.hasGotCount;
								delete cell.count_number;
								__handleCountQueryUrl(cell, $scope.config.baseUrl);	
							};
						};
					};
				};

			};

			function __getAndHandleNineDataFromRemote($scope){
				var config = $scope.config;
				// 获取九宫格基本数据
	            var option = {_fetchall: true, pagesize: 12};
	            var fun_list_url = config.baseUrl + '/' + config.nineDataRemoteUrl;
	            auHttp.request({
	                url:  fun_list_url + '?pagesize='+option.pagesize+'&pagenum=' + (option.pagenum || 1) + '&_fetchall=' + (option._fetchall || 'false') + '&_autocount=' + (option.autocount || 'true'),
	                para: option.para
	            }).then(function (resp){
	            	var data = resp.data;
	                if(!data || !data.length || data.length == 0){
	                    return;
	                }
	                $scope.config.nineBlockData = data;
	                __handleNineBlockData($scope, $scope.config.nineBlockData);
	            });
			};

			function __handleNineBlockData($scope, dataRemoteOrLocal){
				var data = dataRemoteOrLocal;
				var newData = [];
                if(data.length > 12){
                    newData = data.slice(0, 12);
                }else if(data.length <9){
                    newData = data;
                    for (var i = newData.length; i <= 8; i++) {
                        newData[i] = {};
                        //var a = $scope.config.nineBlockData;
                    };
                }else if(data.length > 9 && data.length < 12){
                    newData = data;
                    for (var i = newData.length; i <= 11; i++) {
                        newData[i] = {};
                        //var a = $scope.config.nineBlockData;
                    };
                }else if(data.length == 9 || data.length == 12){
                    newData = data;
                }

                $scope.config.nineBlockData = [];
                var currentLine = -1, currentCell = -1;
                for (var i = 0; i < newData.length; i++) {
                    currentCell++;
                    if(i%3==0){
                        currentCell = 0;
                        currentLine++;
                        $scope.config.nineBlockData[currentLine] = [];
                    }
                    $scope.config.nineBlockData[currentLine][currentCell]=newData[i];
                    
                    __handleCountQueryUrl($scope.config.nineBlockData[currentLine][currentCell], $scope.config.baseUrl);
                };
			};

			function __handleCountQueryUrl(item, baseUrl){
				// 处理九宫格 每个图标的个数提示
				item.needGotCount = false;
	            if(!item.fun_icon_count_url){
	                return;
	            }
	            item.needGotCount = true;
	            // item.hasGotCount = false;
	            auHttp.request({
	            	url: baseUrl + '/' + item.fun_icon_count_url
                })
                .then(function (resp){
                    if(resp.data){
                        if(resp.data.length){
                           item.count_number = resp.data[0].count_number;                                
                        }else{
                            item.count_number = resp.data.count_number;
                        }
                    }else{
                        item.count_number = '!';
                    }
                    //alert(JSON.stringify(item));
                    $timeout(function(){
                    	item.hasGotCount = true;
                    }, 500);                    
            	});
			};

		}
	};
}]);
hecModule.controller('$nineBlockCtrl', [
	'$scope',
	'$nineBlockDelegate',
	'$ionicHistory',
	function($scope, $nineBlockDelegate, $ionicHistory){
	var self = this;
	var deregisterInstance = $nineBlockDelegate._registerInstance(
 		self, $scope.config.delegateHandle, function(){
 			return $ionicHistory.isActiveScope($scope);
 		}
 	);

	self.refreshTipCount = function(){
		void 0;
		$scope.refreshTipsCount();
	};

}]);
// app module define code                         // 'hec-templates'

var hecModules = ['hec-ui', 'ngAnimate', 'ngIOS9UIWebViewPatch'];
var hec = angular.module('HecAPP', hecModules);

hec.constant('HecDefaults', {
    postOptions: {
        pagesize: 10,
        pagenum: 1,
        _fetchall: false,
        _autocount: true
    },
    handleTypes: {
        APPROVE: 'APPROVE',
        REJECT: 'REJECT',
        ADDHANDLER: 'ADDHANDLER',
        TRANSFER: 'TRANSFER',
        NOTIFY: 'NOTIFY'
    }
});

hec.run([
    '$ionicPlatform', '$location', '$ionicPopup',
    '$rootScope', '$state', '$ionicHistory',
    '$ionicNavBarDelegate', '$timeout',
    function ($ionicPlatform, $location, $ionicPopup, $rootScope, $state, $ionicHistory, $ionicNavBarDelegate, $timeout) {

        $rootScope.isListPage = function () {
            if ($state.current.name == 'wfl.list.done' || $state.current.name == 'wfl.list.todo' || $state.current.name == 'wfl.list.tododoneapply') {
                return true;
            } else {
                return false;
            }
        };

        $rootScope.$on('$stateChangeStart', stateChangeStart);

        $rootScope.pageParams = {
            wflListPage: {
                todoOrDone: '',
                category: '',
                query_url_name: ''
            }
        };

        $rootScope.isListPage = function () {
            if ($state.current.name == 'wfl.list.done' || $state.current.name == 'wfl.list.todo') {
                return true;
            } else {
                return false;
            }
        };

        $rootScope.forceSetTitle = function (title) {

            // $ionicNavBarDelegate.changeTitle(title, null);

            var navBarEles = document.querySelectorAll("div.nav-bar-block");
            if (navBarEles.length > 0) {
                for (var i = 0; i < navBarEles.length; i++) {
                    var ele = navBarEles[i].querySelector("div.title");
                    ele.innerText = title;
                    ele.innerHTML = title;
                    //ele.outerText = title;
                    //ele.outerHTML = title;
                }
            }
            document.title = title;
            $timeout(function () {
                document.title = title;
            }, 600);
            $timeout(function () {
                document.title = title;
            }, 1000);
            // console.log(document.querySelectorAll("div.nav-bar-block"));

            /*var navBarEles = document.querySelectorAll("div.nav-bar-block[nav-bar=entering]");
             if(!navBarEles){
             return;
             }
             for(var i = 0; i < navBarEles.length; i++){
             var ele = navBarEles[i].querySelector("div.title");
             ele.innerText = title;
             }
             navBarEles = document.querySelectorAll("div.nav-bar-block[nav-bar=active]");
             if(!navBarEles){
             return;
             }
             for(var i = 0; i < navBarEles.length; i++){
             var ele = navBarEles[i].querySelector("div.title");
             ele.innerText = title;
             }*/

        }

        function stateChangeStart(event, toState, toParams, fromState, fromParam) {
            //alert(window.event ? window.event.type : '...');
            if (window.event && window.event.type == 'popstate') {
                var bool = window.confirm('确定退出吗');
                if (bool) {
                    event.preventDefault();
                    hecCloseWindow();
                } else {
                    event.preventDefault();
                }
                ;
            }
            ;
        };

    }]);

hec.config([
    '$stateProvider',
    '$urlRouterProvider',
    '$ionicConfigProvider',
    function ($stateProvider, $urlRouterProvider, $ionicConfigProvider) {

        $stateProvider
            /*.state('weixinlogin', {
             url: '/weixinlogin',
             'templateUrl': 'html/weixin/weixinlogin.html'
             })*/
            .state('home', {
                url: '/home',
                abstract: true,
                'templateUrl': 'html/weixin/home/main.html'
            })
            .state('home.main', {
                url: '/main',
                views: {
                    'homeContent': {
                        'templateUrl': 'html/weixin/home/home.html'
                    }
                }
            })

            .state('wfl', {
                url: '/wfl',
                abstract: true,
                'templateUrl': 'html/weixin/wfl/main.html'
            })

            .state('wfl.category', {
                url: '/category/{todoOrDone}',
                abstract: true,
                views: {
                    'wflContent': {
                        'templateUrl': 'html/weixin/wfl/wfl_category.html'
                    }
                }
            })
            .state('wfl.category.todo', {
                url: 'todo',
                views: {
                    'tododoneContent': {
                        'templateUrl': 'html/weixin/wfl/wfl_category_tododone.html'
                    }
                }
            })
            .state('wfl.category.done', {
                url: 'done',
                views: {
                    'tododoneContent': {
                        'templateUrl': 'html/weixin/wfl/wfl_category_tododone.html'
                    }
                }
            })

            .state('wfl.list', {
                url: '/list', // /{todoOrDone}/{category}/{query_url_name}
                abstract: true,
                views: {
                    'wflContent': {
                        'templateUrl': 'html/weixin/wfl/list/wfl_list.html'
                    }
                }
            })
            .state('wfl.list.tododoneapply', {
                url: 'tododoneapply',
                views: {
                    'wflListContent': {
                        'templateUrl': 'html/weixin/wfl/list/wfl_list_tododone.html'
                    }
                }
            })

            .state('wfl.detail', {
                url: '/detail',
                abstract: true,
                views: {
                    'wflContent': {
                        'templateUrl': 'html/weixin/wfl/detail/abs_detail.html'
                    }
                }
            })
            .state('wfl.detail.docinfo', {        // funType: todo、done、apply
                url: '/docinfo/{ins_doc_category}/{ins_doc_hd_id}/{ins_id}/{fun_type}/{ins_rcpt_id}',
                views: {
                    'detailContent': {
                        'templateUrl': 'html/weixin/wfl/detail/wfl_detail_doc_info.html'
                    }
                }
            })
            .state('wfl.detail.docflow', { // 所需参数从 父 $scope.$parent.config 中取
                url: '/docflow/{ins_id}/{detailInfoToFlowTimes}',
                views: {
                    'detailContent': {
                        'templateUrl': 'html/weixin/wfl/detail/wfl_detail_doc_flow.html'
                    }
                }
            })
            .state('wfl.detail.attachment', {
                url: '/attachment',
                views: {
                    'detailContent': {
                        'templateUrl': 'html/weixin/wfl/detail/wfl_detail_doc_attachment.html'
                    }
                },
                params: {
                    exp_rep_type_desc: "",
                    exp_rep_hd_id: ""
                }
            })
            .state('wfl.handle', {
                // url: '/handle/{handleType}/{ids}/{insId}/{nodeId}',
                url: '/handle/{handleType}/{ids}/{insidNodeidArrayStr}',
                views: {
                    'wflContent': {
                        'templateUrl': 'html/weixin/wfl/handle/wfl_handle.html'
                    }
                }
            })

            .state('user', {
                url: '/user',
                abstract: true,
                templateUrl: 'html/weixin/user/abs_user.html'
            })
            .state('user.selectuser', {
                url: '/selectuser/{canMulti}/{hasUserIds}',
                views: {
                    'userContent': {
                        'templateUrl': 'html/weixin/user/user_selectuser.html'
                    }
                }
            })
            .state('user.info', {
                url: '/info/{exp_emp_id}/{user_id}',
                views: {
                    'userContent': {
                        'templateUrl': 'html/weixin/user/user_info.html'
                    }
                }
            });

        $urlRouterProvider
            .when('', '/home/main')
            .otherwise('/home/main');
    }]);

hec.controller('HecController', [
    '$scope',
    '$state',
    '$timeout',
    '$ionicNavBarDelegate',
    '$ionicHistory',
    '$ionicViewService',
    function ($scope, $state, $timeout, $ionicNavBarDelegate, $ionicHistory, $ionicViewService) {

        $scope.publicConfig = {
            // selectedUsers: []
            // handleOk: true/false

            handleTime: 0, // 用于配合微信返回按钮

            returnSelectTimes: 0,
            returnHandleTimes: 0,
            returnDetailTimes: 0,
            returnFlowToInfoTimes: 0
        };

        $scope.isWflListTododoneState = function () {
            if ($state.current.name == "wfl.list.tododoneapply") {
                return true;
            }
            return false;
        };

        $scope.publicFuns = {
            goBack: function (event, scope) {
                //window.history.back();
                $ionicHistory.goBack();
                /*event = event || window.event;
                 if(event.type && event.type == 'popstate'){
                 event.preventDefault();
                 $rootScope.$ionicGoBack();
                 }else{
                 if($ionicHistory.backView()){
                 $ionicHistory.goBack();
                 }else{
                 alert(" ----- no back view ----- ");
                 };
                 };*/


                // scope.$ionicGoBack();
                // $ionicHistory.goBack();
                /*$ionicHistory.nextViewOptions({
                 disableAnimate: true,
                 disableBack: true
                 });*/
                //$ionicHistory.goBack()
                //$ionicHistory.forwardView();
                //window.history.back();
                //$ionicNavBarDelegate.$getByHandle('HecBodyNavbar').back();
            }
        };
    }]);


hec.service("HecService", ['HecDefaults', function (hecDefaults) {
    var hostName = "http://jklife.imwork.net";
    var resultLength = 10;
    var urls = {
        'home': hostName + '/' + '/weixin.html',
        'login': hostName + '/' + 'modules/weixin/sys/login.svc',
        'fun_list': hostName + '/' + 'autocrud/weixin.sys.sys_user_mobile_function_query/query',

        // 员工信息相关接口
        'employee_detail': hostName + '/' + 'modules/weixin/exp/exp_employee_detail_query.svc',
        'employee_list': hostName + '/' + 'autocrud/weixin.exp.exp_employee_list_query/query',

        // 待办、已办、我的申请 列表 相关接口
        'todo_query_all': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_todo_query_all/query',
        'todo_query_exp_report': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_todo_query_exp_report/query',
        'todo_query_exp_requisition': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_todo_query_exp_requisition/query',
        'todo_query_payment_requisition': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_todo_query_payment_requisition/query',

        'done_query_all': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_done_query_all/query',
        'done_query_exp_report': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_done_query_exp_report/query',
        'done_query_exp_requisition': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_done_query_exp_requisition/query',
        'done_query_payment_requisition': hostName + '/' + 'autocrud/weixin.wfl.list.wfl_done_query_payment_requisition/query',

        'myapply_query_all': hostName + '/' + 'autocrud/weixin.wfl.WFL5010.wfl_instance_self_current/query',


        // 单据明细相关接口
        'approve_record_query': hostName + '/' + 'autocrud/weixin.wfl.wfl_approve_record_query/query',

        'detail_header_exp_report': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_header_all/query',
        'detail_header_exp_requisition': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_header_all/query',
        'detail_header_pay_requisition': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_header_all/query',

        'detail_lines_exp_report': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_lines_exp_report/query',
        'detail_lines_exp_requisition': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_lines_exp_requisition/query',
        'detail_lines_pay_requisition': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_detail_lines_payment_requisition/query',

        'detail_attachment_list': hostName + '/' + 'autocrud/weixin.wfl.detail.wfl_attachment_list/query',
        // 费用报销类型的 计划付款行明细接口
        'exp_report_pmtplan_query': hostName + '/' + 'autocrud/weixin.wfl.detail.exp_report_pmtplan_schedules_query/query',

        // 流程预览相关接口
        'wfl_preview_record_init': hostName + '/' + 'autocrud/weixin.wfl.init_wfl_preview_record/batch_update',
        'wfl_preview_record_query': hostName + '/' + 'autocrud/weixin.wfl.wfl_preview_record_query/query',

        // 单据处理相关接口
        'approve': hostName + '/' + 'autocrud/db.sys_mobile_pkg.wfl_approve/batch_update',
        'commission': hostName + '/' + 'autocrud/db.sys_mobile_pkg.wfl_commission/batch_update',
        'notify': hostName + '/' + 'autocrud/db.sys_mobile_pkg.wfl_notify/batch_update',
        //'add_approver': hostName + '/' + 'autocrud/db.sys_mobile_pkg.wfl_add_approver/batch_update',
        'add_approver': hostName + '/' + 'modules/weixin/wfl/wfl_add_approver.svc',
        'cancel_workflow_instance': hostName + '/' + 'autocrud/wfl.wfl_back_instance/insert',
        'cancel_workflow_instance_done': hostName + '/' + 'autocrud/db.sys_mobile_pkg.wfl_back_to_pre_node/execute',
        'atm_download': hostName + '/' + 'atm_download.svc'
    };
    // 单据明细支持的单据类型：
    var detailSupportCategory = [
        'EXP_REPORT',
        'EXP_REQUISITION',
        'PAYMENT_REQUISITION'
    ];

    return {
        getParamsUrl: function (option) {
            var opt = angular.copy(hecDefaults.postOptions);
            angular.extend(opt, option);
            return 'pagesize=' + opt.pagesize + '&pagenum=' + opt.pagenum + '&_fetchall=' + opt._fetchall + '&_autocount=' + opt._autocount;
        },
        getHostName: function () {
            return hostName;
        },
        getCategoryDesc: function (category) {
            var desc = '';
            switch (category) {
                case'EXP_REPORT':
                    desc = "费用报销";
                    break;
                case 'EXP_REQUISITION':
                    desc = "费用申请";
                    break;
                case 'PAYMENT_REQUISITION':
                    desc = "借款申请";
                    break;
                case 'ALL':
                    desc = "全部";
                    break;
            }
            ;
            return desc;
        },
        getDetailLinesUrlTip: function (category) {
            switch (category) {
                case 'EXP_REPORT':
                    return 'detail_lines_exp_report';
                case 'EXP_REQUISITION':
                    return 'detail_lines_exp_requisition';
                case 'PAYMENT_REQUISITION':
                    return 'detail_lines_pay_requisition';
            }
        },
        getDetailHeaderUrlTip: function (category) {
            switch (category) {
                case 'EXP_REPORT':
                    return 'detail_header_exp_report';
                case 'EXP_REQUISITION':
                    return 'detail_header_exp_requisition';
                case 'PAYMENT_REQUISITION':
                    return 'detail_header_pay_requisition';
            }
        },
        getUrl: function (itfName) {
            //return contextPath + '/' + urls[itfName];
            return urls[itfName];
        },
        getUrlFromBase: function (itfName) {
            return hostName + '/' + itfName;
        },
        resultLength: resultLength,
        ifDetailSupport: function (workflow_category) {
            for (var i = detailSupportCategory.length - 1; i >= 0; i--) {
                if (detailSupportCategory[i] == workflow_category) {
                    return true;
                }
            }
            ;
            return false;
        },
        getNotSupportTip: function (workflow_category_name) {
            var tip = '暂不支持 ' + detailSupportCategory + '';
            return tip;
        }
    }
}]);

hec.service("WeixinLoginService", [
    "HecService", 
    '$AuHttp',
function (hecS, auHttp) {
        return {
            /**
             * login：用户登陆
             * 参数：
             * user_name：用户名
             * ticket：微信登陆票据
             * 返回值：无
             */
            login: function (option) {
                return auHttp.request({
                    url: hecS.getUrl('login'),
                    para: {
                        user_name: option.user_name,
                        ticket: option.ticket
                    }
                });
            }
        }
    }]);
hec.controller('WeixinLoginCtrl', [
	'$scope',
	'$state',
	'$timeout',
	'WeixinLoginService',
	function($scope, $state, $timeout, weixinLoginS){

		function login(){
			weixinLoginS
			.login({
				user_name: $scope.publicConfig.loginInfo.userName,
				ticket: $scope.publicConfig.loginInfo.ticket
			})
			.then(function (resp){
				//alert('go home.main...');
				$state.go("home.main", {}, {relative:false});				
			});
		};

		function __init(){
			 //alert(' WeixinLoginCtrl -- __init ');
			$timeout(login, 1000);
		};

		//__init();

	}]);


	//alert('WeixinLoginModule.js end!');


hec.service('HomeService', [
    '$AuHttp', 'HecService',
    function (auHttp, hecS) {
        return {
            /**
             * fun_list：用户九宫格功能列表查询
             * 参数：无
             * 返回值：
             * fun_code：功能代码
             * fun_name：功能名称
             * fun_icon：功能图标的class
             * fun_icon_count_url：功能图标右上角数量查询的URL
             * fun_url：功能跳转地址
             */
            queryFunList: function (option) {
                opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('fun_list') + '?pagesize=' + ( opt.pagesize || hecS.resultLength) + '&pagenum=' + (opt.pagenum || 1) + '&_fetchall=' + (opt._fetchall || 'false') + '&_autocount=' + (opt.autocount || 'true'),
                    para: opt.para
                });
            },
            /**
             * queryFunIconCount：用户九宫格功能列表图标右上角的计数查询
             * option: {
             *      suffixUrl: '', // eg: modules/..../*.screen 、 antocru/.../*.bm
             * }
             * 参数：无
             * 返回值：
             *
             */
            queryFunIconCount: function (option){
                opt = option || {};
                return auHttp.request({
                    url: hecS.getUrlFromBase(option.suffixUrl),
                    para: opt.para
                });
            }
        }
    }])
.controller('HomeController', [ 
    '$scope',
    '$rootScope',
    '$ionicSlideBoxDelegate', 
    '$state',
    '$nineBlockDelegate',
    'HomeService',
    'HecService',
    function ($scope, $rootScope, $ionicSlideBoxDelegate, $state, $nineBlockDelegate, homeS, hecS) {
        $scope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParam){
            if(toState && fromState && fromState.name && toState.name && toState.name=="home.main"){
                if(fromState.name=="wfl.category.done" || fromState.name=="wfl.category.todo"){
                    $nineBlockDelegate.$getByHandle('fun-list').refreshTipCount();
                };
            };
        });

        $scope.goState = function (state) {
            void 0;
            if(!state){ return; };
            if(state == 'wfl.list.apply'){
                $rootScope.pageParams.wflListPage.category = "ALL";
                $rootScope.pageParams.wflListPage.query_url_name = "myapply_query_all";
                $rootScope.pageParams.wflListPage.todoOrDone = "APPLY";
                $state.go('wfl.list.tododoneapply');
            }else{
                $state.go(state);
            };
        }
        $scope.linein=0;
        $scope.pan=false;
        $scope.setLine=function(lineindex)
        {

            $scope.linein=lineindex;
            return false;

        }
        $scope.setlie=function(lielie,data)
        {
            if($scope.linein==0)
            {
                if(lielie==0)
                {
                    return true;

                }
                else if(lielie==2)
                {
                    if(data[$scope.linein][lielie-1].fun_name!=undefined)
                    {
                        return true;
                    }
                }
                else{
                    if(data[$scope.linein][lielie-1].fun_name!=undefined && data[$scope.linein][lielie+1].fun_name==undefined)
                    {
                        return true;
                    }

                }


            }
            else if($scope.linein==2)
            {
                if(lielie==0)
                {
                    if(data[$scope.linein-1][lielie+2].fun_name!=undefined && data[$scope.linein][lielie+1].fun_name==undefined)
                    {
                        return true;
                    }

                }
                else if(lielie==2)
                {
                    if(data[$scope.linein][lielie-1].fun_name!=undefined)
                    {
                        return true;
                    }
                }
                else{
                    if(data[$scope.linein][lielie-1].fun_name!=undefined && data[$scope.linein][lielie+1].fun_name==undefined)
                    {
                        return true;
                    }

                }
            }
            else{

                if(lielie==0)
                {

                    if(data[$scope.linein-1][lielie+2].fun_name!=undefined && data[$scope.linein][lielie+1].fun_name==undefined)
                    {

                        return true;
                    }
                }
                else if(lielie==2)
                {
                    if(data[$scope.linein][lielie-1].fun_name!=undefined && data[$scope.linein+1][lielie-2].fun_name==undefined)
                    {
                        return true;
                    }

                }
                else{
                    if(data[$scope.linein][lielie-1].fun_name!=undefined && data[$scope.linein][lielie+1].fun_name==undefined)
                    {
                        return true;
                    }

                }

            }
            return false;
        }
        $scope.refreshTipsCount = function(){
            $nineBlockDelegate.$getByHandle('fun-list').refreshTipCount();
        };

        $scope.slideChanged = function (index) {
            $scope.slideIndex = index;
            void 0;
        };
        $scope.next = function () {
            $ionicSlideBoxDelegate.next();
        };
        $scope.previous = function () {
            $ionicSlideBoxDelegate.previous();
        };

        $scope.config = {
            baseUrlName: ''
        };

        function __init(){
            //$scope.queryNineBlockData();
            $scope.config.baseUrlName = hecS.getHostName();
        };

        __init();

    }])

.directive('nineBlock', ['HomeService', function (homeS) {
    return {
        templateUrl: 'angular/template/nine-block.html',
        link: function ($scope, element, attrs) {
            homeS.queryFunList({
                _fetchall: true
            }).then(function (promise) {
                if(promise.data){
                    $scope.nineBlockData = promise.data;
                }
            });
        }
    }

}]);


 //   alert("HomeModule.js--end!");

hec.service('UserInfoService', ['$AuHttp', 'HecService', function(auHttp, hecS){
	return {
		/**
         * queryUserInfo：查询用户明细信息
         * 参数：(以下两个必须有一个)
         * 		@user_id：用户ID
         * 		@exp_emp_id: 员工ID
         * 返回值：JSON对象 
         *		其格式参照：UserController中 $scope.config.userInfo 的格式
         */
		queryUserInfo: function(options){
			var opt = options || {};

            return auHttp.request({
                url: hecS.getUrl('employee_detail'),
                para: opt.para
            });
		}
	};
}])


.controller('UserInfoController', [
	'$scope',
	'$rootScope',
	'$stateParams', 
	'UserInfoService', 
	function($scope, $rootScope, $stateParams, userInfoS){

	$scope.$on("$stateChangeSuccess", function (event, toState, toParams, fromState, fromParam){
		if(toState.name == 'user.info'){
			$rootScope.forceSetTitle("员工信息");
		}
    });
	
	$scope.config = {

		userInfo: {
			exp_emp_id: 0,	 // 员工ID
			exp_emp_name: '员工信息', // 员工姓名
			exp_emp_code: 0,  // 员工代码
			exp_emp_mobile: 0, // 员工手机号
			exp_emp_email: '暂无', 
			exp_emp_weixin: '暂无', //员工微信号
			exp_emp_weixin_avatar: '',  // 员工微信头像
			user_id: 0,
			user_name: '暂无',
			
			exp_company_name: '暂无',
			exp_unit_name: '暂无',
			exp_position_name: '暂无'
		}

	};

	$scope.init = function(){
		/*
		 *	加载用户信息至 $scope.config.userInfo
		 */
		var user_id = $stateParams.user_id,
			exp_emp_id = $stateParams.exp_emp_id;
		loadUserInfo(user_id, exp_emp_id);


	};

	$scope.init();



	/**
	 *
	 *	内部方法或属性
	 *
	 */

	 function loadUserInfo(user_id, exp_emp_id){
	 	var para = {
	 		user_id: user_id, 
	 		exp_emp_id: exp_emp_id
	 	};
	 	userInfoS.queryUserInfo({para: para})
	 		 .then(function (resp){
	 		 	if(resp.data){
	 		 		angular.extend($scope.config.userInfo, resp.data[0]);	 		 		
	 		 	}
	 		 });
	 }



}]);


hec.service('UserSelectService', [
	'$AuHttp',
	'HecService', 
	function(auHttp, hecS){
		return {
			queryEmployeeDetail: function (option) {
	            opt = option || {};
	            return auHttp.request({
	                url: hecS.getUrl('employee_detail') + '?pagesize=' + ( opt.pagesize || hecS.resultLength) + '&pagenum=' + (opt.pagenum || 1) + '&_fetchall=' + (opt._fetchall || 'false') + '&_autocount=' + (opt.autocount || 'true'),
	                para: opt.para
	            }); 
	        }, 
	        /**
	         * employee_list：员工列表查询
	         * 参数：
	         * exp_emp_name（可选）：员工姓名
	         * 返回值：
	         * exp_emp_id：员工ID
	         * exp_emp_name：员工姓名
	         * exp_emp_org_info：员工组织架构信息
	         */
	        queryEmployeeList: function (option) {
	            opt = option || {};
	            return auHttp.request({
	                url: hecS.getUrl('employee_list') + '?pagesize=' + ( opt.pagesize || hecS.resultLength) + '&pagenum=' + (opt.pagenum || 1) + '&_fetchall=' + (opt._fetchall || 'false') + '&_autocount=' + (opt.autocount || 'true'),
	                para: opt.para
	            });
	        }
		};
	}]);
	
hec.controller('UserSelectController', [ 
	'$scope',
	'$rootScope',
	'$stateParams',
	'$ionicPopup',
	'$state',
	'UserSelectService',
	function($scope, $rootScope, $stateParams, $ionicPopup,  $state, userSelectS){
		
		$scope.$on("$stateChangeSuccess", function (event, toState, toParams, fromState, fromParam){
			if(toState.name == 'user.selectuser'){
				$rootScope.forceSetTitle("员工选择");
			}
	    });

		$scope.config = {
			hasSelectdUserIds: [],
			canMulti: false,
			queryStr: '',

			users: [],
			currentSelectedIds: [],

			status_loading: false,
			status_loaded: false,

			returnSelectTimes: 0
		};

		$scope.searchInputOnKeyup = function (e){
			/*alert(JSON.stringify(e));
			alert(window.event);
			alert(e.keyCode);
			alert(e.which);			
			alert(keycode);*/
			var keycode = window.event ? e.keyCode : e.which;
            if(keycode==13){
                $scope.queryUser();
                return true;
            }
            return false;
		};

		$scope.cancel = function(){
			$scope.publicConfig.selectedUsers = null;
			//$scope.$ionicGoBack();
			$scope.publicFuns.goBack(null, $scope);
		};

		$scope.selectOk = function(){
			$scope.publicConfig.selectedUsers = angular.copy($scope.config.currentSelectedIds);
			$scope.config.currentSelectedIds = [];
			// $scope.$ionicGoBack();
			$scope.publicConfig.returnSelectTimes++;
			$scope.publicFuns.goBack(null, $scope);
		};

		$scope.selectUser = function(index){
			var item = $scope.config.users[index];

			// 临时跳转到用户令人信息界面，仅用于测试
			/*if(index == 0){
				$state.go('user.info', {
					exp_emp_id: item.exp_emp_id, 
					user_id: null
				});
				return;
			};*/

			// 判断用户是否已经添加（config.hasSelectdUserIds）
			for(var i = 0; i < $scope.config.hasSelectdUserIds.length; i++){
				if(item.exp_emp_id == $scope.config.hasSelectdUserIds[i]){
					//$scope.config.hasSelectdUserIds[i].selected = true;
					$scope.config.users[index].selected = true;
					var str = "用户 #username# 已经添加!".replace(/#username#/,item.exp_emp_name);
					item.cannotSelectSecond = true;
					$ionicPopup.alert({
						title: '提示',
						template: str
					});
					return;
				};
			};

			if($scope.config.canMulti){
				// item.selected = !item.selected;
				if(item.selected){
					item.selected = false;
					__deleteSelectedId(item.exp_emp_id);
				}else{
					item.selected = true;
					$scope.config.currentSelectedIds.push(item);
				}
			}else{
				if(item.selected){
					item.selected = false;
					return;
				};
				if($scope.config.currentSelectedIds.length > 0){
					__clearSelected();
				};
				$scope.config.users[index].selected = true;
				$scope.config.currentSelectedIds = [];
				$scope.config.currentSelectedIds.push(angular.copy($scope.config.users[index]));
			};

		};

		function __deleteSelectedId(userId){
			var ids = $scope.config.currentSelectedIds;
			for(var i = 0; i < ids.length; i++){
				if(ids[i].exp_emp_id == userId){
					var temp = [];
					temp = ids.slice(0, i).concat(ids.slice(i+1));
					$scope.config.currentSelectedIds = temp;
				}
			}
		};

		function __clearSelected(){
			for(var i = 0; i < $scope.config.users.length; i++){
				$scope.config.users[i].selected = false;
			}
		};

		$scope.queryUser = function (){
			//alert("queryUser  "+ $scope.config.queryStr);
			$scope.config.status_loading = true;
			$scope.config.status_loaded = false;
	        var params = {
	            exp_emp_name: $scope.config.queryStr
	        };
	        delete $scope.config.users;
	        userSelectS.queryEmployeeList({para: params}).then(function (resp){
	            if(resp.data){
	            	//alert(JSON.stringify(resp.data));	                
	                $scope.config.users = resp.data;	                					
	            }else{
	            	//alert("no data:  "+ JSON.stringify(resp));
	            	$scope.config.users = [];
	            }
	            $scope.config.status_loading = false;
	            $scope.config.status_loaded = true;
	        });
	    };

		function __init(){
			$scope.publicConfig.selectedUsers = null;
			var ids = $stateParams.hasUserIds;
			var multi = $stateParams.canMulti;
			if(multi && multi != "false"){
				$scope.config.canMulti = true;
			};
			if(ids && ids!=""){
				$scope.config.hasSelectdUserIds = JSON.parse(ids);
			};
			$scope.queryUser();
		};

		__init();

	}]);
hec.service('WflDetailService', [
    '$AuHttp',
    'HecService',
    function (auHttp, hecS) {
        return {
            queryExpReportPmtplan: function (option) {
                var opt = option || {};
                // opt.para: {exp_rep_hd_id: 110}
                return auHttp.request({
                    url: hecS.getUrl('exp_report_pmtplan_query'),
                    para: opt.para
                });
            },
            queryHeaderInfo: function (option) {
                var opt = option || {};
                var urlTip = hecS.getDetailHeaderUrlTip(option.category);
                return auHttp.request({
                    url: hecS.getUrl(urlTip),
                    para: opt.para
                });
            },
            /*
             queryExpReportLine: function (option){
             opt = option || {};
             return auHttp.request({
             url: hecS.getUrl('detail_lines_exp_report') + '?' + hecS.getParamsUrl(opt),
             para: opt.para
             });
             },
             queryExpRequisitionLine: function (option){
             opt = option || {};
             return auHttp.request({
             url: hecS.getUrl('detail_lines_exp_requisition') + '?' + hecS.getParamsUrl(opt),
             para: opt.para
             });
             },
             queryPayRequisitionLine: function (option){
             opt = option || {};
             return auHttp.request({
             url: hecS.getUrl('detail_lines_pay_requisition') + '?' + hecS.getParamsUrl(opt),
             para: opt.para
             });
             },*/
            queryLineInfo: function (option) {
                var opt = option || {};
                var baseUrlTip = hecS.getDetailLinesUrlTip(option.category);
                return auHttp.request({
                    url: hecS.getUrl(baseUrlTip),
                    para: opt.para
                });
            },

            /**
             * approve_record_query：审批记录查询接口
             * 参数
             * ins_id:工作流实例ID
             * 返回值：
             * approve_action_title：审批动作标题
             * approve_user_name：审批者姓名
             * approve_comment：审批意见
             * approve_user_id：审批用户ID
             * approve_date：approve_date
             * approve_date_format：审批日期格式化
             */
            queryApproveRecord: function (option) {
                opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('approve_record_query'),
                    para: opt.para
                });
            },
            queryDocFlowPreview: function (option) {
                var opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('wfl_preview_record_query'),
                    para: opt.para
                });
            },
            initDocFlowPreview: function (option) {
                var opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('wfl_preview_record_init'),
                    para: opt.para
                });
            },
            queryAttachments: function (option) {
                var opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('detail_attachment_list'),
                    para: opt.para
                });
            },
            cancelInstance: function (option) {
                var opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('cancel_workflow_instance'),
                    para: opt.para
                });
            },
            cancelInstanceDone: function (option) {
                var opt = option || {};
                return auHttp.request({
                    url: hecS.getUrl('cancel_workflow_instance_done'),
                    para: opt.para
                });
            }
        };
    }]);

hec.controller('WflDetailController', [
    '$scope',
    '$rootScope',
    '$state',
    '$stateParams',
    '$ionicPopup',
    '$ionicLoading',
    'WflHandleService',
    function ($scope, $rootScope, $state, $stateParams, $ionicPopup, $ionicLoading, WflHandleService) {

        $scope.$on("$stateChangeSuccess", function (event, toState, toParams, fromState, fromParam) {
            var title = $rootScope.newtitle;
            if (!title || title == "") {
                title = "未审批";
            }
            $rootScope.forceSetTitle(title);
        });

        $scope.config = {

            /*
             *
             *  UI 控制相关变量
             *
             */
            diableBtnDocInfo: true,
            diableBtnDocFlow: false,

            viewTitle: '',

            isTodo: false,
            isDone: false,
            isApply: false,

            workflowCategory: null,
            headerId: null,
            insId: null,
            insRcptId: null,
            funType: null, // String: todo | done | apply

            nodeActionType: null,
            /*{
             APPROVE: 'APPROVE',
             REJECT: 'REJECT',
             ADDHANDLER: 'ADDHANDLER',
             TRANSFER: 'TRANSFER',
             NOTIFY: 'NOTIFY'
             },*/


            approveDone: false,  // 单据是否已经审批结束

            detailInfoToFlowTimes: 0,
            detailFlowToInfoTimes: 0,
            detailInfoTimes: 0 // 防止 back 到 handle 界面

        };

        $scope.isExpReport = function () {
            return $scope.config.workflowCategory == 'EXP_REPORT';
        };
        $scope.isExpRequisition = function () {
            return $scope.config.workflowCategory == 'EXP_REQUISITION';
        };
        $scope.isPayRequisition = function () {
            return $scope.config.workflowCategory == 'PAYMENT_REQUISITION';
        };

        $scope.getDateDescStr = function (dateStr) { // 2015-11-30 12:04:05
            if (!isDateStr(dateStr)) {
                return dateStr;
            }
            ;
            var returnStr = '';
            var subStr = dateStr.substr(0, dateStr.lastIndexOf(':'));
            var yearStr = dateStr.substr(0, dateStr.indexOf('-'));
            if (isThisYear(yearStr)) {
                returnStr = dateStr.substr(dateStr.indexOf('-') + 1, 11);
            } else {
                returnStr = dateStr.substr(0, dateStr.lastIndexOf(' '));
            }
            ;
            //console.log(returnStr);
            return returnStr;
            function isThisYear(year) {
                return new Date().getFullYear() == year ? true : false;
            };
            function isDateStr(str) {
                //console.log(str);
                if (!str) {
                    return false;
                }
                ;
                var match = str.match(/[1-9][0-9]{3}-[0-9]{1,2}-[0-9]{1,2} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}/);
                return !!match ? true : false;
            };
        };

        $scope.datas = {
            header: {
                exp_rep_hd_id: null,
                exp_rep_num: '暂无',
                exp_rep_type_desc: '',
                exp_rep_date: null,  // 报销日期
                exp_rep_com_name: '', // 报销单头公司
                exp_rep_created_by: '',   // 提单人==制单人
                exp_rep_emp_name: '',     // 报销人
                exp_rep_pos_name: '',     // 报销人岗位
                exp_rep_currency_name: '', // 币种
                exp_rep_total_amount: null, // 总金额
                exp_rep_desc: ''            // 单据头描述
            },
            lines: [
                {
                    exp_rep_line_resp_name: '暂无',      // 报销单行责任中心名称
                    exp_rep_line_exp_item_name: '暂无',  // 报销单行费用项目名称
                    exp_rep_line_amount: 0
                }
            ],
            /*
             approve_action_title: "同意"
             approve_comment: "同意"
             approve_date: "2015-10-12"
             approve_date_format: "10月12日"
             approve_emp_name: "王可"
             approve_user_id: 1201
             */
            approveHt: [
                /*{
                 'detailDesc': '张三  于  2015-09-20 同意',
                 'comment': '同意报销',
                 'exp_emp_id': 201
                 },
                 {
                 'detailDesc': '张三  于  2015-09-20 同意',
                 'comment': '同意报销',
                 'user_id': 8321
                 },
                 {
                 'detailDesc': '张三  于  2015-09-20 同意',
                 'comment': '同意报销',
                 'user_id': 7209
                 },
                 {
                 'detailDesc': '张三  于  2015-09-20 同意',
                 'comment': '同意报销'
                 },
                 {
                 'detailDesc': '张三  于  2015-09-20 同意',
                 'comment': '同意报销'
                 }*/
            ],
            approveFlowsOld: [],
            approveFlows: [
                /*{
                 ins_id: "3846",
                 ins_preview_ins_status: "APPROVED",
                 node_approve_type: "全部审批",
                 node_id: "1",
                 node_name: "部门经理",
                 node_seq: "10",
                 node_status_desc: "已审批",
                 nodeApprovers: [
                 {
                 approve_action: "同意",
                 approve_opinion: '',
                 approve_date: "2015-10-21 13:37:29",
                 approve_emp_id: "4",
                 approve_emp_name: "谢志军",
                 }
                 ]
                 }*/
            ],
            docCreatedBy: null,
            pmtplan: [
                /*{
                 exp_rep_due_amount: "777"
                 exp_rep_payee_partner_name: "刘静"
                 exp_rep_write_off_amount: "0"
                 }*/
            ]
        };


        $scope.goDocInfoView = function () {
            $scope.config.diableBtnDocInfo = true;
            $scope.config.diableBtnDocFlow = false;
            //$state.go('wfl.detail.docinfo');
            $scope.$ionicGoBack();         //, relative: $state.$current
            /*$state.go('wfl.detail.docinfo',{
             detailFlowToInfoTimes: ++$scope.config.detailFlowToInfoTimes
             }, {
             location: 'replace'
             });*/
            //$scope.publicFuns.goBack(null, $scope);
            //$state.go('wfl.detail.docinfo', {},{location:'replace'});
        };

        $scope.goDocFlowView = function () {
            $scope.config.diableBtnDocInfo = false;
            $scope.config.diableBtnDocFlow = true;
            $state.go('wfl.detail.docflow', {
                ins_id: $scope.config.insId,
                detailInfoToFlowTimes: ++$scope.config.detailInfoToFlowTimes
            }, {
                location: 'replace'
            });
        };

        $scope.goUserDetailPage = function (userId, empId) {
            var param = {};
            if (userId) {
                param.user_id = userId;
            }
            if (empId) {
                param.exp_emp_id = empId;
            }
            $state.go('user.info', param);
        };

        $scope.showOpinionPopup = function (type) {
            var templateStr = '<textarea type="text" style="padding:5px;" placeholder="请填写审批意见" ng-model="config.alertComment" rows="6" >';
            if (type == 'reject') {
                $scope.config.commitType2 = 'REJECT';
                templateStr = '<textarea class="reject-textarea-comment" type="text" style="padding:5px;" placeholder="请填写拒绝原因(必填)" ng-model="config.alertComment" rows="6" >';
            } else if (type == 'nod') {
                $scope.config.commitType2 = 'APPROVE';
                templateStr = '<textarea class="approve-textarea-comment" type="text" style="padding:5px;" placeholder="请填写审批意见" ng-model="config.alertComment" rows="6" >';
            } else {
                throw("ListModule.js 代码异常");
            }
            ;
            var newArray = [],
                insidNodeidArray = [];

            $scope.data = {}
            var myPopup = $scope.myPopup = $ionicPopup.show({
                template: templateStr,
                title: '审批意见',
                scope: $scope,
                buttons: [{
                    text: '取消'
                }, {
                    text: '<b>提交</b>',
                    type: 'button-positive',
                    onTap: function (e) {
                        if (type == 'reject') {
                            if (!$scope.config.alertComment || $scope.config.alertComment == '') {
                                //$scope.g_busy.hide();
                                $scope.myPopup.close();
                                var alertPop = $ionicPopup.alert({
                                    title: '提示',
                                    template: '拒绝意见不能为空'
                                });
                                alertPop.then(function () {
                                    var ele = document.getElementsByClassName("popup-showing");
                                    if (ele) {
                                        ele = angular.element(ele);
                                        ele.remove();
                                    }
                                    ;
                                });
                                return;
                            }
                            ;
                        }
                        ;

                        var paraObj = [];
                        paraObj.push({
                            comment: $scope.config.alertComment,
                            action_type: $scope.config.commitType2,
                            rcpt_id: $scope.config.insRcptId
                        });

                        __showLoading();

                        WflHandleService.approve(paraObj).
                            then(function (resp) {
                                __hideLoading();
                                if (resp.status == '200') {
                                    $scope.publicConfig.handleOk = true;
                                    var alertSuccess = $ionicPopup.alert({
                                        title: '提示',
                                        template: '处理成功!'
                                    });
                                    alertSuccess.then(function () {
                                        $scope.publicFuns.goBack(null, $scope);
                                    });
                                } else {
                                    //
                                }
                                ;
                            }, function (resp) {
                                __hideLoading();
                            });
                    }
                },]
            });
        };

        function __showLoading(tip) {
            var tipText = tip ? tip : '处理中...';
            $ionicLoading.show({
                template: '<div class="handle-loading-tip"><span>' + tipText + '</span></div>'
            });
        };

        function __hideLoading() {
            $ionicLoading.hide();
        };

    }]);

hec.controller('DocInfoController', [
    '$scope',
    '$state',
    '$stateParams',
    '$ionicPopup',
    '$ionicLoading',
    'HecDefaults',
    'HecService',
    'WflDetailService',
    'UserInfoService',
    function ($scope, $state, $stateParams, $ionicPopup, $ionicLoading, hecDefaults, hecS, wflDetailS, userInfoS) {


        $scope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParam) {
            if (toState && fromState && fromState.name && toState.name) {
                if (fromState.name == "wfl.handle" && toState.name == "wfl.detail.docinfo") {
                    var needRefresh = $scope.publicConfig.handleOk;
                    if (needRefresh) {
                        //$scope.$ionicGoBack();
                        $scope.publicFuns.goBack(null, $scope);
                    }
                    ;
                }
                ;
            }
            ;
        });


        function __getStr(str, nullValue) {
            var replaceStr = nullValue ? nullValue : '暂无';
            return str ? str : replaceStr;
        }

        $scope.hidePartOfAllButtons = function ($event) {
            if (!$event) {
                return;
            }
            var $target = angular.element($event.target);
            var attrs = $target[0].attributes;
            for (var i = (attrs.length - 1); i >= 0; i--) {
                var attr = attrs[i];
                if ((attr.name == "cound-switch")) {
                    $scope.config.showAllBottons = !$scope.config.showAllBottons;
                    return;
                }
                ;
            }
            $scope.config.showAllBottons = false;
        };

        /*
         *
         *  单据审批相关接口
         *
         */

        function __showLoading(tip) {
            var tipText = tip ? tip : '处理中...';
            $ionicLoading.show({
                template: '<div class="handle-loading-tip"><span>' + tipText + '</span></div>'
            });
        };

        function __hideLoading() {
            $ionicLoading.hide();
        };

        $scope.cancleInstance = function () {
            var cancleConfirm = $ionicPopup.confirm({
                title: '提示',
                template: '确定收回当前单据吗?',
                cancelText: '取消',
                okText: '确定'
            });

            cancleConfirm.then(function (resp) {
                if (resp) { // 确定
                    __cancleInstance();
                } else { // 取消
                }
            });
        };

        $scope.cancleInstanceDone = function () {
            var cancleConfirm = $ionicPopup.confirm({
                title: '提示',
                template: '确定收回当前单据吗?',
                cancelText: '取消',
                okText: '确定'
            });

            cancleConfirm.then(function (resp) {
                if (resp) { // 确定
                    __cancleInstanceDone();
                } else { // 取消
                }
            });
        };

        function __cancleInstance() {
            var header = $scope.datas.header;
            var canCancle = !!header.can_cancel && !!(header.can_cancel == 1 || header.can_cancel == '1');
            if (!canCancle) {
                $ionicPopup.alert({
                    title: '提示',
                    template: '该工作流类型无法收回!'
                });
            } else {
                __showLoading();
                wflDetailS
                    .cancelInstance({para: {instance_id: $scope.config.insId}})
                    .then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            var okAlert = $ionicPopup.alert({
                                title: '提示',
                                template: '收回成功!'
                            });
                            okAlert.then(function () {
                                $scope.publicConfig.handleOk = true;
                                //$scope.$ionicGoBack();
                                $scope.publicFuns.goBack(null, $scope);
                            });
                        } else {
                            __hideLoading();
                            $ionicPopup.alert({
                                title: '提示',
                                template: '收回失败!'
                            });
                        }
                        ;
                    });
            }
        };

        function __cancleInstanceDone() {
            //__showLoading();
            wflDetailS
                .cancelInstanceDone({para: {ins_id: $scope.config.insId, comment: ""}})
                .then(function (resp) {
                    //__hideLoading();
                    if (resp.response.success) {
                        var okAlert = $ionicPopup.alert({
                            title: '提示',
                            template: '收回成功!'
                        });
                        okAlert.then(function () {
                            $scope.publicConfig.handleOk = true;
                            //$scope.$ionicGoBack();
                            $scope.publicFuns.goBack(null, $scope);
                        });
                    } else {
                        //__hideLoading();
                        $ionicPopup.alert({
                            title: '提示',
                            template: '收回失败!'
                        });
                    }
                    ;
                });
        };

        $scope.goBatchApprove = function () {
            __batchHandle($scope.config.nodeActionType.APPROVE);
        };

        $scope.goBatchReject = function () {
            __batchHandle($scope.config.nodeActionType.REJECT);
        };

        $scope.goBatchTransfer = function () {
            void 0;
            __batchHandle($scope.config.nodeActionType.TRANSFER);
        };

        $scope.goBatchAddHandler = function () {
            __batchHandle($scope.config.nodeActionType.ADDHANDLER);
        };

        $scope.goBatchNotify = function () {
            __batchHandle($scope.config.nodeActionType.NOTIFY);
        };

        $scope.goAttachmentList = function () {
            $state.go('wfl.detail.attachment', {
                exp_rep_type_desc: $scope.datas.header.exp_rep_type_desc,
                exp_rep_hd_id: $scope.datas.header.exp_rep_hd_id
            });
        }

        function __batchHandle(nodeActionType) {
            var newArray = [], insidNodeidArray = [];
            newArray.push($scope.config.insRcptId);
            var idsStr = JSON.stringify(newArray);

            insidNodeidArray.push({
                insId: $scope.datas.header.ins_id,
                nodeId: $scope.datas.header.ins_node_id
            });

            $state.go('wfl.handle', {
                handleType: nodeActionType,
                ids: idsStr,
                insidNodeidArrayStr: JSON.stringify(insidNodeidArray),
                detailInfoTimes: ++$scope.config.detailInfoTimes
            });

        };

        /*
         *
         *  单据详情信息查询相关接口
         *
         */

        function __queryCreatdBy(empId, userId) {
            var para = {};
            if (empId) {
                para.exp_emp_id = empId;
            }
            if (userId) {
                para.user_id = userId;
            }
            userInfoS.queryUserInfo({para: para})
                .then(function (resp) {
                    if (resp.data) {
                        var user = $scope.$parent.datas.docCreatedBy = resp.data[0];
                        if (!user.exp_emp_weixin_avatar || user.exp_emp_weixin_avatar == '') {
                            $scope.$parent.datas.docCreatedBy.exp_emp_weixin_avatar = 'images/weixin/default_user_head.jpg';
                        }
                        ;
                        var comUnitPosStr = __getStr(user.exp_company_name) + '-' + __getStr(user.exp_unit_name) + '-' + __getStr(user.exp_position_name);
                        $scope.$parent.datas.docCreatedBy.comUnitPosStr = comUnitPosStr;
                    }
                }, function (resp) {

                });
        }

        function __queryDetailInfo(headerId, workflowCategory) {
            if (!headerId)
                return;
            var headerPara = {exp_rep_hd_id: headerId},
                linePara = {exp_rep_hd_id: headerId, exp_rep_category: workflowCategory},
                ptmplanPara = {exp_rep_hd_id: headerId};
            if ($scope.isExpReport()) {
                wflDetailS
                    .queryExpReportPmtplan({para: headerPara})
                    .then(function (resp) {
                        if (resp.data) {
                            $scope.$parent.datas.pmtplan = resp.data;
                        }
                        ;
                    });
            }
            ;
            wflDetailS
                .queryHeaderInfo({category: workflowCategory, para: headerPara})
                .then(function (resp) {
                    if (resp.data) {
                        var header = $scope.$parent.datas.header = resp.data[0];
                        //$scope.$parent.config.detailViewTitle = resp.data.exp_rep_type_desc;
                        __queryCreatdBy(null, header.exp_rep_created_by);
                    }
                    ;
                });
            wflDetailS
                .queryLineInfo({category: workflowCategory, para: linePara})
                .then(function (resp) {
                    if (resp.data && resp.data.length) {
                        $scope.$parent.datas.lines = resp.data;
                    }
                });
        }

        function __queryApproveRecord(insId) {
            wflDetailS
                .queryApproveRecord({para: {ins_id: insId}})
                .then(function (resp) {
                    if (resp.data && resp.data.length && resp.data.length > 0) {
                        for (var i = resp.data.length - 1; i >= 0; i--) {
                            var item = resp.data[i];
                            __handleApproveRecordData(resp.data);
                            resp.data[i].detailDesc = item.approve_emp_name + " 于 " + item.approve_date + " " + (item.approve_action_title || '');
                            resp.data[i].comment = item.approve_comment;
                            resp.data[i].user_id = item.approve_user_id;
                        }
                        ;
                        $scope.$parent.datas.approveHt = resp.data;
                    }
                });
        };
        function __handleApproveRecordData(datas) {
            if (!datas || datas.length == 0) {
                return;
            }
            ;
            for (var i = 0; i < datas.length; i++) {
                var j = datas[i].approve_emp_name.indexOf('通知');
                if (j > 0) {
                    datas[i].approve_action_title = datas[i].approve_emp_name.slice(j);
                    datas[i].approve_emp_name = datas[i].approve_emp_name.slice(0, j);
                }
                ;
            }
            ;
        };

        var __init = function () {


            $scope.datas.approveFlowsOld = [];
            $scope.datas.approveFlows = [];
            $scope.datas.pmtplan = [];
            $scope.datas.docCreatedBy = [];
            $scope.datas.approveHt = [];
            $scope.datas.header = {};
            $scope.datas.lines = [];

            $scope.config.nodeActionType = hecDefaults.handleTypes;

            var headerId = $stateParams.ins_doc_hd_id,
                workflowCategory = $stateParams.ins_doc_category,
                insId = $stateParams.ins_id,
                insRcptId = $stateParams.ins_rcpt_id,
                funType = $stateParams.fun_type;

            $scope.config.workflowCategory = workflowCategory;
            $scope.config.viewTitle = hecS.getCategoryDesc(workflowCategory);
            $scope.config.headerId = headerId;
            $scope.config.insId = insId;
            $scope.config.insRcptId = insRcptId;
            $scope.config.funType = funType;

            $scope.config.isTodo = false;
            $scope.config.isDone = false;
            $scope.config.isApply = false;
            switch (funType) {
                case 'todo':
                    $scope.config.isTodo = true;
                    $scope.config.viewTitle = '未审批';
                    break;
                case 'done':
                    $scope.config.isDone = true;
                    $scope.config.viewTitle = '已审批';
                    break;
                case 'apply':
                    $scope.config.isApply = true;
                    $scope.config.viewTitle = '我的申请';
                    break;
            }
            ;

            if (headerId) {
                __queryDetailInfo(headerId, workflowCategory);
            }
            if (insId) {
                __queryApproveRecord(insId);
            }
        };

        __init();

    }]);


hec.controller('WflDocFlowController', [
    '$scope',
    'WflDetailService',
    '$stateParams',
    function ($scope, wflDetailS, $stateParams) {

        // $scope.datas.approveFlowsOld
        // $scope.datas.approveFlows
        function __initFlowsDatas() {
            var datas = $scope.datas.approveFlowsOld;
            $scope.datas.approveFlows = [];
            for (var i = 0; i < datas.length; i++) {
                if (datas[i].br_used) {
                    continue;
                }
                ;
                var node = {
                    ins_id: datas[i].ins_id,
                    node_id: datas[i].node_id,
                    node_seq: datas[i].node_seq,
                    node_approve_type: datas[i].node_approve_type,
                    node_name: datas[i].node_name,
                    ins_preview_ins_status: datas[i].ins_preview_ins_status,
                    node_status_desc: __getStatusDesc(datas[i].ins_preview_ins_status),
                    nodeApprovers: [],
                    isApproved: datas[i].ins_preview_ins_status == 'APPROVED' ? true : false,
                    isCurrent: datas[i].ins_preview_ins_status == 'CURRENT' ? true : false,
                    isWaiting: datas[i].ins_preview_ins_status == 'WAITING' ? true : false
                };
                var nodeApprove = __getNodeApprove(datas[i]);
                node.nodeApprovers.push(nodeApprove);
                for (var j = i + 1; j < datas.length; j++) {
                    if (datas[j].br_used) {
                        continue;
                    }
                    ;
                    if (node.node_seq == datas[j].node_seq) {
                        datas[j].br_used = true;
                        if (datas[j].ins_preview_ins_status == 'CURRENT') {
                            node.isApproved = false;
                            node.isCurrent = true;
                        }
                        ;
                        node.nodeApprovers.push(__getNodeApprove(datas[j]));
                    }
                    ;
                }
                ;
                $scope.datas.approveFlows.push(node);
            }
            ;
            var tempJ;
            for (var j = 0; j < $scope.datas.approveFlows.length; j++) {
                var data = $scope.datas.approveFlows[j];
                if (data.isCurrent) {
                    var items = data.nodeApprovers;
                    var approvedItems = [];
                    var watingItems = [];
                    for (var n = 0; n < items.length; n++) {
                        if (items[n].approve_action && items[n].approve_date) {
                            approvedItems.push(angular.copy(items[n]));
                        } else {
                            watingItems.push(angular.copy(items[n]));
                        }
                        ;
                    }
                    ;
                    if (approvedItems.length > 0) {
                        var approvedCopyData = angular.copy(data);
                        approvedCopyData.isApproved = true;
                        approvedCopyData.isCurrent = false;
                        approvedCopyData.node_status_desc = __getStatusDesc('APPROVED');
                        approvedCopyData.nodeApprovers = approvedItems;
                        var currentCopyData = angular.copy(data);
                        currentCopyData.isApproved = false;
                        currentCopyData.isCurrent = true;
                        currentCopyData.node_status_desc = __getStatusDesc('CURRENT');
                        currentCopyData.nodeApprovers = watingItems;
                        var before = angular.copy($scope.datas.approveFlows.slice(0, j));
                        var after = angular.copy($scope.datas.approveFlows.slice(j + 1));
                        $scope.datas.approveFlows = [];
                        $scope.datas.approveFlows = $scope.datas.approveFlows.concat(before);
                        $scope.datas.approveFlows.push(approvedCopyData);
                        $scope.datas.approveFlows.push(currentCopyData);
                        $scope.datas.approveFlows = $scope.datas.approveFlows.concat(after);
                    }
                    ;
                    break;
                }
                ;
                tempJ = j;
            }
            ;
        };

        function __getNodeApprove(nodeapprove) {
            return {
                approve_action: nodeapprove.approve_action,
                approve_date: nodeapprove.approve_date,
                approve_emp_id: nodeapprove.approve_emp_id,
                approve_emp_name: nodeapprove.approve_emp_name,
                approve_opinion: nodeapprove.approve_opinion
            };
        };

        // APPROVED,CURRENT,WAITING
        function __getStatusDesc(status) {
            var desc = '';
            switch (status) {
                case 'APPROVED':
                    desc = "已审批";
                    break;
                case 'CURRENT':
                    desc = "审批中";
                    break;
                case 'WAITING':
                    desc = "待审批";
                    break;
            }
            ;
            return desc;
        };

        function __getWorkflowPreview(ins_id) {
            $scope.config.loaindFlowNode = true;
            wflDetailS
                .initDocFlowPreview({para: [{ins_id: ins_id, _status: 'execute'}]})
                .then(function (resp) {
                    if (resp.response.success) {
                        __queryWorkflowPreview(ins_id);
                    }
                });
        };

        function __queryWorkflowPreview(ins_id) {
            wflDetailS
                .queryDocFlowPreview({para: {ins_id: ins_id}})
                .then(function (resp) {
                    if (resp.data) {
                        $scope.datas.approveFlowsOld = resp.data;
                        __initFlowsDatas();
                        $scope.config.loaindFlowNode = false;
                        $scope.datas.approveFlowsOld = [];
                    }
                });
        };


        function __init() {
            //var ins_id = $scope.config.insId;
            var ins_id = $stateParams.ins_id;
            __getWorkflowPreview(ins_id);
        };

        __init();

    }]);


hec.controller('WflDocAttachmentController', [
    '$scope',
    'HecService',
    'WflDetailService',
    '$stateParams',
    '$ionicPopup',
    function ($scope, HecService, wflDetailS, $stateParams, $ionicPopup) {

        $scope.datas.attachments = [];

        function __initAttachmentsDatas(option) {
            wflDetailS
                .queryAttachments(option)
                .then(function (resp) {
                    $scope.datas.attachments = resp.data;
                });
        };

        $scope.atmDownload = function (item) {
            var showConfirm = $ionicPopup.confirm({
                title: '提示',
                template: '是否下载此附件查看?',
                cancelText: '取消',
                okText: '确定'
            });
            showConfirm.then(function (resp) {
                if (resp) {
                    var url = HecService.getUrl('atm_download');
                    window.location.href = url + '?attachment_id=' + item.attachment_id;
                }
            });
        }

        function __init() {
            var opt = {
                para: {
                    exp_rep_type_desc: $stateParams.exp_rep_type_desc,
                    exp_rep_hd_id: $stateParams.exp_rep_hd_id
                }
            }
            __initAttachmentsDatas(opt);
        };

        __init();

    }]);



hec.service('WflListTododoneService', [
    'HecService',
    '$AuHttp',
    'HecDefaults',
    function (hecS, auHttp, hecDefaults) { 

        return {
            queryListData: queryListData
        };
        function queryListData(options) {
            var opt = options || {};
            return auHttp.request({
                url: hecS.getUrl(opt.query_url_name) + '?' + hecS.getParamsUrl(opt),
                para: opt.para
            });
        };

    }
]);

hec.controller('WflListAbsoluteCtrl', ['$scope', function ($scope) {

    $scope.absConfig = {
        viewTitle: ''
    };

}]);

hec.controller('WflListTododoneCtrl', [
    '$scope',
    '$rootScope',
    '$state',
    '$stateParams',
    '$timeout',
    '$ionicPopup',
    '$ionicLoading',
    '$ionicScrollDelegate',
    '$ionicNavBarDelegate',
    'HecDefaults',
    'HecService',
    'WflListTododoneService',
    'WflHandleService',
    function ($scope, $rootScope, $state, $stateParams, $timeout, $ionicPopup, $ionicLoading, $ionicScrollDelegate, $ionicNavBarDelegate, hecDefaults, hecS, wflListTododoneS, WflHandleService) {

        $scope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParam) {
            if (toState && fromState && fromState.name && toState.name) {
                if (toState.name == "home.main" && fromState.name == "wfl.list.apply") {
                    $scope.__clearListItemsElementInner();
                    $scope.config.listData = [];
                }
            }
        });

        $scope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParam) {
            if (toState && fromState && fromState.name && toState.name) {

                if (fromState.name == "wfl.category.done" || fromState.name == "wfl.category.todo" || fromState.name == "home.main") {
                    $scope.initParams();
                    if (fromState.name == "wfl.category.todo") {
                        setTodoDoneApply(true, false, false);
                        //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-todo');
                    }
                    ;
                    if (fromState.name == "wfl.category.done") {
                        setTodoDoneApply(false, true, false);
                        //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-done');
                    }
                    ;
                    if (fromState.name == "home.main") {
                        setTodoDoneApply(false, false, true);
                        $scope.config.query_url_name = 'myapply_query_all';
                        $scope.config.viewTitle = "我的申请";
                        //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-apply');
                    }
                    ;
                    void 0;
                    $scope.reloadData();
                }
                ;
                if (fromState.name == "wfl.detail.docinfo" || fromState.name == "wfl.handle") {
                    var needRefresh = $scope.publicConfig.handleOk;
                    //alert(needRefresh);
                    if (needRefresh) {
                        $scope.unSelectAll();
                        $scope.reloadData();
                        delete $scope.publicConfig.handleOk;
                    }
                    ;
                }
                ;
                if (fromState.name == "wfl.approve") {

                }
                ;
                if (toState.name == "wfl.category.done" || toState.name == "wfl.category.todo" || toState.name == "home.main") {
                    // $scope.unSelectAll();
                    $scope.config.selectNum = 0;
                    $rootScope.rootConfig.selectCount = 0;
                    $scope.unSelectAll();
                    delete $scope.config.checkboxs;
                    $ionicScrollDelegate.scrollTop();
                }
                ;

            }
            ;
        });

        
        
        function setTodoDoneApply(todo, done, apply) {
            $scope.config.isTodo = todo;
            $scope.config.isDone = done;
            $scope.config.isApply = apply;
            $rootScope.newtitle = todo ? "未审批" : ( done ? "已审批" : "我的申请" );
        };

        $scope.hidePartOfAllButtons = function ($event) {
            if (!$event) {
                return;
            }
            var $target = angular.element($event.target);
            var attrs = $target[0].attributes;
            for (var i = (attrs.length - 1); i >= 0; i--) {
                var attr = attrs[i];
                if ((attr.name == "cound-switch")) {
                    $scope.config.showAllBottons = !$scope.config.showAllBottons;
                    return;
                }
                ;
            }
            $scope.config.showAllBottons = false;
        };

        $scope.onlyConfig = {
            showSideRight: true
        };

        $rootScope.rootConfig = {
            selectCount: 0,
            can_back_to_pre_node_flag: null
        };

        $scope.config = {
            isListPage: true,
            // 区分  待办事项  与  已办事项
            isTodo: false,
            isDone: false,
            isApply: false,

            /* 单据类型代码, 目前有以下几种 ：
             *  ALL                 全部类型
             *  PAYMENT_REQUISITION 借款申请
             *  EXP_REQUISITION     费用申请
             *  EXP_REPORT          费用报销
             */
            category: null,
            query_url_name: null,

            viewTitle: '',
            categoryDesc: '',
            queryStr: '',


            // data page refresh loadMore 相关属性
            /*
             * 每页个数，赋值后不再修改
             */
            pagesize: hecDefaults.postOptions.pagesize,
            /*
             * 总页数，只在 $scope.reloadData() 成功返回后设置
             */
            totalCount: null,
            totalPage: null,
            listData: [],
            lastLoadPage: 0, // 当前最后一次请求的 pagenum 参数值
            hasNextPage: true, // 标志是否还有下一页
            noListDataTip: '暂无数据!',
            /*
             *
             *  界面加载、刷新相关
             *
             */
            refresherText: '下拉刷新',
            isLoadingMore: false,
            isReloading: false,
            isFirstReloading: 'true',
            //reloadedOk: false, // 界面数据加载成功(第一次加载)标志。。


            nodeActionType: null,
            /*{
             APPROVE: 'APPROVE',
             REJECT: 'REJECT',
             ADDHANDLER: 'ADDHANDLER',
             TRANSFER: 'TRANSFER',
             NOTIFY: 'NOTIFY'
             },*/

            // just  for test


            // 用户模式相关
            uiMode: null,
            showSelectAllButton: false,

            showAllBottons: false,

            /*
             *
             *  单据选择相关
             *
             */
            isSelectAll: false,
            selectNum: 0,


            listTimes: 0,
            listForDetailTimes: 0
        };

        var __userInterfaceMode = {
            SCAN: 'SCAN',
            SEARCH: 'SEARCH',
            SELECT: 'SELECT'
        };


        $scope.getCurrentPageNum = function (index) {
            var i = index + 1;
            return Math.ceil(i / $scope.config.pagesize);
        };


        /*
         *
         *  列表加载、刷新相关
         *
         */

        $scope.reloadData = function () {
            //alert("reloadData:     "+$scope.isSearchMode()+"     "+$scope.isSelectMode()+"     "+$scope.config.selectNum);
            if ($scope.isSearchMode() || $scope.isSelectMode() || $scope.config.selectNum > 0) {
                $scope.$broadcast('scroll.refreshComplete');
                return;
            }

            delete $scope.config.checkboxs;
            $scope.config.isReloading = true;
            delete $scope.config.listData;
            $scope.__clearListItemsElementInner();
            $scope.config.listData = [];

            $scope.config.totalPage = null;
            $scope.lastLoadPage = 0;
            $scope.hasNextPage = true;

            $scope.__checkQueryUrlName();

            wflListTododoneS.queryListData({
                pagesize: $scope.config.pagesize,
                query_url_name: $scope.config.query_url_name,
                pagenum: 1,
                para: {
                    fuzzy_query: $scope.config.queryStr
                }
            }).then(function (resp) {
                if (resp.data) {
                    $scope.config.totalPage = Math.ceil(resp.response.result.totalCount / $scope.config.pagesize);
                    if ($scope.config.totalPage <= 1) {
                        $scope.hasNextPage = false;
                    }
                    ;
                    $scope.config.lastLoadPage = 1;
                    __handleListData(resp.data, true);
                    $scope.config.listData = resp.data;
                    $scope.config.totalCount = resp.response.result.totalCount;
                    __checkHasMoreData(resp.response.result.totalCount);
                    //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected');
                } else {
                    $scope.hasNextPage = false;
                    $scope.config.lastLoadPage = 1;
                    $scope.config.listData = [];
                    $scope.config.totalCount = 0;
                    __checkHasMoreData(0);
                }
                $scope.$broadcast('scroll.refreshComplete');
                $scope.config.isReloading = false;
                $scope.config.isFirstReloading = false;
            }, function (resp) {
                $scope.config.isReloading = false;
                $scope.$broadcast('scroll.refreshComplete');
            });
        };

        $scope.__checkQueryUrlName = function () {
            if (!$scope.config.query_url_name || $scope.config.query_url_name == '') {

                //debugger;
                $scope.config.query_url_name = $rootScope.list_query_url_name;

                throw("ListModule_111.js代码逻辑错误 ---  $scope.config.query_url_name: " + $scope.config.query_url_name);
            }
            ;
        };

        $scope.config.lastDay;

        function __handleListData(items, isReload) {
            if (isReload) {
                delete $scope.config.lastDay;
            }
            ;
            for (var i = 0; i < items.length; i++) {
                if (!$scope.config.lastDay) {
                    $scope.config.lastDay = items[i].ins_sub_date_day;
                    if (isReload) {
                        items[i].showSubDate = true;
                        if (i) {
                            items[i - 1].showSubDatePre = true;
                        }
                    }
                    ;
                } else {
                    if (!__isEnqualDate(items[i].ins_sub_date_day, $scope.config.lastDay)) {
                        $scope.config.lastDay = items[i].ins_sub_date_day;
                        items[i].showSubDate = true;
                        if (i) {
                            items[i - 1].showSubDatePre = true;
                        }
                    }
                }
            }
        };

        function __isEnqualDate(newDate, oldDate) {
            var t1 = new Date(newDate),
                t2 = new Date(oldDate);
            if (Date.parse(t1) - Date.parse(t2) == 0) {
                return true;
            }
            ;
            return false;
        };

        function __checkHasMoreData(totalCount) {
            if ($scope.config.listData.length >= totalCount) {
                $scope.config.hasNextPage = false;
            } else {
                $scope.config.hasNextPage = true;
            }
            ;
        };

        $scope.searchInputOnKeyup = function (e) {
            var keycode = window.event ? e.keyCode : e.which;
            if (keycode == 13) {
                $scope.reloadData();
                return true;
            }
            return false;
        };

        $scope.loadMoreData = function () {
            if ($scope.isSearchMode() || $scope.isSelectMode() || $scope.config.selectNum > 0) {
                return;
            }
            ;

            $scope.config.isLoadingMore = true;

            var pagenum = $scope.config.lastLoadPage + 1;
            if (!$scope.config.hasNextPage || pagenum > $scope.config.totalPage) {
                $scope.$broadcast('scroll.infiniteScrollComplete');
                return;
            }

            $scope.__checkQueryUrlName();

            wflListTododoneS.queryListData({
                pagesize: $scope.config.pagesize,
                query_url_name: $scope.config.query_url_name,
                pagenum: pagenum,
                para: {
                    fuzzy_query: $scope.config.queryStr
                }
            }).then(function (resp) {
                if (resp.data) {
                    $scope.config.lastLoadPage = pagenum;
                    $scope.config.hasNextPage = (pagenum >= $scope.config.totalPage) ? false : true;
                    __handleListData(resp.data, false);
                    $scope.config.listData = $scope.config.listData.concat(resp.data);
                    __checkHasMoreData(resp.response.result.totalCount);
                }
                $scope.config.isLoadingMore = false;
                $scope.$broadcast('scroll.infiniteScrollComplete');
            }, function (resp) {
                $scope.config.isLoadingMore = false;
                $scope.$broadcast('scroll.infiniteScrollComplete');
            });
        };


        /*
         *
         *	用户接口UI模式相关
         *
         */

        $scope.isScanMode = function () {
            return $scope.config.uiMode == __userInterfaceMode.SCAN;
        };

        $scope.isSelectMode = function () {
            return $scope.config.uiMode == __userInterfaceMode.SELECT;
        };

        $scope.isSearchMode = function () {
            return $scope.config.uiMode == __userInterfaceMode.SEARCH;
        };

        function __enterScanMode() {
            $scope.config.showSelectAllButton = false;
            $scope.config.isSelectAll = false;
            $scope.config.selectNum = 0;
            $rootScope.rootConfig.selectCount = 0;
            $scope.config.uiMode = __userInterfaceMode.SCAN;
        };

        function __enterSelectMode() {
            $scope.config.uiMode = __userInterfaceMode.SELECT;
        };

        function __enterSearchMode() {
            $scope.config.uiMode = __userInterfaceMode.SEARCH;
        };


        /*
         *
         *	单据选择相关
         *
         */

        $scope.__fillConfigCheckbox = function () {
            if ($scope.config.isTodo) {
                //var ele = document.getElementById('br-wfl-todo-list');
                var ele = document.getElementsByClassName('br-wfl-todo-list-yd-only-one');
                if (ele) {
                    $scope.config.checkboxs = ele[ele.length - 1].getElementsByClassName('listdata-item-selected-todo');
                }
                ;
                //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-todo');
            } else if ($scope.config.isDone) {
                var ele = document.getElementsByClassName('br-wfl-done-list-yd-only-one');
                if (ele) {
                    $scope.config.checkboxs = ele[ele.length - 1].getElementsByClassName('listdata-item-selected-done');
                }
                ;
                //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-done');
            } else if ($scope.config.isApply) {
                $scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-apply');
            } else {
                $scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-todo');
                if ($scope.config.checkboxs.length == 0) {
                    $scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-done');
                    if ($scope.config.checkboxs.length == 0) {
                        $scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected-apply');
                        if ($scope.config.checkboxs.length == 0) {
                            throw("ListModule_111.js 代码逻辑错误  ---  $scope.__fillConfigCheckbox()...");
                        }
                        ;
                    }
                    ;
                }
                ;

            }
            ;
        };

        $scope.selectItem = function ($index) {
            if (!$scope.config.checkboxs) {
                $scope.__fillConfigCheckbox();
                //$scope.config.checkboxs = document.getElementsByClassName('listdata-item-selected');
            }
            ;
            // $scope.config.showSelectAllButton = true;
            //if ($scope.config.isDone && $scope.config.listData[$index].ins_doc_status != 1) {
            //    $scope.config.checkboxs[$index].checked = false;
            //    $ionicPopup.alert({
            //        title: '提示',
            //        template: '通知操作只支持运行中单据!'
            //    });
            //    return;
            //}
            //;
            if (!$scope.config.checkboxs[$index].checked) {
                $scope.config.isSelectAll = false;
                $scope.config.selectNum--;
                $rootScope.rootConfig.selectCount--;
                // 判断是否全不选
                if ($scope.config.selectNum <= 0) {
                    __enterScanMode();
                }
                ;
            } else {
                $scope.config.selectNum++;
                $rootScope.rootConfig.selectCount++;
                // 判断是否全选
                if ($scope.config.selectNum == $scope.config.listData.length) {
                    $scope.config.isSelectAll = true;
                    $scope.config.showSelectAllButton = false;
                }
                ;
                __enterSelectMode();
            }
            ;
            //$scope.config.checkboxs[$index].checked = !$scope.config.checkboxs[$index].checked;
        };

        $scope.selectAll = function () {
            $scope.config.showSelectAllButton = false;
            __enterSelectMode();

            /*for(var i = 0; i < $scope.config.listData.length; i++){
             $scope.config.listData[i].selected = true;
             };*/
            $scope.config.selectNum = 0;
            $rootScope.rootConfig.selectCount = 0;
            for (var i = 0; i < $scope.config.checkboxs.length; i++) {
                if ($scope.config.isDone) {
                    if ($scope.config.listData[i].ins_doc_status == 1) {
                        $scope.config.checkboxs[i].checked = true;
                        $scope.config.selectNum++;
                        $rootScope.rootConfig.selectCount++;
                    }
                    ;
                } else {
                    $scope.config.checkboxs[i].checked = true;
                    $scope.config.selectNum++;
                    $rootScope.rootConfig.selectCount++;
                }
                ;
            }
            ;

            $scope.config.isSelectAll = true;
            //$scope.config.selectNum = $scope.config.listData.length;

        };

        $scope.unSelectAll = function () {

            // $scope.config.showSelectAllButton = false;
            __enterScanMode();
            if (!$scope.config.checkboxs) {
                return;
            }
            ;
            for (var i = 0; i < $scope.config.checkboxs.length; i++) {
                $scope.config.checkboxs[i].checked = false;
            }
            ;
            /*for(var i = 0; i < $scope.config.listData.length; i++){
             $scope.config.listData[i].selected = false;
             }*/

        };

        $scope.clickNumberButton = function () {
            $scope.config.showSelectAllButton = true;
        };

        /*
         *
         *  跳转明细界面
         *
         */

        $scope.goDetailPage = function (item) {
            // {exp_rep_category}/{exp_rep_hd_id}/{ins_id}/{funType}/{ins_rcpt_id}
            void 0;
            void 0;
            var fun_type;
            if ($scope.config.isTodo) {
                void 0;
                fun_type = 'todo';
            } else if ($scope.config.isDone) {
                void 0;
                fun_type = 'done';
            } else if ($scope.config.isApply) {
                void 0;
                fun_type = 'apply';
            }
            $rootScope.rootConfig.can_back_to_pre_node_flag = item.can_back_to_pre_node_flag;
            $state.go('wfl.detail.docinfo', {
                ins_doc_category: item.ins_doc_category,
                ins_doc_hd_id: item.ins_param,
                ins_id: item.ins_id,
                ins_rcpt_id: item.ins_rcpt_id,
                fun_type: fun_type,
                listForDetailTimes: ++$scope.config.listForDetailTimes
            });
        };

        /*
         *
         *  批量审批相关
         *
         */


        $scope.goBatchApprove = function () {
            __batchHandle($scope.config.nodeActionType.APPROVE);
        };

        $scope.goBatchReject = function () {
            __batchHandle($scope.config.nodeActionType.REJECT);
        };

        $scope.goBatchTransfer = function () {
            void 0;
            __batchHandle($scope.config.nodeActionType.TRANSFER);
        };

        $scope.goBatchNotify = function () {
            __batchHandle($scope.config.nodeActionType.NOTIFY);
        };

        $scope.goBatchAddHandler = function () {
            __batchHandle($scope.config.nodeActionType.ADDHANDLER);
        };

        $scope.showOpinionPopup = function (type) {
            void 0;
            var templateStr = '<textarea type="text" style="padding:5px;" placeholder="请填写审批意见" ng-model="config.alertComment" rows="6" >';
            if (type == 'reject') {
                $scope.config.commitType2 = 'REJECT';
                templateStr = '<textarea class="reject-textarea-comment" type="text" style="padding:5px;" placeholder="请填写拒绝原因(必填)" ng-model="config.alertComment" rows="6" >';
            } else if (type == 'nod') {
                $scope.config.commitType2 = 'APPROVE';
                templateStr = '<textarea class="approve-textarea-comment" type="text" style="padding:5px;" placeholder="请填写审批意见" ng-model="config.alertComment" rows="6" >';
            } else {
                throw("ListModule.js 代码异常");
            }
            ;
            var newArray = [],
                insidNodeidArray = [];
            if (!$scope.config.checkboxs) {
                $ionicPopup.alert({
                    title: '提示',
                    template: '请至少选择一个单据!'
                });
                return;
            }
            ;
            for (var i = 0; i < $scope.config.listData.length; i++) {
                if ($scope.config.checkboxs[i].checked) {
                    var item = $scope.config.listData[i];
                    newArray.push(item.ins_rcpt_id);
                    insidNodeidArray.push({
                        insId: item.ins_id,
                        nodeId: item.ins_node_id
                    });
                }
                ;
            }
            ;
            if (newArray.length == 0) {
                $ionicPopup.alert({
                    title: '提示',
                    template: '请至少选择一个单据!'
                });
                return;
            }
            ;


            $scope.opinion = "";
            $scope.data = {}
            var myPopup = $scope.myPopup = $ionicPopup.show({
                template: templateStr,
                title: '审批意见',
                scope: $scope,
                buttons: [{
                    text: '取消'
                }, {
                    text: '<b>提交</b>',
                    type: 'button-positive',
                    onTap: function (e) {
                        /**
                         * approve：工作流审批接口 : 同意、拒绝
                         * 参数：数组
                         * action_type：审批类型
                         *              APPROVE    通过
                         *              REJECT      拒绝
                         * comment：审批意见
                         * rcpt_id：工作流待办接受者ID
                         */
                        if (type == 'reject') {
                            if (!$scope.config.alertComment || $scope.config.alertComment == '') {
                                //$scope.g_busy.hide();
                                $scope.myPopup.close();
                                var alertPop = $ionicPopup.alert({
                                    title: '提示',
                                    template: '拒绝意见不能为空'
                                });
                                alertPop.then(function () {
                                    var ele = document.getElementsByClassName("popup-showing");
                                    if (ele) {
                                        ele = angular.element(ele);
                                        ele.remove();
                                    }
                                    ;
                                });
                                return;
                            }
                            ;
                        }
                        ;

                        var paraObj = [];
                        for (var i = newArray.length - 1; i >= 0; i--) {
                            paraObj.push({
                                comment: $scope.config.alertComment,
                                action_type: $scope.config.commitType2,
                                rcpt_id: newArray[i]
                            });
                        }
                        ;
                        //
                        __showLoading();
                        WflHandleService.approve(paraObj).
                            then(function (resp) {
                                $scope.config.alertComment = '';
                                $scope.unSelectAll();
                                $scope.reloadData();
                                __hideLoading();
                                //if (resp.status == '200') {
                                //$scope.g_busy.hide();
                                //Toast.show("已审批");
                                //$rootScope.$broadcast("submitSuccess", x);
                                //$state.go('checkMain');
                                //} else{
                                //
                                //};
                            }, function (resp) {
                                $scope.config.alertComment = '';
                                __hideLoading();

                            });
                    }
                },]
            });
        };

        function __showLoading(tip) {
            var tipText = tip ? tip : '处理中...';
            $ionicLoading.show({
                template: '<div class="handle-loading-tip"><span>' + tipText + '</span></div>'
            });
        };

        function __hideLoading() {
            $ionicLoading.hide();
        };


        function __batchHandle(nodeActionType) {
            var newArray = [],
                insidNodeidArray = [];
            if (!$scope.config.checkboxs) {
                $ionicPopup.alert({
                    title: '提示',
                    template: '请至少选择一个单据!'
                });
                return;
            }
            ;
            for (var i = 0; i < $scope.config.listData.length; i++) {
                if ($scope.config.checkboxs[i].checked) {
                    //if($scope.config.nodeActionType == 'NOTIFY' && ){

                    //};
                    var item = $scope.config.listData[i];
                    newArray.push(item.ins_rcpt_id);
                    insidNodeidArray.push({
                        insId: item.ins_id,
                        nodeId: item.ins_node_id
                    });
                }
                ;
            }
            ;
            if (newArray.length == 0) {
                $ionicPopup.alert({
                    title: '提示',
                    template: '请至少选择一个单据!'
                });
                return;
            }
            ;
            var idsStr = JSON.stringify(newArray);
            var stateName;
            //          var data = {
            //               action_type：审批类型
            //       *              APPROVE    通过
            //       *              REJECT      拒绝
            //       * comment：审批意见
            //       * rcpt_id： newArray工 作流待办接受者ID
            //          }

            /*switch(nodeActionType){
             case $scope.config.nodeActionType.APPROVE:
             stateName = "wfl.handle.approve";
             break;
             case $scope.config.nodeActionType.REJECT:
             stateName = "";
             break;
             case $scope.config.nodeActionType.TRANSFER:
             stateName = "";
             break;
             case $scope.config.nodeActionType.ADDHANDLER:
             stateName = "";
             break;
             case $scope.config.nodeActionType.NOTIFY:
             stateName = "";
             break;
             };*/

            $state.go('wfl.handle', {
                handleType: nodeActionType,
                ids: idsStr,
                insidNodeidArrayStr: JSON.stringify(insidNodeidArray),
                listTimes: ++$scope.config.listTimes
            });

        };

        $scope.__clearListItemsElementInner = function () {
            void 0;
            var father = document.getElementById('br-wfl-done-list');
            if (father) {
                ele = father.getElementsByClassName('hec-item-inner');
                __removeEleIfExits(ele);
                var ele2 = father.getElementsByClassName('ins-doc-time');
                __removeEleIfExits(ele2);
            }
            ;
            father = document.getElementById('br-wfl-todo-list');
            if (father) {
                ele = father.getElementsByClassName('hec-item-inner');
                __removeEleIfExits(ele);
                var ele2 = father.getElementsByClassName('ins-doc-time');
                __removeEleIfExits(ele2);
            }
            ;
            father = document.getElementById('br-wfl-apply-list');
            if (father) {
                ele = father.getElementsByClassName('hec-item-inner');
                __removeEleIfExits(ele);
                var ele2 = father.getElementsByClassName('ins-doc-time');
                __removeEleIfExits(ele2);
            }
            ;

        };

        function __clearListItemsElement() {
            void 0;
            var ele = document.getElementById('br-wfl-done-list');
            if (ele) {
                ele.remove();
            }
            ;
            ele = document.getElementById('br-wfl-todo-list');
            if (ele) {
                ele.remove();
            }
            ;
            ele = document.getElementById('br-wfl-apply-list');
            if (ele) {
                ele.remove();
            }
            ;
        };

        function __removeEleIfExits(ele) {
            if (ele) {
                ele = angular.element(ele);
                ele.remove();
            }
            ;
        };

        $scope.initParams = function () {
            var params = $rootScope.pageParams.wflListPage;

            $scope.config.category = params.category;
            $scope.config.query_url_name = params.query_url_name;
            $scope.config.viewTitle = $scope.config.categoryDesc = hecS.getCategoryDesc(params.category);
            var todoOrDone = params.todoOrDone;

            var isTodo = false, isDone = false, isApply = false;
            if (todoOrDone == 'todo') {
                $scope.config.viewTitle = "未审批";
                isTodo = true;
            } else if (todoOrDone == 'done') {
                $scope.config.viewTitle = "已审批";
                isDone = true;
            } else if (todoOrDone == 'apply' || todoOrDone == "APPLY") {
                $scope.config.viewTitle = "我的申请";
                isApply = true;
            }
            ;

            $rootScope.forceSetTitle($scope.config.viewTitle);
            
            setTodoDoneApply(isTodo, isDone, isApply);
        };

        

        function __init() {

            //__clearListItemsElement();

            $scope.initParams();

            if (!$scope.config.categoryDesc || $scope.config.categoryDesc == '') {
                //$scope.config.viewTitle = "我的申请";
            }
            ;

            $scope.config.nodeActionType = hecDefaults.handleTypes;

        };

        __init();

    }
])
;

hec.service('WflHandleService', [
    '$AuHttp',
    'HecService',
    function (auHttp, hecS) {

        return {
            /**
             * approve：工作流审批接口 : 同意、拒绝
             * 参数：数组
             * action_type：审批类型
             *              APPROVE    通过
             *              REJECT      拒绝
             * comment：审批意见
             * rcpt_id：工作流待办接受者ID
             */
            approve: approve,
            /**
             * commission：工作流转交接口
             * 参数：数组
             * rcpt_id：工作流待办接受者ID
             * commission_emp_id：转交员工ID
             * comment：转交意见
             */
            commission: commission,
            /**
             * add_approver：工作流添加审批人接口
             * 参数：数组
             * rcpt_id：工作流待办接受者ID
             * priority：添加顺序，之前[BEFORE]，平行[PARALLEL]，之后[AFTER]
             * comment：添加意见
             * add_emp_id：添加员工ID
             */
            addApprover: addApprover,
            /**
             * notify：工作流通知接口
             * 参数：数组
             * instance_id：工作流实例ID
             * node_id：工作流节点ID
             * notify_emp_id：通知员工ID
             * note：通知备注
             */
            notify: notify
        };

        function approve(options) {
            var para = [];
            if (options.length) {
                for (var i = 0; i < options.length; i++) {
                    options[i]._status = 'execute';
                }
                para = options;
            } else {
                options._status = 'execute';
                para.push(options);
            }
            return auHttp.request({
                url: hecS.getUrl('approve'),
                para: para
            });
        };


        function commission(option) {
            var para = [];
            if (option.length) {
                for (var i = 0; i < option.length; i++) {
                    option[i]._status = 'execute';
                }
                para = option;
            } else {
                option._status = 'execute';
                para.push(option);
            }
            return auHttp.request({
                url: hecS.getUrl('commission'),
                para: para
            });
        };

        /*
         [
         {
         rcpt_id: '',
         priority: '',
         emps: [
         {},{},{}
         ]
         }
         ]
         */
        function addApprover(option) {
            var para = [];
            if (option.length) {
                for (var i = 0; i < option.length; i++) {
                    option[i]._status = 'execute';
                }
                para = option;
            } else {
                option._status = 'execute';
                para.push(option);
            }
            return auHttp.request({
                url: hecS.getUrl('add_approver'),
                para: para
            });
        };

        function notify(option) {
            var para = [];
            if (option.length) {
                for (var i = 0; i < option.length; i++) {
                    option[i]._status = 'execute';
                }
                para = option;
            } else {
                option._status = 'execute';
                para.push(option);
            }
            return auHttp.request({
                url: hecS.getUrl('notify'),
                para: para
            });
        };

    }]);

hec.controller('WflHandleController', [
    '$scope',
    '$state',
    '$stateParams',
    '$ionicPopup',
    '$ionicLoading',
    'HecDefaults',
    'WflHandleService',
    function ($scope, $state, $stateParams, $ionicPopup, $ionicLoading, hecDefaults, wflHandleS) {

        $scope.$on("$stateChangeStart", function (event, toState, toParams, fromState, fromParam){
                if(fromState.name == "wfl.handle" && (toState.name == "wfl.detail.docinfo" || toState.name == "wfl.list.tododoneapply")){
                        $scope.config.handleComment = "";
                        $scope.config.currentUser = null;
                        $scope.config.currentPriority = null;
                        $scope.config.selectedForTransfer = null;
                        $scope.config.selectedForAddHandler = [];
                        $scope.config.notifyEmps = [];
                        $scope.config.notifyEmpNames = "";
                        $scope.config.currentPriorityId = "PARALLEL";
                }
        });

        $scope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParam) {
            if (toParams.canMulti || toParams.canMulti == false) {
                delete toParams.canMulti;
            }
            ;
            if (toState && fromState && fromState.name && toState.name) {

                if (fromState.name == "user.selectuser") {
                    var users = $scope.publicConfig.selectedUsers;
                    if ($scope.config.isNotifyType) {
                        // $scope.config.notifyEmps = angular.copy(users);
                        if (!$scope.config.notifyEmps) {
                            $scope.config.notifyEmps = [];
                        }
                        ;
                        if (!users) {
                            users = [];
                        }
                        for (var i = 0; i < users.length; i++) {
                            $scope.config.notifyEmps.push(angular.copy(users[i]));
                        }
                        ;
                        void 0;
                        return;
                    } else if ($scope.config.isAddHandlerType) {
                        if (!$scope.config.selectedForAddHandler) {
                            $scope.config.selectedForAddHandler = [];
                        }
                        if (!users) {
                            users = [];
                        }
                        ;
                        for (var i = 0; i < users.length; i++) {
                            $scope.config.selectedForAddHandler.push(angular.copy(users[i]));
                        }
                        ;
                    } else {
                        if (users && users.length > 0) {
                            $scope.config.currentUser = users[0];
                        }
                    }
                    ;
                }
            }
            ;
        });

        $scope.config = {
            handleType: null,
            handleRcptIds: null,
            //insId: null, // instance_id
            //nodeId: null, // 当前节点 ID
            insidNodeidArray: [], // [{insId: , nodeId: }]

            // 界面用到的一些文字描述
            viewTitle: '审批',
            handleTip: '',
            commentTextareaHolder: '请输入审批意见',
            handleComment: '',

            /*
             *
             *  审批操作类型:
             *      用于控制UI元素显示
             *      js中依据类型进行相应的操作限制
             *      js中依据类型进行传参限制
             */
            isApproveType: false,
            isRejectType: false,
            isTransferType: false,
            isAddHandlerType: false,
            isNotifyType: false,


            //selectedUser: {},
            //selectedUsers: []
            currentUser: null, // {}
            currentPriority: null, // {}
            selectedForTransfer: null,	// {}
            selectedForAddHandler: [],
            notifyEmps: [], // 通知对象
            notifyEmpNames: '',

            currentPriorityId: 'PARALLEL',


            // 添加审批人相关：
            select_priority: [  // 之前[BEFORE]，平行[PARALLEL]，之后[AFTER]
                {
                    name: 'BEFORE',
                    value: ' 之  前'
                },
                {
                    name: 'PARALLEL',
                    value: ' 平  行'
                },
                {
                    name: 'AFTER',
                    value: ' 之  后'
                }
            ]

        };


        $scope.deleteNotifer = function (index) {
            if (!$scope.config.notifyEmps) {
                return;
            }
            ;
            var temp1 = $scope.config.notifyEmps.slice(0, index);
            var temp2 = $scope.config.notifyEmps.slice(index + 1);

            var result = angular.copy(temp1);
            result = result.concat(angular.copy(temp2));
            $scope.config.notifyEmps = angular.copy(result);

        };

        $scope.showHandleSelectCount = function (){
            var ids = $scope.config.insidNodeidArray;
            return ids && ids.length && ids.length > 0;
        };

        $scope.getNotifyEmpNames = function () {
            $scope.config.notifyEmpNames = "";
            var users = $scope.config.notifyEmps;
            for (var j = 0; j < users.length; j++) {
                if (j == 0) {
                    $scope.config.notifyEmpNames += users[j].exp_emp_name;
                } else {
                    $scope.config.notifyEmpNames += ("," + users[j].exp_emp_name);
                }
            }
            ;
            return $scope.config.notifyEmpNames;
        };

        function __validCanSelectPriority() {
            if ($scope.config.selectedForAddHandler && $scope.config.selectedForAddHandler.length > 0) {
                return false;
            }
            ;
            return true;
        };
        function __validCanSelectUserForAddHandler() {
            if (!$scope.config.currentPriorityId || $scope.config.currentPriorityId == '') {
                return false;
            }
            ;
            return true;
            //if($scope.config.currentPriority && $scope.config.currentPriority.value && $scope.config.currentPriority.name){
            // return true;
            //};
            //return false;
        };

        $scope.showSelectPriority = function () {
            if (!__validCanSelectPriority()) {
                return;
            }
            ;
            var user = $scope.config.selectedForTransfer;
            if (user) {
                //return;
            }// 防止添加第二个

            var opts = {
                //template: '',
                templateUrl: 'html/weixin/wfl/loading_select_priority.html',
                noBackdrop: false,
                delay: 0, //number
                duration: 0 //number
            };
            $ionicLoading.show(opts);
        };

        $scope.getSelectedPriorityDesc = function () {
            var ps = $scope.config.currentPriority;
            if (ps) {
                return ps.value;
            } else
                return '';
        };

        $scope.handleCancel = function () {
            //$scope.$ionicGoBack();
            $scope.config.selectedForAddHandler = [];
            $scope.publicFuns.goBack(null, $scope);
        };

        $scope.goSelectUserPage = function () {
            if ($scope.config.isTransferType) {
                var user = $scope.config.selectedForTransfer;
                if (user && ( user.add_emp_name || user.add_emp_id || user.priority )) {
                    __alertHandle(null, "只能添加一个转交人!");
                    return;
                }
                ;	// 防止添加第二个
                $state.go('user.selectuser', {canMulti: false, handleTimes: ++$scope.publicConfig.handleTime});
            } else if ($scope.config.isAddHandlerType) {
                if (!__validCanSelectUserForAddHandler()) {
                    __alertHandle('提示', '请先添加顺序!');
                    return;
                }
                ;
                var users = $scope.config.selectedForAddHandler;
                var userIds = [];
                for (var i = 0; i < users.length; i++) {
                    userIds.push(users[i].exp_emp_id);
                }
                ;
                $state.go('user.selectuser', {
                    hasUserIds: JSON.stringify(userIds),
                    canMulti: true,
                    handleTimes: ++$scope.publicConfig.handleTime
                });
            } else if ($scope.config.isNotifyType) {
                var users = $scope.config.notifyEmps;
                var userIds = [];
                for (var i = 0; i < users.length; i++) {
                    userIds.push(users[i].exp_emp_id);
                }
                ;
                $state.go('user.selectuser', {
                    hasUserIds: JSON.stringify(userIds),
                    canMulti: true,
                    handleTimes: ++$scope.publicConfig.handleTime
                });
            }
        };

        $scope.handleOperator = function () {
            var paraObj,
                actionType = $scope.config.handleType,
                comment = $scope.config.handleComment,
                rcpt_id = $scope.config.handleRcptIds;

            switch ($scope.config.handleType) {
                case hecDefaults.handleTypes.APPROVE:
                    paraObj = [];
                    for (var i = rcpt_id.length - 1; i >= 0; i--) {
                        paraObj.push({
                            action_type: actionType,
                            comment: comment,
                            rcpt_id: rcpt_id[i]
                        });
                    }
                    ;
                    __showLoading();
                    wflHandleS.approve(paraObj).then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            __afterHandle(true, '同意 成功', true);
                        } else {
                            __afterHandle(false, '操作 失败');
                        }
                        ;
                    }, function (resp) {
                        __hideLoading();
                    });
                    break;
                case hecDefaults.handleTypes.REJECT:
                    if (!comment || comment == '' || comment.trim() == '') {
                        __alertHandle(null, "请输入拒绝原因!");
                        return;
                    }
                    paraObj = [];
                    for (var i = rcpt_id.length - 1; i >= 0; i--) {
                        paraObj.push({
                            action_type: actionType,
                            comment: comment,
                            rcpt_id: rcpt_id[i]
                        });
                    }
                    ;
                    __showLoading();
                    wflHandleS.approve(paraObj).then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            __afterHandle(true, '拒绝 成功', true);
                        } else {
                            __afterHandle(false, '拒绝 失败', false);
                        }
                    }, function (resp) {
                        __hideLoading();
                    });
                    break;
                case hecDefaults.handleTypes.TRANSFER:
                    //var commission_emp_id = $scope.config.commission_emp_id;
                    if (!$scope.config.currentUser) {
                        __alertHandle('提示', '请添加转交人!');
                        return;
                    }
                    ;
                    var commission_emp_id = $scope.config.currentUser.exp_emp_id;

                    paraObj = [];
                    for (var i = rcpt_id.length - 1; i >= 0; i--) {
                        paraObj.push({
                            rcpt_id: rcpt_id[i],
                            commission_emp_id: commission_emp_id,
                            comment: comment
                        });
                    }
                    ;
                    __showLoading();
                    wflHandleS.commission(paraObj).then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            __afterHandle(true, '转交 成功', true);
                        } else {
                            __afterHandle(false, '转交 失败');
                        }
                    }, function (resp) {
                        __hideLoading();
                    });
                    break;
                case hecDefaults.handleTypes.ADDHANDLER:
                    //var priority = $scope.config.priority;
                    //var priority = $scope.config.currentPriority;
                    var priorityId = $scope.config.currentPriorityId;
                    if (!priorityId || priorityId == '') {
                        __alertHandle('提示', '请先选择顺序!');
                        return;
                    }
                    ;
                    var add_emp_id = $scope.config.add_emp_id;
                    var add_emps = $scope.config.selectedForAddHandler;
                    if (!add_emps || !add_emps.length || add_emps.length == 0) {
                        __alertHandle('提示', '请先添加用户!');
                        return;
                    }
                    ;
                    paraObj = [];
                    var emps = [];
                    for (var i = 0; i < add_emps.length; i++) {
                        emps.push({
                            add_emp_id: add_emps[i].exp_emp_id
                        });
                    }
                    ;
                    for (var i = rcpt_id.length - 1; i >= 0; i--) {
                        paraObj.push({
                            rcpt_id: rcpt_id[i],
                            priority: priorityId,
                            emps: emps
                        });
                    }
                    ;
                    __showLoading();
                    wflHandleS.addApprover(paraObj).then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            $scope.config.selectedForAddHandler = [];
                            __afterHandle(true, '添加处理人成功', true);
                        } else {
                            __afterHandle(false, '添加处理人失败');
                        }
                    }, function (resp) {
                        __hideLoading();
                    });
                    break;
                case hecDefaults.handleTypes.NOTIFY:
                    paraObj = [];
                    if (!$scope.config.notifyEmps || !$scope.config.notifyEmps.length || $scope.config.notifyEmps.length < 0) {
                        __alertHandle('提示', '请先添加通知用户!');
                        return;
                    }
                    ;
                    if (!comment || comment == '' || comment.trim() == '') {
                        __alertHandle('提示', "请输入通知消息!");
                        return;
                    }
                    ;
                    for (var j = 0; j < $scope.config.insidNodeidArray.length; j++) {
                        for (var i = 0; i < $scope.config.notifyEmps.length; i++) {
                            paraObj.push({
                                instance_id: $scope.config.insidNodeidArray[j].insId,
                                node_id: $scope.config.insidNodeidArray[j].nodeId || "",
                                note: comment,
                                notify_emp_id: $scope.config.notifyEmps[i].exp_emp_id
                            });
                        }
                        ;
                    }
                    ;
                    __showLoading();
                    wflHandleS.notify(paraObj).then(function (resp) {
                        __hideLoading();
                        if (resp.response.success) {
                            __afterHandle(true, '通知发送成功!', true);
                        } else {
                            __afterHandle(false, '通知发送失败!');
                        }
                    }, function (resp) {
                        __hideLoading();
                    });
                    break;
            }
        };

        function __showLoading(tip) {
            var tipText = tip ? tip : '处理中...';
            $ionicLoading.show({
                template: '<div class="handle-loading-tip"><span>' + tipText + '</span></div>'
            });
        };

        function __hideLoading() {
            $ionicLoading.hide();
        };

        // 一次只能添加一个 处理人
        $scope.disableIconClick = function () {
            var hasOne = $scope.config.selectedForTransfer ? true : false;
            return hasOne;
        };

        // 是否显示 添加处理人界面中的《重置》按钮
        $scope.diabledResetBtn = function (multi) {
            var user = $scope.config.currentUser,
                priority = $scope.config.currentPriority;
            //au = $scope.config.selectedForTransfer;
            //var b_added_user = au && (au.add_emp_id && au.add_emp_name && au.priority);
            var b_user_info = !!user && (!!user.exp_emp_name || !!user.exp_emp_id);
            var b_priority = !!priority && (!!priority.name || !!priority.value);
            //if(multi){
            return !(b_user_info || b_priority);
            //}else{
            //    return b_added_user ? true : !( b_user_info || b_priority );
            //}
            //return b_added_user ? true : ( b_user_info ? (b_priority ? false : true) : true );
            // return !(user && ( user.add_emp_name || user.add_emp_id || user.priority ));
        };

        // 是否显示 添加处理人界面中的《确定》按钮
        $scope.showAddApproverBtn = function () {
            var emp = $scope.config.currentUser;
            var priority = $scope.config.currentPriority;
            var hasOne = $scope.config.selectedForTransfer ? true : false;
            return hasOne || (!(emp && priority && emp.exp_emp_id && priority.name && priority.name != ''));
        };

        $scope.addCurrentApprover = function () {
            if (!$scope.config.currentUser || !$scope.config.currentPriority) {
                return;
            }
            ;
            var emp_id = $scope.config.currentUser.exp_emp_id,
                emp_name = $scope.config.currentUser.exp_emp_name,
                emp_priority = $scope.config.currentPriority;
            $scope.config.selectedForAddHandler.push({
                add_emp_id: emp_id,
                add_emp_name: emp_name
                //priority: emp_priority
            });
            $scope.resetCurrentApprover();
        };

        $scope.deleteHandler = function (index) {
            var temp = $scope.config.selectedForAddHandler.slice(0, index);
            var temp2 = $scope.config.selectedForAddHandler.slice(index + 1);
            for (var i = 0; i < temp2.length; i++) {
                temp.push(temp2[i]);
            }
            ;
            $scope.config.selectedForAddHandler = temp;
        };

        $scope.resetCurrentApprover = function () {
            $scope.config.currentUser = null;
            //$scope.config.currentPriority = null;
        };

        function __alertHandle(title, message) {
            var vtitle = title && title != "" ? title : '提示';
            $ionicPopup.alert({
                title: vtitle,
                template: message
            });
        };

        function __afterHandle(success, message, back) {
            var alert = $ionicPopup.alert({
                title: '提示',
                template: message
            });
            alert.then(function () {
                if (success && back) {
                    //$stateParams.handleOk = true;
                    $scope.publicConfig.handleOk = true;
                    //$scope.$ionicGoBack();
                    $scope.publicFuns.goBack(null, $scope);
                }
            });
        };


        function __clearHandleTypeInfo() {
            $scope.config.isApproveType = false;
            $scope.config.isRejectType = false;
            $scope.config.isTransferType = false;
            $scope.config.isAddHandlerType = false;
            $scope.config.isNotifyType = false;
            $scope.config.handleTip = "";
            $scope.config.handleComment = "";
            $scope.config.viewTitle = "单据审批";
        };

        var __handleTip = {
            APPROVE: '同意',
            REJECT: '拒绝',
            TRANSFER: '转交',
            ADDHANDLER: '添加处理人',
            NOTIFY: '通知'
        };

        function __init() {
            __clearHandleTypeInfo();
            $scope.config.handleType = $stateParams.handleType;
            $scope.config.handleRcptIds = JSON.parse($stateParams.ids);
            var insidNodeidArrayStr = $stateParams.insidNodeidArrayStr;
            $scope.config.notifyEmpNames = [];
            $scope.config.selectedForAddHandler = [];
            if (insidNodeidArrayStr) {
                $scope.config.insidNodeidArray = JSON.parse(insidNodeidArrayStr);
            }
            ;
            switch ($scope.config.handleType) {
                case hecDefaults.handleTypes.APPROVE:
                    $scope.config.handleTip = __handleTip.APPROVE;
                    $scope.config.isApproveType = true;
                    $scope.config.handleComment = "同意";
                    break;
                case hecDefaults.handleTypes.REJECT:
                    $scope.config.handleTip = __handleTip.REJECT;
                    $scope.config.isRejectType = true;
                    $scope.config.commentTextareaHolder = "请输入拒绝原因(必填)";
                    $scope.config.handleComment = "";
                    break;
                case hecDefaults.handleTypes.ADDHANDLER:
                    $scope.config.handleTip = __handleTip.ADDHANDLER;
                    $scope.config.isAddHandlerType = true;
                    break;
                case hecDefaults.handleTypes.TRANSFER:
                    $scope.config.handleTip = __handleTip.TRANSFER;
                    $scope.config.handleComment = "";
                    $scope.config.isTransferType = true;
                    break;
                case hecDefaults.handleTypes.NOTIFY:
                    $scope.config.handleTip = __handleTip.NOTIFY;
                    $scope.config.isNotifyType = true;
                    $scope.config.commentTextareaHolder = "请输入通知消息(必填)";
                    $scope.config.handleComment = "";
                    break;
            }

        };

        __init();

    }]);

hec.controller('WflSelectController', [
    '$scope',
    '$ionicLoading',
    function ($scope, $ionicLoading) {

        $scope.config = {
            /*
             *  选择 Priority
             */
            select_priority: [  // 之前[BEFORE]，平行[PARALLEL]，之后[AFTER]
                {
                    name: 'BEFORE',
                    value: '之前'
                },
                {
                    name: 'PARALLEL',
                    value: '平行'
                },
                {
                    name: 'AFTER',
                    value: '之后'
                }
            ],
            /*
             *  选择 category
             */
            select_category: [
                {
                    name: 'ACP_REQUISITION',
                    value: '付款申请单'
                },
                {
                    name: 'BUDGET_JOURNAL',
                    value: '预算记账'
                },
                {
                    name: 'CON_CONTRACT',
                    value: '合同'
                },
                {
                    name: 'EXP_REPORT',
                    value: '费用报销单'
                },
                {
                    name: 'EXP_REQUISITION',
                    value: '费用申请单'
                },
                {
                    name: 'EXP_TRAVEL_PLAN',
                    value: '差旅计划'
                },
                {
                    name: 'OA_FLOW',
                    value: 'BPM流程申请'
                },
                {
                    name: 'PAYMENT_REQUISITION',
                    value: '借款申请单'
                },
                {
                    name: 'PTL_ANNOUNCEMENT',
                    value: '门户公告'
                },
                {
                    name: 'PTL_FILES',
                    value: '文档管理'
                }
            ]
        };


        $scope.hideLoading = function ($event) {
            if (!$event) {
                return;
            }
            var $target = angular.element($event.target);
            var attrs = $target[0].attributes;
            for (var i = (attrs.length - 1); i >= 0; i--) {
                var attr = attrs[i];
                if ((attr.name == "cound-hide")) {
                    $ionicLoading.hide();
                }
            }
        };

        $scope.selectPriority = function (item) {
            $scope.config.current_priority = item;
            //var elemDom = document.getElementById('hec-wfl-handle-page');
            var elemDoms = document.getElementsByClassName('hec-wfl-handle-page-class');
            var elemDom = elemDoms[elemDoms.length - 1];
            //var elemDom = document.getElementById('handle-addhandler-content');
            var elem = angular.element(elemDom);
            var elemScope = elem.scope();
            elemScope.config.currentPriority = item;
            $ionicLoading.hide();
        };

        $scope.selectCategory = function (item) {
            $scope.config.current_priority = item;
            // hec-wfl-todo-done-view
            var elemDom = document.getElementById('approve-approve');
            var elem = angular.element(elemDom);
            var elemScope = elem.scope();
            elemScope.seniorSearchConfig.ins_doc_category = item;
            $ionicLoading.hide();
        };

    }]);
hec.service('MyApplyService', [
	'HecService', 
	'AuHttp',
function(hecS, auHttp){
	
}])
.controller('MyApplyCtrl', [
	'$scope',
function($scope){
	
		$scope.config = {

		};

		function __init(){

		};

		__init();

}]);
hec.service('TodoDoneCategoryService', [ 
    function () {

    }]);

hec.controller('TodoDoneCategoryCtrl', [ 
    '$scope',
    '$rootScope',
    '$state',
    'TodoDoneCategoryService',
    function($scope, $rootScope, $state, tododonecategoryS){
        void 0;

        $scope.$on("$stateChangeSuccess", function (event, toState, toParams, fromState, fromParam){
            if(toState.name == 'wfl.category.done'){
                $rootScope.forceSetTitle('已审批');
            }
            if(toState.name == 'wfl.category.todo'){
                $rootScope.forceSetTitle('未审批');
            }
        });

        $scope.config = {
            categories: [
                //{
                //  category_desc: '全部',
                //  category: 'ALL',
                //  suffix_url_name: 'query_all'
                //},
                {
                    category_desc: '借款申请单',
                    category: 'PAYMENT_REQUISITION',
                    suffix_url_name: 'query_payment_requisition',
                    img_src: 'images/weixin/list_category_05.png'
                },
                {
                    category_desc: '费用申请单',
                    category: 'EXP_REQUISITION',
                    suffix_url_name: 'query_exp_requisition',
                    img_src: 'images/weixin/list_category_08.png'
                },
                {
                    category_desc: '费用报销单',
                    category: 'EXP_REPORT',
                    suffix_url_name: 'query_exp_report',
                    img_src: 'images/weixin/list_category_10.png'
                }
            ],
            isTodo: false,
            viewTitle: '分类',
            categoryTimes: 0
        };

        $scope.goListPage = function (item){
            void 0;
            var isTodo = $scope.config.isTodo;
            var todoOrDone = '';
            if(isTodo){
                todoOrDone = 'todo';
                var query_url_name = 'todo_' + item.suffix_url_name;
                $rootScope.list_query_url_name = query_url_name;
            }else{
                todoOrDone = 'done';
                var query_url_name = 'done_' + item.suffix_url_name;
                $rootScope.list_query_url_name = query_url_name;
            };

            $rootScope.pageParams.wflListPage.category = item.category;
            $rootScope.pageParams.wflListPage.query_url_name = query_url_name;
            $rootScope.pageParams.wflListPage.todoOrDone = todoOrDone;
            $state.go('wfl.list.tododoneapply');

        };

        $scope.allGoListPage = function (){
            var isTodo = $scope.config.isTodo;
            var todoOrDone = '';
            if(isTodo){
                todoOrDone = 'todo';
                var query_url_name = 'todo_query_all';
                $rootScope.list_query_url_name = query_url_name;
            }else{
                todoOrDone = 'done';
                var query_url_name = 'done_query_all';
                $rootScope.list_query_url_name = query_url_name;
            };

            $rootScope.pageParams.wflListPage.category = 'ALL';
            $rootScope.pageParams.wflListPage.query_url_name = query_url_name;
            $rootScope.pageParams.wflListPage.todoOrDone = todoOrDone;
            $state.go('wfl.list.tododoneapply');
        };

        function __init() {
            var stateName = $state.current.name;
            if (stateName == 'wfl.category.done') {
                $scope.config.isTodo = false;
                $scope.config.viewTitle = '已审批';
                $rootScope.forceSetTitle('已审批');
            } else if (stateName == 'wfl.category.todo') {
                $scope.config.isTodo = true;
                $scope.config.viewTitle = '未审批';
                $rootScope.forceSetTitle('未审批');
            }
            ;
        };

        __init();

    }]);
