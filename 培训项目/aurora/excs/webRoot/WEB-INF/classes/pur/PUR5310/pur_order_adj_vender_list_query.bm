<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: zjw  
    $Date: 2011-10-11 下午02:22:41  
    $Revision: 1.0  
    $Purpose: 
-->
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm">
    <bm:operations>
        <bm:operation name="query">
            <bm:query-sql><![CDATA[SELECT *
		  FROM (SELECT L.VENDER_ITEM_LIST_ID,
					   L.ITEM_CODE,
					   L.DESCRIPTION,
					   (SELECT T.DESCRIPTION
						  FROM INV_SYSTEM_ITEM_TYPES_VL T
						 WHERE L.ITEM_TYPE_ID = T.ITEM_TYPE_ID) VENDER_ITEM_TYPE,
					   L.ITEM_ID,
					   L.ITEM_TYPE_ID,
					   L.ITEM_SPECS,
					   L.ITEM_MODEL,
					   L.VENDER_ITEM_VENDER_ID,
					   (SELECT P.PRICE / P.PRICE_QUANTITY
						  FROM PUR_VENDER_ITEM_PRICES  P,
							   PUR_VENDER_ITEM_PERIODS PERIOD
						 WHERE PERIOD.VENDER_ITEM_PERIOD_ID = P.VENDER_ITEM_PERIOD_ID
						   AND PERIOD.VENDER_ITEM_LIST_ID = L.VENDER_ITEM_LIST_ID
						   AND PERIOD.CURRENCY = ${/parameter/@currency_code}
						   AND TO_DATE(${/parameter/@default_requisition_date_id}, 'YYYY-MM-DD') BETWEEN
							   NVL(PERIOD.START_DATE,
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD')) AND
							   NVL(PERIOD.END_DATE,
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD'))
						   AND P.QUANTITY_SCALE_FROM =
							   (SELECT MIN(QUANTITY_SCALE_FROM)
								  FROM PUR_VENDER_ITEM_PRICES  P,
									   PUR_VENDER_ITEM_PERIODS PERIOD
								 WHERE PERIOD.VENDER_ITEM_PERIOD_ID =
									   P.VENDER_ITEM_PERIOD_ID
								   AND PERIOD.VENDER_ITEM_LIST_ID =
									   L.VENDER_ITEM_LIST_ID
								   AND PERIOD.CURRENCY = ${/parameter/@currency_code}
								   AND TO_DATE(${/parameter/@default_requisition_date_id},
											   'YYYY-MM-DD') BETWEEN
									   NVL(PERIOD.START_DATE,
										   TO_DATE(${/parameter/@default_requisition_date_id},
												   'YYYY-MM-DD')) AND
									   NVL(PERIOD.END_DATE,
										   TO_DATE(${/parameter/@default_requisition_date_id},
												   'YYYY-MM-DD')))) PRICE,
					   (SELECT PERIOD.VENDER_ITEM_PERIOD_ID
						  FROM PUR_VENDER_ITEM_PERIODS PERIOD
						 WHERE PERIOD.VENDER_ITEM_LIST_ID = L.VENDER_ITEM_LIST_ID
						   AND PERIOD.CURRENCY = ${/parameter/@currency_code}
						   AND TO_DATE(${/parameter/@default_requisition_date_id}, 'YYYY-MM-DD') BETWEEN
							   NVL(PERIOD.START_DATE,
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD')) AND
							   NVL(PERIOD.END_DATE,
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD'))) VENDER_ITEM_PERIOD_ID,
					   L.LEAD_TIME,
					   L.EXPENSE_ITEM_ID,
					   (SELECT E.DESCRIPTION
						  FROM EXP_EXPENSE_ITEMS_VL E
						 WHERE E.EXPENSE_ITEM_ID = L.EXPENSE_ITEM_ID) AS EXPENSE_DESCRIPTION,
					   (SELECT VENDER.VENDER_ID
						  FROM PUR_SYSTEM_VENDERS_VL VENDER
						 WHERE V.VENDER_ID = VENDER.VENDER_ID) VENDER_ID,
					   (SELECT VENDER.PAYMENT_METHOD
						  FROM PUR_SYSTEM_VENDERS_VL VENDER
						 WHERE V.VENDER_ID = VENDER.VENDER_ID) PAYMENT_METHOD,
					   (SELECT VENDER.DESCRIPTION
						  FROM PUR_SYSTEM_VENDERS_VL VENDER
						 WHERE V.VENDER_ID = VENDER.VENDER_ID) VENDERS_DESC,
					   L.PRIMARY_UOM,
					   (SELECT P.TAX_TYPE_ID
						  FROM PUR_VENDER_ITEM_PERIODS P, FND_TAX_TYPE_CODES_VL T
						 WHERE T.ENABLED_FLAG = 'Y'
						   AND P.TAX_TYPE_ID = T.TAX_TYPE_ID
						   AND P.VENDER_ITEM_LIST_ID = L.VENDER_ITEM_LIST_ID
						   AND P.CURRENCY = ${/parameter/@currency_code}
						   AND TO_DATE(${/parameter/@default_requisition_date_id}, 'YYYY-MM-DD') BETWEEN
							   TO_DATE(P.START_DATE, 'YYYY-MM-DD') AND
							   NVL(TO_DATE(P.END_DATE, 'YYYY-MM-DD'),
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD'))) RATE_KIND,
					   (SELECT T.DESCRIPTION
						  FROM PUR_VENDER_ITEM_PERIODS P, FND_TAX_TYPE_CODES_VL T
						 WHERE T.ENABLED_FLAG = 'Y'
						   AND P.TAX_TYPE_ID = T.TAX_TYPE_ID
						   AND P.VENDER_ITEM_LIST_ID = L.VENDER_ITEM_LIST_ID
						   AND P.CURRENCY = ${/parameter/@currency_code}
						   AND TO_DATE(${/parameter/@default_requisition_date_id}, 'YYYY-MM-DD') BETWEEN
							   TO_DATE(P.START_DATE, 'YYYY-MM-DD') AND
							   NVL(TO_DATE(P.END_DATE, 'YYYY-MM-DD'),
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD'))) RATE_KIND_DESC,
					   (SELECT T.TAX_TYPE_RATE
						  FROM PUR_VENDER_ITEM_PERIODS P, FND_TAX_TYPE_CODES_VL T
						 WHERE T.ENABLED_FLAG = 'Y'
						   AND P.TAX_TYPE_ID = T.TAX_TYPE_ID
						   AND P.VENDER_ITEM_LIST_ID = L.VENDER_ITEM_LIST_ID
						   AND P.CURRENCY = ${/parameter/@currency_code}
						   AND TO_DATE(${/parameter/@default_requisition_date_id}, 'YYYY-MM-DD') BETWEEN
							   TO_DATE(P.START_DATE, 'YYYY-MM-DD') AND
							   NVL(TO_DATE(P.END_DATE, 'YYYY-MM-DD'),
								   TO_DATE(${/parameter/@default_requisition_date_id},
										   'YYYY-MM-DD'))) RATE,
					   (SELECT CCH.CONTRACT_HEADER_ID
						  FROM CON_CONTRACT_HEADERS       CCH,
							   CON_CONTRACT_PARTNER_LINES CPL
						 WHERE CCH.STATUS = 'CONFIRM'
						   AND CPL.CONTRACT_HEADER_ID = CCH.CONTRACT_HEADER_ID
						   AND CPL.PARTNER_CATEGORY = 'VENDER'
						   AND CPL.PARTNER_ID = NVL(${/parameter/@vender_id}, CPL.PARTNER_ID)
						   AND CCH.CURRENCY_CODE =
							   NVL(${/parameter/@currency_code}, CCH.CURRENCY_CODE)
						   AND EXISTS
						 (SELECT 1
								  FROM CON_CONTRACT_REF_AUTHORITY CCRA
								 WHERE CCRA.CONTRACT_HEADER_ID =
									   CCH.CONTRACT_HEADER_ID
								   AND CCRA.COMPANY_ID = ${/session/@company_id}
								   AND CCRA.ENABLED_FLAG = 'Y')) CONTRACT_HEADER_ID,
					   (SELECT CCH.CONTRACT_NUMBER
						  FROM CON_CONTRACT_HEADERS       CCH,
							   CON_CONTRACT_PARTNER_LINES CPL
						 WHERE CCH.STATUS = 'CONFIRM'
						   AND CPL.CONTRACT_HEADER_ID = CCH.CONTRACT_HEADER_ID
						   AND CPL.PARTNER_CATEGORY = 'VENDER'
						   AND CPL.PARTNER_ID = NVL(${/parameter/@vender_id}, CPL.PARTNER_ID)
						   AND CCH.CURRENCY_CODE =
							   NVL(${/parameter/@currency_code}, CCH.CURRENCY_CODE)
						   AND EXISTS
						 (SELECT 1
								  FROM CON_CONTRACT_REF_AUTHORITY CCRA
								 WHERE CCRA.CONTRACT_HEADER_ID =
									   CCH.CONTRACT_HEADER_ID
								   AND CCRA.COMPANY_ID = ${/session/@company_id}
								   AND CCRA.ENABLED_FLAG = 'Y')) CONTRACT_NUMBER,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 1) E1,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 1) D1,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 2) E2,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 2) D2,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 3) E3,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 3) D3,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 4) E4,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 4) D4,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 5) E5,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 5) D5,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 6) E6,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 6) D6,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 7) E7,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 7) D7,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 8) E8,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 8) D8,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 9) E9,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 9) D9,
					   (SELECT FDV.DIMENSION_VALUE_ID
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 10) E10,
					   (SELECT FDV.DESCRIPTION
						  FROM PUR_PO_REF_DIMENSIONS   PR,
							   FND_DIMENSION_VALUES_VL FDV,
							   FND_DIMENSIONS_VL       FV
						 WHERE PR.DIMENSION_ID = FV.DIMENSION_ID
						   AND PR.DEFAULT_DIM_VALUE_ID = FDV.DIMENSION_VALUE_ID(+)
						   AND PR.LAYOUT_POSITION = 'DOCUMENTS_LINE'
						   AND FV.DIMENSION_SEQUENCE = 10) D10
				  FROM PUR_VENDER_ITEM_LISTS_VL L, PUR_VENDER_ITEM_VENDERS_VL V
				 WHERE L.VENDER_ITEM_VENDER_ID = V.VENDER_ITEM_VENDER_ID
				   AND V.VENDER_ID = ${/parameter/@vender_id}) V
            #WHERE_CLAUSE#
				 order by v.vender_item_list_id desc]]></bm:query-sql>
        </bm:operation>
    </bm:operations>
    <bm:query-fields>
        <bm:query-field name="item_type" dataType="java.lang.String" queryExpression="item_type_id = ${@item_type}"/>
        <bm:query-field name="item_code" dataType="java.lang.String" queryExpression="item_code like &apos;%&apos;||${@item_code}||&apos;%&apos;"/>
        <bm:query-field name="description" dataType="java.lang.String" queryExpression="description like ${@description}"/>
    </bm:query-fields>
</bm:model>
